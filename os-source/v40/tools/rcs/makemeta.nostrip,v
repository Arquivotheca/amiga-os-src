head     38.3;
branch   ;
access   ;
symbols  ;
locks    ; strict;
comment  @*   @;


38.3
date     93.03.09.16.34.20;  author peter;  state Exp;
branches ;
next     38.2;

38.2
date     91.11.04.16.32.57;  author peter;  state Exp;
branches ;
next     38.1;

38.1
date     91.08.29.18.09.29;  author peter;  state Exp;
branches ;
next     38.0;

38.0
date     91.07.16.14.45.11;  author kevin;  state Exp;
branches ;
next     37.2;

37.2
date     91.03.11.19.29.20;  author kevin;  state Exp;
branches ;
next     37.1;

37.1
date     91.01.04.18.56.42;  author kevin;  state Exp;
branches ;
next     36.53;

36.53
date     90.11.12.15.31.09;  author kevin;  state Exp;
branches ;
next     36.52;

36.52
date     90.11.12.15.16.29;  author kevin;  state Exp;
branches ;
next     36.51;

36.51
date     90.08.02.10.57.41;  author kevin;  state Exp;
branches ;
next     36.50;

36.50
date     90.08.01.21.41.53;  author kevin;  state Exp;
branches ;
next     36.49;

36.49
date     90.08.01.18.26.12;  author kevin;  state Exp;
branches ;
next     36.48;

36.48
date     90.07.31.10.47.11;  author kevin;  state Exp;
branches ;
next     36.47;

36.47
date     90.04.23.10.48.45;  author rsbx;  state Exp;
branches ;
next     36.46;

36.46
date     90.04.05.21.57.23;  author kevin;  state Exp;
branches ;
next     36.45;

36.45
date     90.04.05.21.55.17;  author kevin;  state Exp;
branches ;
next     36.44;

36.44
date     90.04.02.20.00.46;  author kevin;  state Exp;
branches ;
next     36.43;

36.43
date     90.04.02.19.43.39;  author kevin;  state Exp;
branches ;
next     36.42;

36.42
date     90.04.02.13.06.46;  author rsbx;  state Exp;
branches ;
next     36.41;

36.41
date     90.04.02.13.02.15;  author rsbx;  state Exp;
branches ;
next     36.40;

36.40
date     90.04.01.18.28.28;  author rsbx;  state Exp;
branches ;
next     36.39;

36.39
date     90.03.24.22.12.17;  author kevin;  state Exp;
branches ;
next     36.38;

36.38
date     90.01.27.15.52.49;  author kodiak;  state Exp;
branches ;
next     36.37;

36.37
date     90.01.19.13.25.52;  author kodiak;  state Exp;
branches ;
next     36.36;

36.36
date     89.12.12.13.17.51;  author rsbx;  state Exp;
branches ;
next     36.35;

36.35
date     89.11.28.15.51.17;  author rsbx;  state Exp;
branches ;
next     36.34;

36.34
date     89.11.28.15.35.05;  author rsbx;  state Exp;
branches ;
next     36.33;

36.33
date     89.07.17.11.56.18;  author kodiak;  state Exp;
branches ;
next     36.32;

36.32
date     89.07.17.10.43.38;  author kodiak;  state Exp;
branches ;
next     36.31;

36.31
date     89.07.02.14.24.42;  author kodiak;  state Exp;
branches ;
next     36.30;

36.30
date     89.06.29.16.03.07;  author kodiak;  state Exp;
branches ;
next     36.29;

36.29
date     89.06.19.13.14.39;  author kodiak;  state Exp;
branches ;
next     36.28;

36.28
date     89.04.15.14.21.21;  author kodiak;  state Exp;
branches ;
next     36.27;

36.27
date     89.04.11.15.02.54;  author kodiak;  state Exp;
branches ;
next     36.26;

36.26
date     89.04.11.13.37.36;  author kodiak;  state Exp;
branches ;
next     36.25;

36.25
date     89.04.11.12.57.52;  author kodiak;  state Exp;
branches ;
next     36.24;

36.24
date     89.04.11.12.50.29;  author kodiak;  state Exp;
branches ;
next     36.23;

36.23
date     89.04.07.12.58.00;  author kodiak;  state Exp;
branches ;
next     36.22;

36.22
date     89.04.07.12.52.06;  author kodiak;  state Exp;
branches ;
next     36.21;

36.21
date     89.04.07.10.15.36;  author kodiak;  state Exp;
branches ;
next     36.20;

36.20
date     89.04.07.09.27.48;  author kodiak;  state Exp;
branches ;
next     36.19;

36.19
date     89.04.04.14.43.58;  author kodiak;  state Exp;
branches ;
next     36.18;

36.18
date     89.02.08.17.48.39;  author kodiak;  state Exp;
branches ;
next     36.17;

36.17
date     89.02.06.12.49.27;  author kodiak;  state Exp;
branches ;
next     36.16;

36.16
date     89.01.30.10.30.07;  author kodiak;  state Exp;
branches ;
next     36.15;

36.15
date     89.01.26.18.24.56;  author kodiak;  state Exp;
branches ;
next     36.14;

36.14
date     89.01.10.18.56.11;  author kodiak;  state Exp;
branches ;
next     36.13;

36.13
date     88.11.23.17.42.35;  author kodiak;  state Exp;
branches ;
next     36.12;

36.12
date     88.11.23.14.19.22;  author kodiak;  state Exp;
branches ;
next     36.11;

36.11
date     88.09.14.10.24.59;  author neil;  state Exp;
branches ;
next     36.10;

36.10
date     88.09.14.09.52.08;  author kodiak;  state Exp;
branches ;
next     36.9;

36.9
date     88.07.14.16.06.14;  author kodiak;  state Exp;
branches ;
next     36.8;

36.8
date     88.07.01.10.46.27;  author kodiak;  state Exp;
branches ;
next     36.7;

36.7
date     88.06.07.19.31.41;  author neil;  state Exp;
branches ;
next     36.6;

36.6
date     88.05.25.13.56.10;  author kodiak;  state Exp;
branches ;
next     36.5;

36.5
date     88.03.08.11.28.13;  author kodiak;  state Exp;
branches ;
next     36.4;

36.4
date     88.03.07.13.53.18;  author kodiak;  state Exp;
branches ;
next     36.3;

36.3
date     88.03.07.13.40.28;  author kodiak;  state Exp;
branches ;
next     36.2;

36.2
date     88.03.07.13.36.52;  author kodiak;  state Exp;
branches ;
next     36.1;

36.1
date     88.03.01.12.45.49;  author kodiak;  state Exp;
branches ;
next     36.0;

36.0
date     88.03.01.09.54.14;  author kodiak;  state Exp;
branches ;
next     35.5;

35.5
date     88.02.01.15.00.27;  author kodiak;  state Exp;
branches ;
next     35.4;

35.4
date     87.12.28.16.43.08;  author kodiak;  state Exp;
branches ;
next     35.3;

35.3
date     87.12.23.11.46.44;  author kodiak;  state Exp;
branches ;
next     35.2;

35.2
date     87.12.23.11.32.36;  author kodiak;  state Exp;
branches ;
next     35.1;

35.1
date     87.12.23.11.00.26;  author kodiak;  state Exp;
branches ;
next     35.0;

35.0
date     87.12.23.10.59.06;  author kodiak;  state Exp;
branches ;
next     ;


desc
@Everyone's favorite make .INCLUDE file!
@


38.3
log
@Changed to V40.
@
text
@# $Id: makemeta.nostrip,v 38.2 91/11/04 16:32:57 peter Exp Locker: peter $

#	Define the following to use this makefile
#
#  SUBSYSNAME	The name that will be associated with the .ld, .srec,
#		... files to be produced.
#
#  SSTART	The start address for creation of $SUBSYSNAME.srec files
#
#  AFILES	All the assembler source files
#
#  CFILES	All the C source files
#
#  FIRSTO	The first object file to appear in library or the load 
#		file generated by this makefile, but the last dependency
#		to be resolved.  This means the source for this file will
#		be compiled or assembled last.  Not to be confused with
#		STARTUP, which goes before this if it exists, but will
#		always be an .obj file that is not compiled or assembled
#		here.
#  OCMFILES	Object files with the extension .ocm, indicating that the
#		data and bss portions are to be loaded into chip memory.
#		and files with the extension .oCm, indicating that the
#		all portions are to be loaded into chip memory.
#  OFILES	All the object files that make either the library or the
#		load file generated by this makefile, whose source appears
#		in this directory, with the exception of FIRSTO and
#		OCMFILES files
#  MAKEFILE	The name of the Makefile that contains the above items,
#		so that a new $SUBSYSNAME.with file can be generated when
#		the Makefile changes.
#
#		
#	Define the following to generate public code (e.g. roms)
#
#  SRCDIRPATH	The major directory name that the SRCDIR is within,
#		i.e. kickstart or workbench.  For code in a multi level
#		source form, this may be a longer path.
#
#  SUBSYSGROUP	The group within .../include/ that the following external
#		include files should be placed in
#
#  EXTERNIFILES	All the assembler include files released to others in
#		EXTINCL and EXTINCLNS
#
#  INTERNIFILES	All the assembler include files released to others in
#		INTINCL and INTINCLNS: for internal use only
#
#  IFILES	All the private assembler include files used by this code
#		(i.e. found in this directory but not released to others),
#		except any _rev.i files
#
#  EXTERNHFILES	All the C include files released to others in
#		EXTINCL and EXTINCLNS
#
#  INTERNHFILES	All the C include files released to others in
#		INTINCL and INTINCLNS: for internal use only
#
#  HFILES	All the private C include files used by this code (i.e.
#		found in this directory but not released to others),
#		except any _rev.h files
#
#  MISCSRC	Files that need to be copied to the private source
#		directory, but do not fit the purpose of these other
#		macros
#
#  MISCDOC	Files that need to be copied to the documentation 
#		directory, other than ${SUBSYSNAME}.doc (which is
#		automatically copied).
#
#
#	Define the following variables to futher effect the rules:
#
#  CSTART	The start address for creation of $SUBSYSNAME.crec files,
#		if not equal to SSTART-$C0000
#  MYLIBS	Additional libraries to search before the system library
#		to resolve dependencies
#  MYINCL	An additional include directory to search after the
#		current directory but before the default system directory.
#		Only one directory can be specified.
#  CFLAGS	Additional options for C compilation.  Use MYINCL= and
#		SYSINCL= to change -I flags.
#  AFLAGS	Additional options to the Assembler. For example
#		"-l $*.lis" to generate a listing file.  Use MYINCL= and
#		SYSINCL= to change -I flags.
#  DFLAGS	Flags top send to AutoDoc tool.
#  CAFLAGS	Additional options for C compilation, so that specific
#		assembler flags may be passed through to the assembler. (@@@@)
#  LFLAGS	Additional options to the linker.
#		For example "map=$*.map" or "xref=$*.xref".
#  STARTUP	An .obj file to be linked to the start of the link.  Use
#		${LIBDIR}/startup.obj for C
#		running under DOS, nodos_startup.obj when not under DOS,
#		and wbstartup.obj when running under WorkBench.
#
#	Override the following variables from the make command itself:
#
#  VERNUM	The version of code being produced, the suffix of the
#		VERDIR directory /usr/commodore/amiga/V${VERNUM}, and
#		the software version that should be in libraries and
#		devices.  This specifies software compatibility.
#		Anyone who uses the automatic <subsys>_rev.i file
#		can pick this up by automatically.  Others should use
#		use this variable to define something in their subsystem
#		explicitly.
#  VERDIR	The directory within which SRCDIR, EXTINCL, EXTINCLNS,
#		INTINCL, INTINCLNS, LIBDIR, and CARTDIR live,
#		and which contains the system include directory
#  SYSINCL	The system include directory, stripped for compiles
#  SYMBOLOPT	By default, we have symbolic hunks turned on in the
#		assembler.  Override SYMBOLOPT to turn this off
#		(it makes your object modules 60% smaller).
#  METAFILE     the name of the makemeta file
#  DEPENDFILE   the name of the dependency file
#
# makemeta.sub is a slightly modified version of makemeta to
# deal with subsystems and their sub directory sources.

VERNUM=		40
VERDIR=		/usr/commodore/amiga/V${VERNUM}
# tools
ASM=		${VERDIR}/tools/bin/cassem
ASMTAGS=	${VERDIR}/tools/sh/asmtags
ATOM=		${VERDIR}/tools/bin/atom
BCPL=		${VERDIR}/tools/bin/bcpl
BUMPREV=	${VERDIR}/tools/sh/bumprev
CKRCS=		${VERDIR}/tools/sh/ckrcs
#LDRCS=		${VERDIR}/tools/sh/ldrcs
LINK=		${VERDIR}/tools/bin/calink
MAKEINCLUDE=	${VERDIR}/tools/bin/makeinclude
MMINSTALL=	${VERDIR}/tools/sh/mminstall
RESETREV=	${VERDIR}/tools/sh/resetrev
REVLABEL=	${VERDIR}/tools/sh/revlabel
STRIPF=		${VERDIR}/tools/bin/stripf
SFDTOOL=	${VERDIR}/tools/bin/sfd
# tools without sources
CC=		nmetacc
CTAGS=		ctags
CXTAGS=		${VERDIR}/tools/cxtags
MAKE=		make
#
SRCPATH=	${VERDIR}/src/${SRCDIRPATH}/${SRCDIR}
#SYSINCL=	${VERDIR}/include.strip
SYSINCLNS=	${VERDIR}/include
#EXTINCL=	${SYSINCL}/${SUBSYSGROUP}
EXTINCLNS=	${SYSINCLNS}/${SUBSYSGROUP}
#INTINCL=	${SYSINCL}/internal
INTINCLNS=	${SYSINCLNS}/internal
LIBDIR=		${VERDIR}/lib
DOCDIR=		${VERDIR}/doc
METAFILE=	${VERDIR}/tools/makemeta
LIBSFD=		${LIBDIR}/sfd
DEPENDFILE=	${SUBSYSNAME}${VERNUM}.depend
LFILES=		${MYLIBS} ${VERDIR}/lib/amiga.lib
RCSFILES=	${AFILES} ${CFILES} ${BFILES} \
		${HFILES} ${IFILES} ${GFILES} \
		${MAKEFILE} ${MISCSRC} ${MISCDOC} ${SUBSYSNAME}_lib.sfd
AINCL=		-i \"${MYINCL} ${SYSINCLNS}\"
CINCL=		-I -I${MYINCL} -I${SYSINCLNS}
SYMBOLOPT=	,S
.SUFFIXES:
.SUFFIXES:	.h .i .sfd .rev .ld .oCm .ocm .obj .c .b .asm

default:
	@@echo 'But what do you want to make?'

.INCLUDE=${DEPENDFILE}
.c.obj:
	@@echo ${CFLAGS} $<:
	@@${CC} -S -X54 -X104 -X106 ${CFLAGS} ${CINCL} $*.c
	@@if test "${CAPP}"; then ( \
	    ${CAPP} < $*.asm > $*.asm.TMP; \
	    mv $*.asm.TMP $*.asm; ); \
	else ( if test "${CAPP2}"; then ( \
	    ${CAPP2} < $*.asm > $*.asm.TMP; \
	    mv $*.asm.TMP $*.asm; ); fi; ); fi
	@@${ASM} $*.asm -o $*.obj.TMP -c q,a${SYMBOLOPT} ${CAFLAGS}
	@@rm -f $*.asm $@@
	@@mv $@@.TMP $@@
.b.obj:
	@@echo ${BFLAGS} $<:
	@@${BCPL} $*.b $*.obj.TMP opt '"${BFLAGS}"' obj a \
		inc \"${MYINCL} ${SYSINCLNS}\"
	@@mv $*.obj.TMP $@@
.asm.obj:
	@@echo $<:
	@@if test "${APP}"; \
	    then( \
		${APP} < $< > $*.asm.TMP; \
		${ASM} $*.asm.TMP -o $@@.TMP -c q,a${SYMBOLOPT} ${AFLAGS} \
	    		${AINCL}; \
		rm -f $*.asm.TMP; \
	    ); else( \
		${ASM} $*.asm -o $@@.TMP -c q,a${SYMBOLOPT} ${AFLAGS} \
	    		${AINCL}; \
		); \
	    fi
	@@rm -f $@@
	@@mv $@@.TMP $@@
.obj.oCm:
	@@echo $<:
	@@${ATOM} $*.obj $*.obj.TMP -CCDB
	@@mv -f $*.obj.TMP $@@
.obj.ocm:
	@@echo $<:
	@@${ATOM} $*.obj $*.obj.TMP -CDB -PC
	@@mv -f $*.obj.TMP $@@
.rev.i .rev.h:
	@@${BUMPREV} ${VERNUM} $* $?
.sfd.i:
	@@echo $@@:
	@@rm -f $@@
	@@${SFDTOOL} -i $*.sfd
clean::	${SUBDIRS} ${SUBMAKES}
	rm -f *.obj *.o[cC]m *.ld *.ld.strip *.[cs]rec *TMP[' '0-9] *.lis *.xr0 \
	    *.even *.odd *.CKP *.BAK *.TMP *.TMP? awkvers.* *.with *.depend \
	    *.[csl]map *.cat *.xref core *.lib
	rm -rf TMPD
${SUBSYSNAME}.with with:	${SUBDIRS} ${SUBMAKES} ${MAKEFILE} ${METAFILE}
	@@echo ${SUBSYSNAME}.with:
	-@@if test -z "${WITH}"; \
	    then( \
	    cat < /dev/null > TMP1; \
	    for i in ${STARTUP} ${FIRSTO} ${OFILES} TMP1 ; do \
		( echo $$i | sed -n -e "/TMP1/!s/$$/,*/p" >> TMP1 ); done; \
	    for i in ${OCMFILES} TMP1 ; do \
		( echo $$i | sed -n -e "/TMP1/!s/$$/,*/p" >> TMP1 ); done; \
	    sed -e "\$$s/,\*$$//" TMP1 > TMP2; \
	    echo "FROM *" > TMP1; \
	    cat TMP1 TMP2 > ${SUBSYSNAME}.with.new; \
	    cat < /dev/null > TMP1; \
	    for i in ${LFILES} TMP1 ; do \
		( echo $$i | sed -n -e "/TMP1/!s/$$/,*/p" >> TMP1 ); done; \
	    sed -e "\$$s/,\*$$//" TMP1 > TMP2; \
	    echo "LIBRARY *" > TMP1; \
	    cat TMP1 TMP2 >> ${SUBSYSNAME}.with.new; \
	    rm -f TMP1 TMP2; \
	    mv -f ${SUBSYSNAME}.with.new ${SUBSYSNAME}.with; \
	    ); \
	    else( \
	    cat ${WITH} > TMP1; \
	    cat TMP1 > ${SUBSYSNAME}.with; \
	    rm -f TMP1 \
	    ); fi
${DEPENDFILE} depend::	${SUBDIRS} ${SUBMAKES}
	@@echo ${DEPENDFILE}
	@@echo "# DO NOT CHANGE THIS FILE" > ${DEPENDFILE}.new
	@@rm -f TMP1
	@@${MAKEINCLUDE} -a ${AFILES} TMP1 -i . ${MYINCL} ${SYSINCLNS} | \
	    sed -e "s/\.asm:/.obj:/" > ${DEPENDFILE}.new
	@@${MAKEINCLUDE} -c ${CFILES} TMP1 -i . ${MYINCL} ${SYSINCLNS} | \
	    sed -e "s/\.c:/.obj:/" >> ${DEPENDFILE}.new
	-@@if test "${FIRSTO}"; \
	    then ( \
	    echo "DEPENDS= \\" >> ${DEPENDFILE}.new; \
	    grep ${FIRSTO} ${DEPENDFILE}.new > TMP1; \
	    sed -e "s/.*://" TMP1 > TMP2; \
	    sed -e "\$$!s/$$/ \\\\/" TMP2 >> ${DEPENDFILE}.new \
	); fi
	@@for i in ${OCMFILES} TMP2 ; do \
	    ( echo $$i | sed -n -e \
	    "s/\(.*\)\.\(o[cC]m\)$$/\1.\2:	\1.obj/p" \
	    >> ${DEPENDFILE}.new ); done;
	@@echo '# DO NOT ADD DEPENDANCIES HERE!' >> ${DEPENDFILE}.new
	@@echo '# THEY WILL BE REMOVED.' >> ${DEPENDFILE}.new
	@@rm -f TMP1 TMP2
	@@mv -f ${DEPENDFILE}.new ${DEPENDFILE}
headers::	${SUBDIRS} ${SUBMAKES}
#	# verify write access to release directory
	@@sh -c 'test -w ${VERDIR}/tools/touchable || \
	    { echo ${VERDIR} not writable ; exit 1; }'
#       # copy over the external includes
	${MMINSTALL} ${EXTINCLNS} ${EXTERNHFILES} ${EXTERNIFILES}
	${MMINSTALL} ${INTINCLNS} ${INTERNHFILES} ${INTERNIFILES}
#       # now, if this is a library, copy over the library interface function
#       # description.  Note that this will not make it
	${MMINSTALL} ${LIBSFD} ${SUBSYSNAME}_lib.sfd
internal::	${SUBDIRS} ${SUBMAKES}
#	# verify write access to release directory
#
#       # make sure the necessary macros are defined
#
#       # make sure everything is checked in and properly labeled
#
#       # copy over all files to the source directory
#
#       # now copy over the external includes in both unstripped and stripped
#	# form.
#
#       # now copy over the autodoc file, if it exists
#
#       # now, if this is a library, copy over the library interface function
#       # description.  Note that this will not make it
#
	@@echo make internal:
	@@sh -c 'test -w ${VERDIR}/tools/touchable || \
	    { echo ${VERDIR} not writable ; exit 1; }'
	@@sh -c 'test "${SRCDIR}" || { echo no SRCDIR macro defined ; exit 1; }'
	@@echo "    making sure everything is checked in..."
	@@${CKRCS} ${VERNUM} ${SRCPATH} ${RCSFILES}
	-@@if test ! "${LIBNAME}"; then ( \
	    echo "    labelling rcs files..."; \
	    if test -r ${SUBSYSNAME}_rev.rev; then \
		${REVLABEL} ${SRCPATH} V${VERNUM}_`cat ${SUBSYSNAME}_rev.rev` \
		    ${RCSFILES}; \
	    fi \
	); fi
	-@@if test ! "${LIBNAME}"; then ( \
	    echo "    copying sources over to server..."; \
	    ${MMINSTALL} ${SRCPATH} ${RCSFILES} \
		${SUBSYSNAME}.lib ${SUBSYSNAME}.ld ${SUBSYSNAME}.ld.strip \
		${SUBSYSNAME}_rev.h ${SUBSYSNAME}_rev.i ${SUBSYSNAME}_rev.rev ${SUBSYSNAME}.info; \
	    echo "    copying includes over to server..."; \
	    ${MMINSTALL} ${EXTINCLNS} ${EXTERNHFILES} \
		${EXTERNIFILES}; \
	    ${MMINSTALL} ${INTINCLNS} ${INTERNHFILES} \
		${INTERNIFILES}; \
	    echo "    copying doc and sfd files over to server..."; \
	    ${MMINSTALL} ${DOCDIR} ${SUBSYSNAME}.doc ; \
	    ${MMINSTALL} ${LIBSFD} ${SUBSYSNAME}_lib.sfd ; \
	    ${MMINSTALL} ${DOCDIR}/Miscdoc ${MISCDOC} \
	); fi
	-@@if test "${LIBNAME}"; then ( \
	    echo make internal -- lib/${LIBNAME}/${SRCDIRPATH}/${SRCDIR}; \
	    mkdir ${LIBDIR}/${LIBNAME}/${SRCDIRPATH}/${SRCDIR}; \
	    ${MMINSTALL} \
		${LIBDIR}/${LIBNAME}/${SRCDIRPATH}/${SRCDIR} \
		${RCSFILES} ${SUBSYSNAME}_lib.lib; \
	); fi
print::	${SUBDIRS} ${SUBMAKES}
	    -@@for i in ${HFILES} ${IFILES} ${CFILES} ${BFILES} ${GFILES} ; do \
		(echo imprint ${PFLAGS} -2 -O -L -J $$i; \
		imprint ${PFLAGS} -2 -O -L -J $$i); done
	    -@@imprintlis ${PFLAGS} -2 -O -L -J ${AFILES}
	    -@@if test -r ${SUBSYSNAME}.doc; then \
		(echo imprint ${PFLAGS} -2 -O -L ${SUBSYSNAME}.doc; \
		imprint ${PFLAGS} -2 -O -L ${SUBSYSNAME}.doc); fi
${SUBSYSNAME}_rev.i ${SUBSYSNAME}_rev.h: ${SUBSYSNAME}_rev.rev \
	    ${OFILES} ${OCMFILES} ${DEPENDS}
${SUBSYSNAME}_rev.rev:
	echo 0 > ${SUBSYSNAME}_rev.rev
	chmod 666 ${SUBSYSNAME}_rev.rev

${SUBSYSNAME}.ld ${SUBSYSNAME}.lmap: ${OFILES} ${OCMFILES} ${FIRSTO} \
	    ${LFILES} ${SUBSYSNAME}.with
	@@`echo ${LFLAGS} | sed -n -e "s/.*XREF=\([^ 	]*\).*/rm -f \1/p"`
	@@`echo ${LFLAGS} | sed -n -e "s/.*MAP=\([^ 	]*\).*/rm -f \1/p"`
	${LINK} with=${SUBSYSNAME}.with ${LFLAGS} to=${SUBSYSNAME}.ld.TMP
	@@${STRIPF} ${SUBSYSNAME}.ld.TMP ${SUBSYSNAME}.ld.strip.TMP
	@@mv ${SUBSYSNAME}.ld.TMP ${SUBSYSNAME}.ld
	@@mv ${SUBSYSNAME}.ld.strip.TMP ${SUBSYSNAME}.ld.strip
	@@chmod a+wx ${SUBSYSNAME}.ld ${SUBSYSNAME}.ld.strip
	@@`echo ${LFLAGS} | sed -n -e "s/.*XREF=\([^ 	]*\).*/chmod a+w \1/p"`
	@@`echo ${LFLAGS} | sed -n -e "s/.*MAP=\([^ 	]*\).*/chmod a+w \1/p"`
${SUBSYSNAME}_lib.lib:	${OFILES} ${OCMFILES} ${FIRSTO}
	rm -f ${SUBSYSNAME}_lib.lib
	cat ${FIRSTO} ${OFILES} ${OCMFILES} > ${SUBSYSNAME}_lib.lib
${SUBSYSNAME}.lib:	${OFILES} ${OCMFILES} ${FIRSTO}
	rm -f ${SUBSYSNAME}.lib
	cat ${FIRSTO} ${OFILES} ${OCMFILES} > ${SUBSYSNAME}.lib
${SUBSYSNAME}.doc:	FRC
	${MAKE} cat
	@@echo ${SUBSYSNAME}.doc
	@@rm -f ${SUBSYSNAME}.doc
	autodoc ${DFLAGS} ${SUBSYSNAME}.cat > ${SUBSYSNAME}.doc
	rm -f ${SUBSYSNAME}.cat
${SUBSYSNAME}.cat:	${SUBMAKES} FRC
	@@echo ${SUBSYSNAME}.cat
	@@rm -f ${SUBSYSNAME}.cat
	@@mkdir TMPD
	@@for i in ${SUBDIRS} TMPD ; do \
	    ( ( cd $$i; cat /dev/null `ls *.cat`; rm -f *.cat ) \
	    >> ${SUBSYSNAME}.cat ); done
	@@cat /dev/null ${AFILES} ${CFILES} >> ${SUBSYSNAME}.cat
	@@rmdir TMPD
cat:	${SUBDIRS} ${SUBMAKES} ${SUBSYSNAME}.cat
hard:	${SUBDIRS} ${SUBMAKES}
	-@@if test "${SUBDIRS}" ; \
	then (\
	    for i in ${SUBDIRS} ; do \
		( cd $$i; make hard ); done; \
	); fi
	@@imprint -2 -L -Plab Makefile ${IFILES} ${AFILES} ${HFILES} ${CFILES} \
	    ${GFILES} ${BFILES}
tags:	${SUBDIRS} ${SUBMAKES} ${AFILES} ${CFILES} ${HFILES}
	@@rm -f tags
	-@@if test "${SUBSYSNAME}"; then ( \
	    ${CTAGS} -t -w -a ${CFILES} ${HFILES} >/dev/null; \
	    ${CXTAGS} ${HFILES} 2>/dev/null | sed "s/ /	/" >>tags; \
	    ${ASMTAGS} ${AFILES} >>tags; \
	    mv tags ${SUBSYSNAME}.tags \
	); fi
	@@for i in ${SUBDIRS} TMPD ; do ( \
	    if test "$$i" != "TMPD"; then ( \
		sed "s/	/	$$i\//" $$i/tags >$$i.tags; \
		rm -f $$i/*.tags \
	    ); fi \
	); done
	@@cat *.tags | sort +0 -1 -u >tags
#co:
#	@@${LDRCS} co ${SRCPATH}
#ci:
#	@@${LDRCS} ci ${SRCPATH}
#uco:
#	@@${LDRCS} uco ${SRCPATH}
#coall::	${SUBDIRS} ${SUBMAKES}
#	@@for i in ${RCSFILES} ; do \
#	    ( export cofile; cofile=${SRCPATH}/RCS/$$i,v ; \
#		if test -r $$cofile; then co $$cofile; fi ); done;
resetrev:: ${SUBDIRS} ${SUBMAKES}
	@@${RESETREV} ${SRCPATH} ${VERNUM} ${SUBSYSNAME}_rev.rev \
		"${SUBDIRS}" ${MAKEFILE}
checklocks:	${SUBDIRS} ${SUBMAKES}
	@@checklocks ${AFILES} ${CFILES} ${BFILES} ${IFILES} ${HFILES} \
	    ${GFILES} ${MAKEFILE} ${MISCSRC} /dev/null
TMPD ${SUBMAKES}: FRC
	${MAKE} -f $@@ ${MFLAGS} ${MARGS}

TMPD ${SUBDIRS}: FRC
	cd $@@; ${MAKE} ${MFLAGS} ${MARGS}

rom:	${SUBSYSNAME}.ld

doc:	${SUBSYSNAME}.doc

FRC: 
@


38.2
log
@Fixed the multiple-directory make doc rule.
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 38.1 91/08/29 18:09:29 peter Exp Locker: peter $
d119 1
a119 1
VERNUM=		39
@


38.1
log
@Bumped VERNUM to 39.
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 38.0 91/07/16 14:45:11 kevin Exp Locker: peter $
d361 2
a362 1
${SUBSYSNAME}.doc:	${SUBSYSNAME}.cat
d374 1
a374 1
	@@cat ${AFILES} ${CFILES} >> ${SUBSYSNAME}.cat
@


38.0
log
@Changed to V38
No longer makes stripped versions of include files
(Peter showed me the way)
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 37.2 91/03/11 19:29:20 kevin Exp Locker: kevin $
d119 1
a119 1
VERNUM=		38
@


37.2
log
@Changed the behaviour of the Miscdoc field to better match
what Bryce wanted.
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 37.1 91/01/04 18:56:42 kevin Exp Locker: kevin $
d119 1
a119 1
VERNUM=		37
d143 1
a143 1
SYSINCL=	${VERDIR}/include.strip
d145 1
a145 1
EXTINCL=	${SYSINCL}/${SUBSYSGROUP}
d147 1
a147 1
INTINCL=	${SYSINCL}/internal
d183 1
a183 1
		inc \"${MYINCL} ${SYSINCL}\"
d273 2
a274 2
	${MMINSTALL} -s ${EXTINCL} ${EXTINCLNS} ${EXTERNHFILES} ${EXTERNIFILES}
	${MMINSTALL} -s ${INTINCL} ${INTINCLNS} ${INTERNHFILES} ${INTERNIFILES}
d314 1
a314 1
	    ${MMINSTALL} -s ${EXTINCL} ${EXTINCLNS} ${EXTERNHFILES} \
d316 1
a316 1
	    ${MMINSTALL} -s ${INTINCL} ${INTINCLNS} ${INTERNHFILES} \
@


37.1
log
@Modified to handle new V37 hierarchy
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.53 90/11/12 15:31:09 kevin Exp Locker: kevin $
d319 3
a321 2
	    ${MMINSTALL} ${DOCDIR} ${SUBSYSNAME}.doc ${MISCDOC}; \
	    ${MMINSTALL} ${LIBSFD} ${SUBSYSNAME}_lib.sfd \
@


36.53
log
@Oops - previous modification set things to 555 instead of 666
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.52 90/11/12 15:16:29 kevin Exp Locker: kevin $
d119 1
a119 1
VERNUM=		36
@


36.52
log
@Insured that the protections on the _rev.rev file allow it to be
read and written by other people.
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.51 90/08/02 10:57:41 kevin Exp Locker: kevin $
d341 1
a341 1
	chmod 555 ${SUBSYSNAME}_rev.rev
@


36.51
log
@Fixed a problem in AINCL that was bombing metacomco assembler.
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.50 90/08/01 21:41:53 kevin Exp $
d86 1
d341 1
d363 1
a363 1
	autodoc ${SUBSYSNAME}.cat > ${SUBSYSNAME}.doc
@


36.50
log
@Set up so that make depend won't use the SYSINCL
directory, rather it will use the non-stripped include files.
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.49 90/08/01 18:26:12 kevin Exp Locker: kevin $
d157 1
a157 1
AINCL=		-i"${MYINCL} ${SYSINCLNS}"
@


36.49
log
@Made the .asm.obj use the ${AINCL} variable rather than the
amalgamation of ${MINCL} and ${SYSINCL} that it had been using.
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.48 90/07/31 10:47:11 kevin Exp Locker: kevin $
d157 1
a157 1
AINCL=		-I -I${MYINCL} -I${SYSINCLNS}
d248 1
a248 1
	@@${MAKEINCLUDE} -a ${AFILES} TMP1 -i . ${MYINCL} ${SYSINCL} | \
d250 1
a250 1
	@@${MAKEINCLUDE} -c ${CFILES} TMP1 -i . ${MYINCL} ${SYSINCL} | \
@


36.48
log
@Modified to make everyone compile from makemeta.nostrip
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.47 90/04/23 10:48:45 rsbx Exp Locker: kevin $
d190 1
a190 1
	    		-i \"${MYINCL} ${SYSINCL}\"; \
d194 1
a194 1
	    		-i \"${MYINCL} ${SYSINCL}\"; \
@


36.47
log
@make clean will now remove *.ld.strip files.
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.46 90/04/05 21:57:23 kevin Exp Locker: rsbx $
d157 2
a158 2
AINCL=		-I -I${MYINCL} -I${SYSINCL}
CINCL=		-I -I${MYINCL} -I${SYSINCL}
@


36.46
log
@Finished of co, ci, and uco.  (Well, it SEEMS
like a good idea...)
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.45 90/04/05 21:55:17 kevin Exp Locker: kevin $
d214 1
a214 1
	rm -f *.obj *.o[cC]m *.ld *.[cs]rec *TMP[' '0-9] *.lis *.xr0 \
@


36.45
log
@Removed coall from makemeta Caveat Release manager!
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.44 90/04/02 20:00:46 kevin Exp $
d127 1
a127 1
LDRCS=		${VERDIR}/tools/sh/ldrcs
d396 6
a401 6
co:
	@@${LDRCS} co ${SRCPATH}
ci:
	@@${LDRCS} ci ${SRCPATH}
uco:
	@@${LDRCS} uco ${SRCPATH}
@


36.44
log
@Added processing for .info files.
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.43 90/04/02 19:43:39 kevin Exp $
d402 4
a405 4
coall::	${SUBDIRS} ${SUBMAKES}
	@@for i in ${RCSFILES} ; do \
	    ( export cofile; cofile=${SRCPATH}/RCS/$$i,v ; \
		if test -r $$cofile; then co $$cofile; fi ); done;
@


36.43
log
@Made the SFD file procesing silent and removed a
few commented out lines.
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.42 90/04/02 13:06:46 rsbx Exp Locker: kevin $
d311 1
a311 1
		${SUBSYSNAME}_rev.h ${SUBSYSNAME}_rev.i ${SUBSYSNAME}_rev.rev; \
@


36.42
log
@Oops! Needed ${VERDIR} not ${VERNUM}.
@
text
@d1 1
a1 1
# $Id: makemeta.nostrip,v 36.41 90/04/02 13:02:15 rsbx Exp Locker: rsbx $
d212 1
a212 4
#	@@echo "*** This file generated on `date`" >$@@ ; \
#	echo "*** DO NOT EDIT: FILE GENERATED AUTOMAGICALLY BY MAKEMETA" >>$@@ ; \
#	cat $*.sfd | sed -e '/^[#;*]/d' -e 's/\([A-Za-z0-9_]*\).*/	FUNCDEF	\1/' >>$@@
	${SFDTOOL} -i $*.sfd
@


36.41
log
@Fixed modulename_lib.i generation from .sfd files.
@
text
@d1 1
a1 1
# $Id$
d134 1
a134 1
SFDTOOL=	${VERNUM}/tools/bin/sfd
@


36.40
log
@Changed .xfd to .sfd.
@
text
@d1 1
a1 1
# $Header: /usr.MC68010/ghostwheel/commodore/amiga/V36/tools/RCS/makemeta.nostrip,v 36.39 90/03/24 22:12:17 kevin Exp Locker: rsbx $
a126 1
#FD2I=		${VERDIR}/tools/fd2i.sed
d134 1
d212 4
a215 3
	@@echo "*** This file generated on `date`" >$@@ ; \
	echo "*** DO NOT EDIT: FILE GENERATED AUTOMAGICALLY BY MAKEMETA" >>$@@ ; \
	cat $*.sfd | sed -e '/^[#;*]/d' -e 's/\([A-Za-z0-9_]*\).*/	FUNCDEF	\1/' >>$@@
@


36.39
log
@Updated to handle XFD files instead of FD files.
@
text
@d1 1
a1 1
# $Header: makemeta.nostrip,v 36.38 90/01/27 15:52:49 kodiak Exp $
d151 1
a151 1
AUTOFD=		${LIBDIR}/autofd
d156 1
a156 1
		${MAKEFILE} ${MISCSRC} ${MISCDOC} ${SUBSYSNAME}_lib.xfd
d161 1
a161 1
.SUFFIXES:	.h .i .xfd .rev .ld .oCm .ocm .obj .c .b .asm
d209 1
a209 1
.xfd.i:
d214 1
a214 1
	cat $*.xfd | sed -e '/^[#;*]/d' -e 's/\([A-Za-z0-9_]*\).*/	FUNCDEF	\1/' >>$@@
d278 1
a278 1
	${MMINSTALL} ${AUTOFD} ${SUBSYSNAME}_lib.xfd
d319 1
a319 1
	    echo "    copying doc and xfd files over to server..."; \
d321 1
a321 1
	    ${MMINSTALL} ${AUTOFD} ${SUBSYSNAME}_lib.xfd \
@


36.38
log
@add .lib (for graphics submakes) and .ld.strip to make internal update list
@
text
@d1 1
a1 1
# $Header: makemeta.nostrip,v 36.37 90/01/19 13:25:52 kodiak Exp $
d156 1
a156 1
		${MAKEFILE} ${MISCSRC} ${MISCDOC} ${SUBSYSNAME}_lib.fd
d161 1
a161 1
.SUFFIXES:	.h .i .fd .rev .ld .oCm .ocm .obj .c .b .asm
d209 1
a209 1
.fd.i:
d214 1
a214 1
	cat $*.fd | sed -e '/^[#;*]/d' -e 's/\([A-Za-z0-9_]*\).*/	FUNCDEF	\1/' >>$@@
d278 1
a278 1
	${MMINSTALL} ${AUTOFD} ${SUBSYSNAME}_lib.fd
d319 1
a319 1
	    echo "    copying doc and fd files over to server..."; \
d321 1
a321 1
	    ${MMINSTALL} ${AUTOFD} ${SUBSYSNAME}_lib.fd \
@


36.37
log
@add stripf line to ${SUBSYSNAME}.ld make rule to make ${SUBSYSNAME}.ls.strip
@
text
@d1 1
a1 1
# $Header: makemeta.nostrip,v 36.36 89/12/12 13:17:51 rsbx Exp $
d311 2
a312 1
	    ${MMINSTALL} ${SRCPATH} ${RCSFILES} ${SUBSYSNAME}.ld \
@


36.36
log
@Change .fd to .i rule to use Kodiak's slick sed line.
@
text
@d1 1
a1 1
# $Header: makemeta.nostrip,v 36.35 89/11/28 15:51:17 rsbx Exp $
d134 1
d347 1
d349 2
a350 1
	@@chmod a+wx ${SUBSYSNAME}.ld
@


36.35
log
@Changed .fd.i rule to used sed instead of emacs.
@
text
@d1 1
a1 1
# $Header: makemeta.nostrip,v 36.34 89/11/28 15:35:05 rsbx Exp $
d127 1
a127 1
FD2I=		${VERDIR}/tools/fd2i.sed
d211 3
a213 1
	@@echo "*** This file generated on `date`" >$@@ ; cat $*.fd | sed -f ${FD2I} >>$@@
@


36.34
log
@Taking over makemeta from Kodiak
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.33 89/07/17 11:56:18 kodiak Exp $
d127 1
d211 1
a211 1
	@@emacs -l${VERDIR}/tools/gen-lib -egen-lib $* i
@


36.33
log
@tags: rule more robust
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.32 89/07/17 10:43:38 kodiak Exp $
d357 1
d363 2
a364 2
	    ( ( cd $$i; cat /dev/null `ls *.cat` ) >> ${SUBSYSNAME}.cat \
	    ); done
d377 2
a378 2
	rm -f tags
	-if test "${SUBSYSNAME}"; then ( \
d384 1
a384 1
	for i in ${SUBDIRS} TMPD ; do ( \
d390 1
a390 1
	cat *.tags | sort +0 -1 -u >tags
@


36.32
log
@add tags: rule
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.31 89/07/02 14:24:42 kodiak Exp $
d375 15
a389 7
tags:	${AFILES} ${CFILES} ${HFILES}
	@@rm -f tags
	@@${CTAGS} -t -w -a ${CFILES} ${HFILES} >/dev/null
	@@${CXTAGS} ${HFILES} >>tags 2>/dev/null
	@@${ASMTAGS} ${AFILES} >>tags
	@@sort +0 -1 -u tags >tags.sorted
	@@mv tags.sorted tags
@


36.31
log
@make resetrev rule ::
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.30 89/06/29 16:03:07 kodiak Exp $
d122 1
d133 1
d135 2
d375 7
@


36.30
log
@use local tools
look only at MAKEFILE for resetrev
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.29 89/06/19 13:14:39 kodiak Exp $
d381 1
a381 1
resetrev: ${SUBDIRS} ${SUBMAKES}
@


36.29
log
@add resetrev: rule
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.28 89/04/15 14:21:21 kodiak Exp $
d121 3
d127 1
a131 3
CPP=		/lib/cpp
ASM=		cassem
BCPL=		bcpl
a132 1
LINK=		alink
a133 1
NEWROMS=	/usr/commodore/bin/newroms
d195 1
a195 1
	@@atom $*.obj $*.obj.TMP -CCDB
d199 1
a199 1
	@@atom $*.obj $*.obj.TMP -CDB -PC
d383 1
a383 1
		"${SUBDIRS}" ${RCSFILES}
@


36.28
log
@remove ${SUBSYSNAME}.lib from make internal MMINSTALL line
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.27 89/04/11 15:02:54 kodiak Exp $
d126 1
d167 2
a168 2
	    mv $*.asm.TMP $*.asm; ); fi
	@@if test "${CAPP2}"; then ( \
d170 1
a170 1
	    mv $*.asm.TMP $*.asm; ); fi
d382 3
@


36.27
log
@add CAPP2 compile option
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.26 89/04/11 13:37:36 kodiak Exp $
d303 1
a303 2
	    ${MMINSTALL} ${SRCPATH} ${RCSFILES} \
		${SUBSYSNAME}.ld ${SUBSYSNAME}.lib \
@


36.26
log
@eliminate double bumping (associated w/ change in sh/bumprev)
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.25 89/04/11 12:57:52 kodiak Exp $
d164 8
a171 11
	@@if test "${CAPP}"; \
	    then( \
		${CAPP} < $*.asm > $*.asm.TMP; \
		${ASM} $*.asm.TMP -o $@@.TMP -c q,a${SYMBOLOPT} ${CAFLAGS}; \
		rm -f $*.asm $*.asm.TMP; \
	    ); else( \
		${ASM} $*.asm -o $*.obj.TMP -c q,a${SYMBOLOPT} ${CAFLAGS}; \
		rm -f $*.asm; \
		); \
	    fi
	@@rm -f $@@
@


36.25
log
@let bumprev see .[hi] file before releasing it
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.24 89/04/11 12:50:29 kodiak Exp $
d205 1
a205 1
	@@${BUMPREV} ${VERNUM} $*
@


36.24
log
@add SUBMAKES dependency to coall: rule
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.23 89/04/07 12:58:00 kodiak Exp $
a204 1
	@@rm -f $@@
@


36.23
log
@copy .ld file over to server in make internal
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.22 89/04/07 12:52:06 kodiak Exp $
d382 1
a382 1
coall::	${SUBDIRS}
@


36.22
log
@fix make internal bugs
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.21 89/04/07 10:15:36 kodiak Exp $
d307 2
a308 1
	    ${MMINSTALL} ${SRCPATH} ${RCSFILES} ${SUBSYSNAME}.lib \
@


36.21
log
@use makeinclude from tools/bin
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.20 89/04/07 09:27:48 kodiak Exp $
d292 1
d296 1
d299 1
a299 1
	    echo make internal: ${SRCDIRPATH}/${SRCDIR}; \
d302 8
a309 4
		    ${RCSFILES} \
	    fi; \
	    ${MMINSTALL} ${SRCPATH} ${RCSFILES} ${SUBSYSNAME}.lib; \
		${SUBSYSNAME}_rev.h ${SUBSYSNAME}_rev.i ${SUBSYSNAME}_rev.rev \
d314 1
@


36.20
log
@make RCSFILES equate
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.19 89/04/04 14:43:58 kodiak Exp $
d121 1
d124 1
a132 1
BUMPREV=	${VERDIR}/tools/sh/bumprev
d246 1
a246 1
	@@makeinclude -a ${AFILES} TMP1 -i . ${MYINCL} ${SYSINCL} | \
d248 1
a248 1
	@@makeinclude -c ${CFILES} TMP1 -i . ${MYINCL} ${SYSINCL} | \
@


36.19
log
@revise make coall to use equates from Makefile for "all" description
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.18 89/02/08 17:48:39 kodiak Exp $
d147 3
d294 1
a294 3
	@@${CKRCS} ${VERNUM} ${SRCPATH} ${AFILES} ${CFILES} ${BFILES} ${HFILES} \
	    ${IFILES} ${GFILES} ${MAKEFILE} ${MISCSRC} ${MISCDOC} \
	    ${SUBSYSNAME}_lib.fd
d299 1
a299 2
		    ${AFILES} ${CFILES} ${BFILES} ${IFILES} ${HFILES} \
		    ${GFILES} ${MAKEFILE} ${MISCSRC} ${MISCDOC}; \
d301 1
a301 2
	    ${MMINSTALL} ${SRCPATH} \
		${AFILES} ${CFILES} ${BFILES} ${HFILES} ${IFILES} ${GFILES} \
a302 1
		${MAKEFILE} ${MISCSRC} ${SUBSYSNAME}_lib.fd ${SUBSYSNAME}.lib; \
d315 1
a315 2
		${AFILES} ${CFILES} ${BFILES} ${IFILES} ${HFILES} ${GFILES} \
		${MAKEFILE} ${MISCSRC} ${MISCDOC} ${SUBSYSNAME}_lib.lib; \
d374 1
a374 3
	@@for i in ${AFILES} ${CFILES} ${BFILES} ${HFILES} \
	    ${IFILES} ${GFILES} ${MAKEFILE} ${MISCSRC} ${MISCDOC} \
	    ${SUBSYSNAME}_lib.fd ; do \
@


36.18
log
@add .fd to CKRCS list
make coall a :: rule
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.17 89/02/06 12:49:27 kodiak Exp $
d377 5
a381 1
	@@find ${SRCPATH}/RCS -type f -exec co '{}' \;
@


36.17
log
@add SUBDIRS dependency to coall
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.16 89/01/30 10:30:07 kodiak Exp $
d292 2
a293 1
	    ${IFILES} ${GFILES} ${MAKEFILE} ${MISCSRC} ${MISCDOC}
d376 1
a376 1
coall:	${SUBDIRS}
@


36.16
log
@add uco: rule
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.15 89/01/26 18:24:56 kodiak Exp $
d375 1
a375 1
coall:
@


36.15
log
@added coall, changed makevers to bumprev
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.14 89/01/10 18:56:11 kodiak Exp $
d371 4
a376 2
ci:
	@@${LDRCS} ci ${SRCPATH}
@


36.14
log
@change make internal for rcs files on server
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.13 88/11/23 17:42:35 kodiak Exp $
d122 1
d131 1
a131 1
MAKEVERS=	makevers
d202 1
a202 1
	${MAKEVERS} ${VERNUM} `basename $* _rev` _rev
d296 3
a298 3
		${REVLABEL} V${VERNUM}_`cat ${SUBSYSNAME}_rev.rev` ${AFILES} \
		    ${CFILES} ${BFILES} ${IFILES} ${HFILES} ${GFILES} \
		    ${MAKEFILE} ${MISCSRC} ${MISCDOC}; \
d369 6
a382 3

installrom:
	cp ${SUBSYSNAME}.ld ${DESTDIR}
@


36.13
log
@refer to both batgirl & ghostwheel as "vhost" in RELNODE
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.12 88/11/23 14:19:22 kodiak Exp $
d120 13
a132 1
RELNODE=	vhost
a148 8
CPP=		/lib/cpp
ASM=		cassem
BCPL=		bcpl
CC=		nmetacc
LINK=		alink
MAKE=		make
MAKEVERS=	makevers
NEWROMS=	/usr/commodore/bin/newroms
d261 3
d265 2
a266 4
	diffinstall ${RELNODE} ${EXTINCLNS} ${EXTERNHFILES} ${EXTERNIFILES}
	diffinstall ${RELNODE} ${INTINCLNS} ${INTERNHFILES} ${INTERNIFILES}
	stripinstall ${RELNODE} ${EXTINCL} ${EXTERNHFILES} ${EXTERNIFILES}
	stripinstall ${RELNODE} ${INTINCL} ${INTHERNFILES} ${INTERNIFILES}
d269 1
a269 4
	-if test -r ${SUBSYSNAME}_lib.fd; \
	    then ( \
	    diffinstall ${RELNODE} ${AUTOFD} ${SUBSYSNAME}_lib.fd \
	    ); fi
d271 2
d287 2
a288 1

d290 2
a291 2
	@@checklocks ${AFILES} ${CFILES} ${BFILES} ${IFILES} ${HFILES} \
	    ${GFILES} ${MAKEFILE} ${MISCSRC} ${MISCDOC};
d295 1
a295 1
		revlabel L${VERNUM}_`cat ${SUBSYSNAME}_rev.rev` ${AFILES} \
d299 1
a299 2
	    rsh ${RELNODE} mkdir ${SRCPATH}; \
	    diffinstall ${RELNODE} ${SRCPATH} \
d303 1
a303 1
	    diffinstall ${RELNODE} ${EXTINCLNS} ${EXTERNHFILES} \
d305 1
a305 1
	    diffinstall ${RELNODE} ${INTINCLNS} ${INTERNHFILES} \
d307 2
a308 8
	    stripinstall ${RELNODE} ${EXTINCL} ${EXTERNHFILES} \
		${EXTERNIFILES}; \
	    stripinstall ${RELNODE} ${INTINCL} ${INTERNHFILES} \
		${INTERNIFILES}; \
	    diffinstall ${RELNODE} ${DOCDIR} ${SUBSYSNAME}.doc ${MISCDOC}; \
	    if test -r ${SUBSYSNAME}_lib.fd; then ( \
		diffinstall ${RELNODE} ${AUTOFD} ${SUBSYSNAME}_lib.fd \
	    ); fi; \
d312 2
a313 3
	    rsh ${RELNODE} mkdir \
		${LIBDIR}/${LIBNAME}/${SRCDIRPATH}/${SRCDIR}; \
	    diffinstall ${RELNODE} \
d319 1
a319 1
	    -@@for i in ${HFILES} ${IFILES} ${CFILES} ${GFILES} ${BFILES} ; do \
@


36.12
log
@add include options to bcpl make rule
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.11 88/09/14 10:24:59 neil Exp $
d120 1
a120 1
RELNODE=	batgirl
@


36.11
log
@fixed the chmod line for .ld files to be in legal unix syntax
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.10 88/09/14 09:52:08 kodiak Exp $
d169 2
a170 1
	@@${BCPL} $*.b $*.obj.TMP opt G200W40000-V obj a
@


36.10
log
@make .ld file created executable
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.9 88/07/14 16:06:14 kodiak Exp $
d339 1
a339 1
	@@chmod a+w a+x ${SUBSYSNAME}.ld
@


36.9
log
@forget how to make .srec stuff
release _rev.[hi] files
forget how to push to roms/ and disk/ (method is obsolete)
make .ld .xref and .lmap files writable
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.8 88/07/01 10:46:27 kodiak Exp $
d339 1
a339 1
	@@chmod a+w ${SUBSYSNAME}.ld
@


36.8
log
@change include, include.nostrip to include.strip, include
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.7 88/06/07 19:31:41 neil Exp $
a89 2
#  MUNGEFLAGS	Additional options to mungesrec.
#		For example "-k 256"
d106 1
a106 1
#		INTINCL, INTINCLNS, LIBDIR, ROMDIR, and CARTDIR live,
a128 1
ROMDIR=		${VERDIR}/roms
a129 1
DISKDIR=	${VERDIR}/disk
a141 2
CONVERT=	convert
SREC=		absload
a143 1
MUNGE=		mungesrec
d146 1
a146 2
.SUFFIXES:	.h .i .fd .rev .odd .even .smap .srec .cmap .crec .dl \
		.ld .lmap .oCm .ocm .obj .c .b .asm
a193 16
.ld.dl:
	@@rm -f $@@
	${CONVERT} <$< >$@@
.ld.srec .ld.smap:
	${SREC} -m -o $*.srec -T ${SSTART} -x -s $< >$*.smap
.ld.crec .ld.cmap:
	@@echo "[+]sa16o16i${SSTART} _C0000 ${CSTART}z2=apq" >dc.TMP
	@@echo "${SREC} -m -o $*.crec -T `dc dc.TMP` -x -s $< >$*.cmap"
	@@${SREC} -m -o $*.crec -T `dc dc.TMP` -x -s $< >$*.cmap
	@@rm dc.TMP
.srec.even:
	${MUNGE} -s ${START} ${MUNGEFLAGS} -e $< > $@@.TMP
	mv $@@.TMP $@@
.srec.odd:
	${MUNGE} -s ${START} ${MUNGEFLAGS} -o $< > $@@.TMP
	mv $@@.TMP $@@
a281 3
#       # now release the executable files and associated map files to the
#       # proper directories.
#
d296 2
a297 2
		${MAKEFILE} ${MISCSRC} ${SUBSYSNAME}_rev.rev \
		${SUBSYSNAME}_lib.fd ${SUBSYSNAME}.lib; \
a309 11
	    if test "${DISKPATH}"; then ( \
		stripa ${SUBSYSNAME}.ld to ${SUBSYSNAME}.ld.strip; \
		rcp ${SUBSYSNAME}.ld.strip \
		    ${RELNODE}:${DISKDIR}/${DISKPATH}.`cat \
		    ${SUBSYSNAME}_rev.rev`; \
	    ); \
	    elif test -r ${SUBSYSNAME}.ld; then ( \
		    rcp ${SUBSYSNAME}.ld \
			${RELNODE}:${ROMDIR}/${SUBSYSNAME}`cat \
			${SUBSYSNAME}_rev.rev`.ld; \
	    ); fi; \
d335 2
d339 3
@


36.7
log
@changed assembly path so it will notice errors (it used to continue
right on, even though an assembly failed).
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.6 88/05/25 13:56:10 kodiak Exp $
d124 2
a125 2
SYSINCL=	${VERDIR}/include
SYSINCLNS=	${VERDIR}/include.nostrip
@


36.6
log
@strip .ld files destined for DISKPATH
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.5 88/03/08 11:28:13 kodiak Exp $
d163 1
a163 1
	-@@if test "${CAPP}"; \
d166 1
a166 1
		${ASM} $*.asm.TMP -o $*.obj.TMP -c q,a${SYMBOLOPT} ${CAFLAGS}; \
d168 1
a168 3
		mv -f $*.obj.TMP $@@; \
		); \
	    else( \
a170 1
		mv -f $*.obj.TMP $@@; \
d173 2
d181 1
a181 1
	-@@if test "${APP}"; \
d184 1
a184 1
		${ASM} $*.asm.TMP -o $*.obj.TMP -c q,a${SYMBOLOPT} ${AFLAGS} \
d187 2
a188 4
		mv -f $*.obj.TMP $@@; \
		); \
	    else( \
		${ASM} $*.asm -o $*.obj.TMP -c q,a${SYMBOLOPT} ${AFLAGS} \
a189 1
		mv -f $*.obj.TMP $@@; \
d192 2
@


36.5
log
@first pass at teaching about BCPL rules
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.4 88/03/07 13:53:18 kodiak Exp $
d340 2
a341 1
		rcp ${SUBSYSNAME}.ld \
@


36.4
log
@unteach install & headers rules about making include directories
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.3 88/03/07 13:40:28 kodiak Exp $
d143 1
d154 1
a154 1
		.ld .lmap .oCm .ocm .obj .c .asm
d176 4
d313 2
a314 2
	@@checklocks ${AFILES} ${CFILES} ${IFILES} ${HFILES} \
	    ${MAKEFILE} ${MISCSRC} ${MISCDOC};
d319 2
a320 2
		    ${CFILES} ${IFILES} ${HFILES} ${MAKEFILE} \
		    ${MISCSRC} ${MISCDOC}; \
d324 3
a326 3
		${AFILES} ${CFILES} ${HFILES} ${IFILES} ${MAKEFILE} \
		${MISCSRC} ${SUBSYSNAME}_rev.rev ${SUBSYSNAME}_lib.fd \
		${SUBSYSNAME}.lib; \
d356 2
a357 2
		${AFILES} ${CFILES} ${IFILES} ${HFILES} ${MAKEFILE} \
		${MISCSRC} ${MISCDOC} ${SUBSYSNAME}_lib.lib; \
d360 1
a360 1
	    -@@for i in ${HFILES} ${IFILES} ${CFILES} ; do \
d402 2
a403 1
	@@imprint -2 -L -Plab Makefile ${IFILES} ${AFILES} ${HFILES} ${CFILES}
d405 2
a406 2
	@@checklocks ${AFILES} ${CFILES} ${IFILES} ${HFILES} \
	    ${MAKEFILE} ${MISCSRC} /dev/null
@


36.3
log
@(oops)
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.2 88/03/07 13:36:52 kodiak Exp $
a277 1
	-rsh ${RELNODE} mkdir ${EXTINCL} ${EXTINCLNS} ${INTINCL} ${INTINCLNS}
d317 1
a317 1
	    rsh ${RELNODE} mkdir ${SRCPATH} ${NSINCLDIR} ${INCLDIR}; \
@


36.2
log
@moved autofd .fd files up to single level
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.1 88/03/01 12:45:49 kodiak Exp $
d287 1
a287 2
	    diffinstall ${RELNODE} ${AUTOFD}/${SUBSYSNAME} \
		${SUBSYSNAME}_lib.fd \
d333 1
a333 2
		diffinstall ${RELNODE} ${AUTOFD}/${SUBSYSNAME} \
		    ${SUBSYSNAME}_lib.fd \
@


36.1
log
@eliminate /internal/ directory
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 36.0 88/03/01 09:54:14 kodiak Exp $
d23 2
d153 1
a153 1
		.ld .lmap .ocm .obj .c .asm
d191 4
d223 1
a223 1
	rm -f *.obj *.ocm *.ld *.[cs]rec *TMP[' '0-9] *.lis *.xr0 *.[csl]map \
d225 1
a225 1
	    *.cat *.xref core *.lib
d269 2
a270 1
	    ( echo $$i | sed -n -e "s/\(.*\)\.ocm$$/\1.ocm:	\1.obj/p" \
a286 1
	    rsh ${RELNODE} mkdir ${AUTOFD}/${SUBSYSNAME}; \
a333 1
		rsh ${RELNODE} mkdir ${AUTOFD}/${SUBSYSNAME}; \
@


36.0
log
@change to V36
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 35.5 88/02/01 15:00:27 kodiak Exp $
d34 4
d42 1
a42 1
#		INCLDIR and NSINCLDIR
d44 3
d51 2
a52 2
#  EXTERNHFILES	All the C include files released to others in INCLDIR
#		and NSINCLDIR
d54 3
a71 4
#  SRCDIRPATH	The major directory name that the SRCDIR is within,
#		i.e. a directory at the nominal SRCDIR level that is
#		the parent of this SRCDIR, used for source storage
#		only.
d105 4
a108 5
#  VERDIR	The directory within which SRCDIR, INCLDIR, NSINCLDIR,
#		LIBDIR, ROMDIR, and CARTDIR live, and which contains the
#		system include directory
#  TERNAL	Whether to use .../internal/... or .../external/...
#  SYSINCL	The system include directory
a119 1
TERNAL=		internal
d121 11
a131 7
SRCPATH=	${VERDIR}/${TERNAL}/src/${SRCDIRPATH}/${SRCDIR}
INCLDIR=	${VERDIR}/${TERNAL}/include/${SUBSYSGROUP}
NSINCLDIR=	${VERDIR}/${TERNAL}/include.nostrip/${SUBSYSGROUP}
LIBDIR=		${VERDIR}/${TERNAL}/lib
ROMDIR=		${VERDIR}/${TERNAL}/roms
DOCDIR=		${VERDIR}/${TERNAL}/doc
DISKDIR=	${VERDIR}/${TERNAL}/disk
d135 1
a135 2
LFILES=		${MYLIBS} ${VERDIR}/${TERNAL}/lib/amiga.lib
SYSINCL=	${VERDIR}/${TERNAL}/include
a172 3
#	@@${ASM} $*.asm.TMP -o $*.obj.TMP -c q,a${SYMBOLOPT} ${CAFLAGS}
#	@@rm -f $*.asm $*.asm.TMP
#	@@mv -f $*.obj.TMP $@@
a188 4
#	@@${ASM} $*.asm.TMP -o $*.obj.TMP -c q,a${SYMBOLOPT} ${AFLAGS} \
#	    -i \"${MYINCL} ${SYSINCL}\"
#	@@rm -f $*.asm.TMP
#	@@mv -f $*.obj.TMP $@@
d271 5
a275 3
	-rsh ${RELNODE} mkdir ${NSINCLDIR} ${INCLDIR}
	diffinstall ${RELNODE} ${NSINCLDIR} ${EXTERNHFILES} ${EXTERNIFILES}
	stripinstall ${RELNODE} ${INCLDIR} ${EXTERNHFILES} ${EXTERNIFILES}
d318 1
a318 1
	    diffinstall ${RELNODE} ${NSINCLDIR} ${EXTERNHFILES} \
d320 3
a322 1
	    stripinstall ${RELNODE} ${INCLDIR} ${EXTERNHFILES} \
d324 2
@


35.5
log
@recommented
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 35.4 87/12/28 16:43:08 kodiak Exp $
d113 1
a113 1
VERNUM=		35
@


35.4
log
@add support for dual include and include.nostrip directories
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 35.3 87/12/23 11:46:44 kodiak Exp $
d289 2
a290 1
#       # now copy over the external includes
@


35.3
log
@remove VERSION altogether, use VERNUM instead
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 35.2 87/12/23 11:32:36 kodiak Exp $
d38 1
a38 1
#		INCLDIR
d45 1
a45 1
#		(e.g. ${VERDIR}/${TERNAL}/include/exec)
d99 3
a101 3
#  VERDIR	The directory within which SRCDIR, INCLDIR, LIBDIR,
#		ROMDIR, and CARTDIR live, and which contains the system
#		include directory
d119 1
d271 3
a273 2
	-rsh ${RELNODE} mkdir ${INCLDIR}
	diffinstall ${RELNODE} ${INCLDIR} ${EXTERNHFILES} ${EXTERNIFILES}
d310 1
a310 1
	    rsh ${RELNODE} mkdir ${SRCPATH} ${INCLDIR}; \
d315 3
a317 1
	    diffinstall ${RELNODE} ${INCLDIR} ${EXTERNHFILES} \
@


35.2
log
@bad SRCPATHDIR changed to SRCDIRPATH
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 35.1 87/12/23 11:00:26 kodiak Exp $
d91 3
a93 3
#  VERSION	The version of code being produced, and the suffix of 
#		the VERDIR directory /usr/commodore/amiga/V${VERSION}
#  VERNUM	The software version that should be in libraries and
a112 1
VERSION=	35
d114 1
a114 1
VERDIR=		/usr/commodore/amiga/V${VERSION}
d125 1
a125 1
DEPENDFILE=	${SUBSYSNAME}${VERSION}.depend
@


35.1
log
@move imprintlis to /usr/commodore/binNN
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 35.0 87/12/23 10:59:06 kodiak Exp $
d334 1
a334 1
	    echo make internal -- lib/${LIBNAME}/${SRCPATHDIR}/${SRCDIR}; \
d336 1
a336 1
		${LIBDIR}/${LIBNAME}/${SRCPATHDIR}/${SRCDIR}; \
d338 1
a338 1
		${LIBDIR}/${LIBNAME}/${SRCPATHDIR}/${SRCDIR} \
@


35.0
log
@bring V35 version under source control
@
text
@d1 1
a1 1
 # $Header: makemeta.nostrip,v 33.3 86/03/08 12:40:59 neil Exp $
d346 1
a346 2
	    -@@${VERDIR}/tools/imprintlis \
		${PFLAGS} -2 -O -L -J ${AFILES}
@
