#include <exec/types.h>
#include <clib/exec_protos.h>
#include <clib/dos_protos.h>
#include <pragmas/exec_pragmas.h>
#include <pragmas/dos_pragmas.h>
#include "/mpeg.h"

ULONG OpenTest(VOID)
{
    struct Library *SysBase = *(struct Library **)4L;
    struct Library *DOSBase;

    struct MsgPort *port;
    struct IOMPEGReq *iomr;

    if(DOSBase = OpenLibrary("dos.library",37L))
    {
    	if(port = CreateMsgPort())
    	{
    	    if(iomr = (struct IOMPEGReq *)CreateIORequest(port,sizeof(struct IOMPEGReq)))
    	    {
    	    	if(!OpenDevice("cd32mpeg.device",0,(struct IORequest *)iomr,0))
    	    	{
    	    	    PutStr("Device opened okay.\n");
    	    	    CloseDevice((struct IORequest *)iomr);
    	    	}
    	    	else
    	    	    PutStr("Device open failed.\n");

    	    	DeleteIORequest((struct IORequest *)iomr);
    	    }
    	    DeleteMsgPort(port);
    	}
    	CloseLibrary(DOSBase);
    }
    return(0L);
}