head     40.7;
branch   ;
access   ;
symbols  ;
locks    ; strict;
comment  @@;


40.7
date     93.05.07.11.10.13;  author vertex;  state Exp;
branches ;
next     40.6;

40.6
date     93.05.07.10.59.18;  author vertex;  state Exp;
branches ;
next     40.5;

40.5
date     93.05.06.13.54.19;  author jerryh;  state Exp;
branches ;
next     40.4;

40.4
date     93.04.28.14.00.14;  author vertex;  state Exp;
branches ;
next     40.3;

40.3
date     93.04.28.11.30.19;  author vertex;  state Exp;
branches ;
next     40.2;

40.2
date     93.04.28.11.02.29;  author vertex;  state Exp;
branches ;
next     40.1;

40.1
date     93.04.28.10.22.30;  author vertex;  state Exp;
branches ;
next     1.6;

1.6
date     93.04.28.10.21.23;  author vertex;  state Exp;
branches ;
next     1.5;

1.5
date     93.04.27.17.27.55;  author vertex;  state Exp;
branches ;
next     1.4;

1.4
date     93.03.03.10.38.40;  author jerryh;  state Exp;
branches ;
next     1.3;

1.3
date     93.02.11.11.24.03;  author jerryh;  state Exp;
branches ;
next     1.2;

1.2
date     93.02.11.09.36.08;  author jerryh;  state Exp;
branches ;
next     1.1;

1.1
date     93.02.10.15.39.23;  author jerryh;  state Exp;
branches ;
next     ;


desc
@notes to a developer on how to write an AmigaCD title.
@


40.7
log
@*** empty log message ***
@
text
@
                     Tips For Developing An AmigaCD Title
                     ------------------------------------

Last Revised: $Date: 93/05/07 10:59:18 $ $Revision: 40.6 $


This document presents many issues relevant to developers creating titles for
the AmigaCD console. Additional documentation can be found in the autodocs and
include files for the standard Amiga system software, and AmigaCD-specific
extensions.


CDTV Compatibility
------------------

Although the AmigaCD console can run most CDTV titles, we recommend you do not
use any of the old CDTV-specific system modules. These modules were only
slightly modified in order to make existing CDTV titles work on AmigaCD. There
are some known bugs and limitations in these modules when dealing with the new
hardware of the AmigaCD.

Another good reason to avoid using CDTV-specific system modules is that in the
future, our intent is to support running AmigaCD titles from a properly
configured Amiga computer. On these systems, CDTV-specific modules will not
exist, and therefore any titles relying on them will not function.

These are the CDTV-specific modules you should avoid using in any AmigaCD title:

    - cdtv.device

    - playerprefs.library

    - bookmark.device

    - cardmark.device

    - debox.library

    - rmtm

    - CDTVPrefs

Five special system modules were created for the AmigaCD console:

    - lowlevel.library

    - nonvolatile.library

    - freeanim.library

    - cd.device

    - CD-ROM file system

You can use these modules with confidence. lowlevel.library,
nonvolatile.library and the CD-ROM file system will be part of Workbench 3.1
and will be shipped within the 3.1 Enhancer kits and with new machines that
include Workbench 3.1. freeanim.library will not be included with the normal
Workbench distribution, but your code does not need to rely on its presence
(see below for more on this). Finally, cd.device will be included with any
AmigaCD-compatible solution that Commodore would potentially offer for its
computer systems.


Trademark File
--------------

In order to get a title to boot on an AmigaCD, an AmigaCD trademark file must
be included directly after the PVD sectors. CDTV supported having the trademark
file either right after the PVD sectors, or as a normal file in the root of the
CD directory structure. This is not the case with AmigaCD, the trademark file
must be included after the PVD sectors.

The AmigaCD trademark file differs from the CDTV one. This is how AmigaCD
determines if a title is a CDTV title of an AmigaCD title. Contact CATS for
information on obtaining the trademark file if you plan on generating your own
ISO images. In order to ensure the trademark file gets placed directly after
the PVD sectors, do not simply copy it to your CD's directory. Instead make
sure that the trademark file is in the directory you are currently CD'd to
(probably where ISOCD is located) when creating your ISO image.

Note that use of the trademark file requires a CD License Agreement with
Commodore. Contact CATS for licensing information.

The type of trademark file on a CD determines the environment in which the
title is started. If a CDTV trademark file is found, the title is booted in ECS
mode. If an AmigaCD trademark is found, the title is booted directly in AA
mode. In addition, many system kludges are applied on a per-title basis when
booting CDTV titles in order to keep them working on the AmigaCD.


Booting A Title
---------------

AmigaCD boots just like a normal Amiga. The only available boot device is
normally the CD (CD0:), so the system boots off the CD in the same manner it
would boot from a hard drive, executing a startup-sequence et al.

Competing game consoles generally have instantaneous startup times for titles,
due to the cartridge interface used. AmigaCD benefits in many ways from its
CD-ROM technology, booting time is not one of these benefits. Due to the very
slow seek times of CD-ROM devices, the dynamics of disk IO is quite a bit
different from a hard drive. It is crucial that developers be aware of this
situation and take appropriate actions to reduce boot times.

The startup animation sequence provided by the AmigaCD ROM has some continuous
motion to indicate that the system is doing something while a title is booting.
This animation sequence requires little memory and gets out of the way as soon
as the title is ready to run. This animation helps eliminate the long periods
of black screen visible when booting a CDTV.

An important factor in bootup time is the length of the startup-sequence
executed by the system prior to running a title. The startup-sequence shipped
with standard Amiga systems is intended for use in a multitasking computer
environment. Understanding the startup-sequence, and optimizing it can help
reduce bootup time considerably.

The following is a startup-sequence which is adequate for most titles. It is
much smaller and many times faster than the standard startup-sequence provided
with Workbench 3.1. It also leaves noticeably more memory for your title than
the standard startup-sequence.

*******

C:SetPatch QUIET

; Only include this line if you are using locale.library
C:Assign >NIL: LOCALE: SYS:Locale

; here you can add any assignments that are specific to your title.
C:Assign >NIL: WestChesterWarrior: SYS:WestChesterWarrior

; Only include these lines if you include the corresponding monitor files
; on your disc. Only include the files on the disc if you actually use the
; modes these monitors provide. Each monitor included eats up memory
; and takes time to load and run.
DEVS:Monitors/NTSC
DEVS:Monitors/PAL
DEVS:Monitors/DblNTSC
DEVS:Monitors/DblPAL

; here you just start your title
SYS:WestChesterWarrior

*******

Note that using explicit path specifications (C:Assign instead of just Assign)
avoids a lot of head seeking and can make a noticeably performance difference.

Note that use of Workbench files other than plain text files such as
startup-sequence on a CD requires a Workbench License Agreement with Commodore.
Contact CATS for licensing information.

Another important consideration in bootup time is the size and complexity of
the title itself. It is highly desirable to get your title on the screen as
soon as possible. This can become difficult with very large titles which take a
long time to load in memory. The solution to this problem involves either the
use of overlays, or the use of a separate loader program.

The simpler approach is the loader program. This is a very small program that
gets run in the startup-sequence (just like WestChesterWarrior in the example
above). This loader program contains some animation and music sequences that
can quickly be put onto the screen. While this animation is playing, the loader
program can then proceed to load in the rest of the title into memory and
activate it. See the DOS RunCommand() or System() functions for information on
how the loader program can invoke the main title.


Startup Environment
-------------------

While the system is loading a title into memory, there is a small animation
playing on the screen. This animation tells the user that the system is busy
and will be done shortly. This animation consumes little memory, and exits the
system as soon as the title indicates it is ready to run.

There are several things to consider when initializing a title with respect to
interactions with the system:

  - The startup animation runs in an Intuition screen. In order for the exit
    sequence of the animation to work correctly, titles must not take over
    the display prior to the animation shutting down.

  - The startup animation may use the audio.device. It is therefore important
    that titles do not start to play any music prior to the animation
    shutting down.

  - When the animation exits the system, it leaves the display completely
    black. You can assume this in your titles, and fade up from black, or
    whatever other transitions you wish to do.

Once your title is in memory and wishes to display something on the screen,
it needs to do:

    FreeAnimBase = OpenLibrary("freeanim.library", 0);

This tells the startup animation to begin shutting down, which involves
removing itself from the display and freeing the resources it uses. This may
take awhile, up to about a second. While the startup animation is shutting
down, your application can prepare data to display and generally initialize
itself. This parallelism reduces the time the user has to wait for the titles
to start.

Once you have done what you need in order to display your title screen, you
must do the following:

    CloseLibrary(FreeAnimBase);

This waits for the animation to complete its shutdown. Once this function has
returned, it is now safe to display your title screen.

If you have no need to process information while the animation is shutting
down, the following will work:

    CloseLibrary(OpenLibrary("freeanim.library", 0));

It is important to note that on a computer equipped CD-ROM, there will not be a
freeanim.library around, so your code should not fail when freeanim.library
cannot be opened. This is easy to do, just don't put any error checking in:

    FreeAnimBase = OpenLibrary("freeanim.library",0);

    /* initialize application stuff */

    CloseLibrary(FreeAnimBase);

    /* start application animation/display */

CloseLibrary() accepts a NULL pointer and ignores it. Therefore if
OpenLibrary() fails and returns NULL, CloseLibrary() will still work.


Running Your Titles From Workbench
----------------------------------

If Commodore decides to make AmigaCD compatible hardware available for its
Amiga computer systems, it would be highly desirable if AmigaCD titles could be
run from Workbench on those systems. This requires only a few lines of code to
support:

  1 - You should handle disc insertion and removal events. On a computer
      system, it would not be wise to enable the "reboot on removal"
      feature of cd.device. When running on an AmigaCD, you should
      generally reboot when a disc is removed, but in a computer environment,
      you should deal with this eventuality and handle it gracefully by
      putting up an error message, or at least quiting the title. Crashing
      is never a good idea.

  2 - Your code should handle the Workbench startup environment

  3 - Your CD should include icons for the appropriate files

  4 - Your code should be able to run without having the startup-sequence
      from your CD run. This is important. If your program relies on
      assignments made in the startup-sequence, these will not be present
      when running from Workbench. An easy solution is to provide an
      IconX script on the CD that gets run from WB and loads in the title.
      The script can do the needed assigns.

  5 - Your code should multitask nicely. It should release all its
      resources on exit. If this is not possible, you must warn the
      user in the documentation and in the software itself that starting
      this title will take over the system and cause any unsaved work
      to be lost.

The startup environment in a computer system will different from the normal
AmigaCD environment. freeanim.library will not be there, so your code should
not fail if freeanim.library cannot be opened. In addition, there will not be a
startup animation in the system, so the initial display will not be a black
screen and will instead be the user's Workbench screen.

It is also a nice touch to make the software runnable when not on the CD. This
allows users to copy the title to their hard drive, enabling potentially much
faster operation.

Finally, if you wish your application to look right at home on a CD-ROM
equipped Amiga computer, you should avoid direct references to "AmigaCD" within
your title. The title might actually be running on an A1200 or A4000.


Preferences
-----------

CDs should not contain any preferences files. This specifically means that the
following files should not be on your CDs:

   Devs/system-configuration
   Prefs/env-archive/sys/#?

Including any preferences file can cause odd behavior during the startup
animation sequence.

In addition, many CDTV titles used to call the Intuition SetPrefs() function in
order to change screen positioning and centering. This is not the correct
method and will lead to problems with the startup animation. See the section
below on screen positioning for information on how to do it right.


Screen Positioning
------------------

In the days of 1.3, there was originally no officially supported way to control
overscan and only limited official screen positioning control. Numerous ad hoc
techniques of varying quality were invented, and most are still supported,
though some only work because of kludges designed to keep them operational.

V36 introduced the graphics database and a host of structures to help you
control your screen position.  For correct operation on the AmigaCD, we
strongly urge you to use these functions and structures.

First, some definitions to help you along:

Text Overscan:  this is the old "morerows" size from 1.3, and has been called
the "Text Overscan" or "Text Size" in V37+ Overscan Prefs. This rectangle
defaults to a nominal-sized rectangle, but can be enlarged and/or repositioned
by the user via Overscan Prefs. If this rectangle is correctly set, no pixel in
Text Overscan is supposed to be masked by the bezel of the monitor.

Display Clip:  a rectangle that describes the desired displayable portion of
your screen. The coordinates are in screen-pixels, and the origin is the
upper-left corner of the Text Overscan rectangle.

It is best to center your own display with respect to the Text Overscan
rectangle. Here's a piece of code to handle it:

/* CenterDClip( displayID, width, height, rect )
 * Fills in the struct Rectangle pointed to by rect with a DisplayClip
 * whose size is the width and height specified, and whose position
 * is centered around the Text Overscan rectangle for the specified
 * displayID.
 *
 * Returns TRUE if it succeeds, FALSE if it doesn't (usually caused
 * by an invalid displayID).
 */

BOOL CenterDClip(ULONG displayID, ULONG width, ULONG height,
                 struct Rectangle *rect )
{
BOOL success = FALSE;
LONG excess_x;
LONG excess_y;

    if ( QueryOverscan( displayID, rect, OSCAN_TEXT ) )
    {
    excess_x = ( width - ( rect->MaxX - rect->MinX + 1 ) );
    excess_y = ( height - ( rect->MaxY - rect->MinY + 1 ) );
    rect->MinX -= excess_x / 2;
    rect->MaxX = rect->MinX + width - 1;
    rect->MinY -= excess_y / 2;
    rect->MaxY = rect->MinY + height - 1;

    success = TRUE;
    }
    return( success );
}

Sample use:

    #define MY_DISPLAY_ID   HIRES_KEY
    #define MY_WIDTH    whatever
    #define MY_HEIGHT   whatever

    ...

    struct Rectangle dclip;

    if ( CenterDClip( MY_DISPLAY_ID, MY_WIDTH, MY_HEIGHT, &dclip ) )
    {
        if ( myscreen = OpenScreenTags( NULL,
        SA_DClip, &dclip,
        ...
        TAG_DONE ) )
    }

Centering yourself using CenterDClip() could theoretically give you a
Display Clip which extends outside of the OSCAN_MAX Display Clip,
which represents the hardware limits.  If you would rather be slightly
off-center than clipped, you may wish to shift the resulting DClip
to fit within Maximum Overscan.  The easiest way to get that rectangle
is:
        QueryOverscan( displayID, &maxrect, OSCAN_MAX );

A word on screen size/position defaults:

The default values for the LeftEdge, TopEdge, Width, and Height of a screen can
be a bit complex. This is partially due to the fact that they are implicitly
specified by supplying a non-NULL NewScreen pointer to OpenScreenTagList(), and
by the fact that while Intuition does define STDSCREENWIDTH and STDSCREENHEIGHT
magic constants, there are no corresponding constants for standard left-edge
and standard top-edge (which are likely non-zero!). The most foolproof strategy
is to use a NULL NewScreen structure, using only tags to specify screen
attributes, and omit all of SA_Left, SA_Top, SA_Width, and SA_Height. The
correct defaults will come from the SA_DClip.

The other way (which is required if using a non-NULL NewScreen), is to supply
the correct values for each component (either in the appropriate members of the
NewScreen structure or with the appropriate tags). The correct values are:

    left   = dclip.MinX
    top    = dclip.MinY
    width  = dclip.MaxX - dclip.MinX + 1
    height = dclip.MaxY - dclip.MinY + 1

Note that if your screen is shorter than the nominal height, other screens that
are behind you can potentially be visible above your screen.

You are strongly encouraged to use Intuition screens instead of custom Views
and ViewPorts. However, if you go that route, you can install a DisplayClip
into your ViewPort's ViewPortExtra structure.

A word on sprites:

User preference can shift the Intuition View origin, which in turn can affect
the number of sprites available on your screen. If you use sprites other than
the pointer sprite, you must take this into consideration, because a change in
the upper-left corner of the Text Overscan rectangle shifts the entire
coordinate system, so even carefully-chosen fixed coordinates may get you into
trouble. The upper-left corner of the OSCAN_MAX rectangle is the one which is
at a fixed position with respect to the hardware fetch cycle (for a given
mode). You can base a positional calculation on this if necessary.

There are some Display Clip positions for which the number of possible sprites
varies depending on which fetch mode is used. The higher fetch modes have the
advantage of reducing chip RAM bus saturation, but you may prefer a lower
bandwidth with more sprites.  Graphics will drop the bandwidth to bring
allocated sprites into view if MakeVPort() runs after you obtain your sprites
via GetExtSprite(). In an Intuition environment, you should use RemakeDisplay()
after you get your sprites (not call MakeVPort() directly).


Avoiding The Workbench Screen
-----------------------------

If you use Intuition screens in your titles, it is important to note an
Intuition "feature" which can get in the way. Whenever the last screen opened
in the system is closed, Intuition automatically opens up the Workbench screen.
This can be quite cumbersome in titles which perform transitions between
different screens. Here is a short code sample for SAS/C that defeats this
Intuition feature. Simply call CloseScreenQuiet() instead of calling
CloseScreen() and all will be fine:

ULONG __asm OpenWorkBenchPatch(void)
{
    return(0);
}

VOID CloseScreenQuiet(struct Screen *screen)
{
APTR OWB;

    if (screen)
    {
        OWB = SetFunction(IntuitionBase, -0xd2, (APTR)OpenWorkBenchPatch);
        CloseScreen(screen);
        SetFunction(IntuitionBase, -0xd2, OWB);
    }
}

Note that the above code will only work starting with V39 Kickstart. Previous
Kickstarts did not support this. The AmigaCD has a V40 Kickstart.


V40 Graphics Issues
-------------------

The graphics.library for V39 gained many features that make creating system
friendly, fast moving graphics and animations much easier. graphics.doc is a
good source of information on these new features. Some examples are also
available from the 1993 DevCon notes. Of specific interest is the new
double-buffering support which is even available in Intuition screens.

V40 of graphics.library which is present in the AmigaCD ROM contains a few
extra features specifically targeted at improving the performance of animation
and rendering code. These features are relatively new and not well known, so
they are briefly explained below.

  - ViewPorts that don't load colors.
    ViewPorts normally always have a copper list associated with them which
    loads up all the colors needed for their depth. This new feature makes
    it so that only color 0 gets loaded within the copper list. For deep
    screens, this will substantially reduce the copper list length.
    The rest of the colors are inheritied from the viewport above.
    This feature is useful to reduce the inter-viewport gap, and for faster
    color cycling. See the VC_NoColorPaletteLoad tag in
    <graphics/videocontrol.h> and in the graphics.library/VideoControl()
    autodoc entry.

  - Preventing intermediate copper list updating.
    Speeds up LoadRGB(), SetRGB(), ScrollVPort(), and ChangeVPBitMap().
    See the VC_IntermediateCLUpdate tag in <graphics/videocontrol.h> and
    in the graphics.library/VideoControl() autodoc entry.

  - Dual-playfield disable.
    Disables setting of the dual playfield bit in dual-playfield viewports.
    Odd and even bit-planes will still scroll separately, but will be fed
    directly to the palette. This can be used for instance to do cross-fades
    between independently scrolling images. See the VC_DUALPF_Disable tag in
    <graphics/videocontrol.h> and the graphics.library/VideoControl() autodoc
    entry.

  - AmigaCD includes very fast chunky-to-planar conversion hardware. This
    allows for high-quality 3D graphics. Consult the documentation for the
    WriteChunkyPixels() function in the graphics.doc autodoc file for more
    information.

Note that the above new ViewPort features work fine in Intuition screens as
well. You just need to pass the screen's ViewPort as a parameter to the
VideoControl() function.

You might also wish to look at the documentation for the SA_VideoControl and
SA_MinimizeISG tags for the OpenScreenTagList() function. These two tags offers
Intuition-level control of the new features outlined above. There are also the
SA_Interleaved, SA_Exclusive, and SA_Draggable tags which can greatly help
writing animation and graphics code. All these tags are documented in
<intuition/screens.h> and in the intuition.doc autodoc.

V40 also added four new display modes which are useful for animation support.
These modes are defined in <graphics/modeid.h> as:

/* Added for V40 - may be useful modes for some games or animations. */
#define LORESSDBL_KEY                   0x00000008
#define LORESHAMSDBL_KEY                0x00000808
#define LORESEHBSDBL_KEY                0x00000088
#define HIRESHAMSDBL_KEY                0x00008808

These new V40 display modes allow you to display a given raster at twice its
height. Each line of the raster automatically gets repeated on the screen as
it is displayed. This allows a 128 pixel high raster to be displayed as if
it was 256 pixels tall. This can be very helpful in order to create full
screen animations. For example, a 128 pixel high CDXL animation can
suddenly occupy the full screen.

When you use one of these new modes, you DO NOT allocate more raster or open a
taller screen - i.e. you still allocate a raster of the smaller height (128 for
example), and if you are blitting the image you still only blit 128 lines. The
effect which doubles the height of your image is a visual video effect
accomplished by the AA hardware.

These modes work on a composite monitor or TV.


Mode Promotion
--------------

Mode promotion is a feature which converts 15kHz screens into 31kHz screens,
in order to remove interlace flicker, or inter-line gaps. It is the AA
equivalent of the A3000 display enhancer hardware.

Mode promotion can be turned on or off by the user. When turned on,
screens opened using the 1.3 OpenScreen() function, or opened using a
default monitor ID will end up promoted to a 31kHz mode. The promotion
process is not totally transparent as certain aspects of the copper list,
the refresh rate, and available overscan dimensions are different
for the promoted state than for the unpromoted state. These differences
can be crucial for many developers.

To avoid promotion affecting your titles, you simply need to open your screens
with explicit mode IDs using the PAL_MONITOR_ID and NTSC_MONITOR_ID, instead
of using the DEFAULT_MONITOR_ID.

Note that promotion is not turned on in AmigaCD systems, the problem can only
surface in a computer environment.

Consult the ROM Kernel manuals, the 1991 and 1993 DevCon notes for more
information on mode ids and mode promotion.


Localization
------------

There are two ways software can be localized on AmigaCD systems.
lowlevel.library offers a very simple mechanism that returns the number of the
user's current preferred language. The second method involves using
locale.library which provides a complete suite of localization services.

If your title does not use locale.library, it is best to remove it from your
CDs.

If your title does use locale.library, you must have a directory structure such
as:

      Locale (dir)
        Catalogs (dir)
          français (dir)
            westchesterwarrior.catalog
          deutsch (dir)
            westchesterwarrior.catalog
          italiano (dir)
            westchesterwarrior.catalog
        Languages (dir)
          français.language           italiano.language
          deutsch.language

That is, you need a Locale directory which contains a Catalogs and a Languages
subdirectory. There is no need to include the Countries directory that comes
with the Workbench disk, this directory is only of use to the Locale
preferences editor.

The Catalogs directory must contain one subdirectory for each language that
your title supports. Within these directories, you can put the standard
locale.library catalog files (see locale.doc and catcomp.doc for more
information).

The Languages directory must contain a language driver for each of the
languages your title supports. These language drivers are supplied with
Workbench 3.1 on the Locale disk.

The LOCALE: assignment must exist if you use locale.library. It should be made
to the Locale directory described above.


nonvolatile.library
-------------------

The purpose of this library is to allow an application to save small amounts of
information to nonvolatile memory or a disk device without having to burden the
application with determining which device to use. It provides a simple, common
access method to whichever device the user chooses. This library also provides
access to true nonvolatile memory present on the game machine.

See the nonvolatile.doc autodoc for more information on this library.


lowlevel.library
----------------

lowlevel.library provides many functions useful for game developers. Among
other things, this library provides the only means to read the AmigaCD
game controller.

Aside from the game controller code, the main purpose for lowlevel.library was
to provide functions that are often needed by game developers. Most of the
functions in this library should not be used in a multitasking environment and
is intended purely for simple programs. Aside from the game controller code,
everything else in lowlevel.library can be better done using other system
modules, though more work may be involved.

See the lowlevel.doc autodoc for more information on this library.
@


40.6
log
@*** empty log message ***
@
text
@d5 1
a5 1
Last Revised: $Date: 93/05/06 13:54:19 $ $Revision: 40.5 $
d38 1
a38 1
    - debox.library!
@


40.5
log
@fixed grammar error.
@
text
@d5 1
a5 1
Last Revised: $Date: 93/04/28 14:00:14 $ $Revision: 40.4 $
d61 3
a63 2
(see below for more on this). Finally, cd.device will be included with
AmigaCD-compatible solution that Commodore will offer for its computer systems.
d70 4
a73 4
be included directly after the PVD sectors. CDTV supported having the
trademark file either right after the PVD sectors, or as a normal file in
the root of the CD directory structure. This is not the case with AmigaCD,
the trademark file must be included after the PVD sectors.
d77 2
a78 2
information on obtaining on the trademark file if you plan on generating your
own ISO image. In order to ensure the trademark file gets placed directly after
d98 1
a98 1
would boot from a hard-drive, executing a startup-sequence et al.
d105 1
a105 1
situation and take appropriate action to reduce boot times.
d122 1
a122 1
when the standard startup-sequence is used.
d166 2
a167 2
activate. See the DOS RunCommand() or System() functions for information on how
the loader program can invoke the main title.
d198 1
a198 1
This will tell the startup animation to begin shutting down, which involves
d202 2
a203 2
itself. This parallelism reduces the time the user has to wait for the
titles to start.
d205 2
a206 2
Once you have done what you need to in order to display your title screen, you
should do the following:
d210 2
a211 2
This will wait for the animation to complete its shutdown. Once this function
has returned, it is now safe to display your title screen.
d220 1
a220 2
cannot be opened. This is easy to do, just don't put any error checking
in:
d238 3
a240 3
Amiga computer systems, it would be highly desirable if AmigaCD titles
could be run from Workbench on those systems. This requires only a few
lines of code to support:
d273 3
a275 3
It would also be a nice touch to make the software runnable when not on the
CD. This would allow users to copy the title to their hard drive, enabling
potentially much faster operation.
d285 2
a286 2
CDs should not contain any preferences files. This specifically means that
the following files should not be on your CDs:
d448 1
a448 1
VOID CloseScreenQuiet(struct CDUILib *CDUIBase, struct Screen *screen)
d460 2
a461 2
Note that the above code will only work starting with V39 Kickstart.
Previous Kickstarts did not support this. The AmigaCD has a V40 Kickstart.
d474 3
a476 3
extra features specifically targeted at improving the performance of
animation and rendering code. These features are relatively new and not well
known, so they are briefly explained below.
d507 3
a509 3
Note that the above new ViewPort feature work fine in Intuition screens as
well. You just need to pass the screen's ViewPort as a parameter to
the VideoControl() function.
d602 1
a602 1
locale.library catalogs files (see locale.doc and catcomp.doc for more
@


40.4
log
@*** empty log message ***
@
text
@d5 1
a5 1
Last Revised: $Date: 93/04/28 11:30:19 $ $Revision: 40.3 $
d30 1
a30 1
	- cdtv.device
d32 1
a32 1
	- playerprefs.library
d34 5
a38 5
	- bookmark.device

	- cardmark.device

	- debox.library!
d40 1
a40 1
	- rmtm
d42 1
a42 1
	- CDTVPrefs
d46 1
a46 1
	- lowlevel.library
d48 1
a48 1
	- nonvolatile.library
d50 1
a50 1
	- freeanim.library
d52 1
a52 1
	- cd.device
d54 1
a54 1
	- CD-ROM file system
d70 1
a70 1
trademark file either right after the PVD sectors, in as a normal file in
d346 6
a351 6
	excess_x = ( width - ( rect->MaxX - rect->MinX + 1 ) );
	excess_y = ( height - ( rect->MaxY - rect->MinY + 1 ) );
	rect->MinX -= excess_x / 2;
	rect->MaxX = rect->MinX + width - 1;
	rect->MinY -= excess_y / 2;
	rect->MaxY = rect->MinY + height - 1;
d353 1
a353 1
	success = TRUE;
d360 3
a362 3
	#define MY_DISPLAY_ID	HIRES_KEY
	#define MY_WIDTH	whatever
	#define MY_HEIGHT	whatever
d364 1
a364 11
	...

	struct Rectangle dclip;

	if ( CenterDClip( MY_DISPLAY_ID, MY_WIDTH, MY_HEIGHT, &dclip ) )
	{
	    if ( myscreen = OpenScreenTags( NULL,
		SA_DClip, &dclip,
		...
		TAG_DONE ) )
	}
d366 10
d400 4
a403 4
	left   = dclip.MinX
	top    = dclip.MinY
	width  = dclip.MaxX - dclip.MinX + 1
	height = dclip.MaxY - dclip.MinY + 1
@


40.3
log
@*** empty log message ***
@
text
@d5 1
a5 1
Last Revised: $Date: 93/04/28 11:02:29 $ $Revision: 40.2 $
d375 8
@


40.2
log
@*** empty log message ***
@
text
@d5 1
a5 1
Last Revised: $Date: 93/04/28 10:22:30 $ $Revision: 40.1 $
d82 3
d150 4
d244 5
a248 1
      feature of cd.device
d261 6
d533 26
@


40.1
log
@*** empty log message ***
@
text
@d5 1
a5 1
Last Revised: $Date$ $Revision$
d44 1
a44 1
Four special system modules were created for the AmigaCD console:
d56 7
a62 7
You can use these modules with confidence. lowlevel.library and
nonvolatile.library will be part of Workbench 3.1 and will be shipped within
the 3.1 Enhancer kits and with new machines that include Workbench 3.1.
freeanim.library will not be included with the normal Workbench distribution,
but your code does not need to rely on its presence (see below for more on
this). Finally, cd.device will be included with AmigaCD-compatible solution
that Commodore will offer for its computer systems.
@


1.6
log
@More more more...

@
text
@d5 1
a5 1
Last Revised: 27-Apr-93
@


1.5
log
@Totally new version of this file, clearer and more complete
@
text
@d210 4
a213 2
Note that on a computer equipped CD-ROM, there will not be a freeanim.library
around, so your code should not fail when freeanim.library cannot be opened.
d215 7
d223 4
d286 228
a513 1
!!! to be filled-in by Peter !!!
d515 1
d517 1
d529 1
a529 1
If you title does use locale.library, you must have a directory structure such
d586 1
a586 1
modules.
a588 40


Controller Imagery
------------------

!!! need information on RGB values for the controller and its buttons !!!


Miscellanous Issues
-------------------

AmigaCD includes very fast chunky-to-planar conversion hardware. This allows
for high-quality 3D graphics. Consult the documentation for the
WriteChunkyPixels() function in the graphics.doc autodoc file for more
information.

If you use Intuition screens in your titles, it is important to note an
Intuition "feature" which can get in the way. Whenever the last screen opened
in the system is closed, Intuition automatically opens up the Workbench screen.
This can be quite cumbersome in titles which perform transitions between
different screens. Here is a short code sample for SAS/C that defeats this
Intuition feature. Simply call CloseScreenQuiet() instead of calling
CloseScreen() and all will be fine:

ULONG __asm OpenWorkBenchPatch(void)
{
    return(0);
}

VOID CloseScreenQuiet(struct CDUILib *CDUIBase, struct Screen *screen)
{
APTR OWB;

    if (screen)
    {
        OWB = SetFunction(IntuitionBase, -0xd2, (APTR)OpenWorkBenchPatch);
        CloseScreen(screen);
        SetFunction(IntuitionBase, -0xd2, OWB);
    }
}
@


1.4
log
@reworded for lowleve.library and for freeanim.library.
@
text
@d2 2
d5 1
a5 2
                                                            Jerry Horanoff
                                                            2/10/93
d8 199
a206 1
                        C O N F I D E N T I A L !
d208 1
d210 2
a212 1
        Things that an AmigaCD developer needs to do to create a title
d214 101
d316 2
a318 1
                            First things first
d320 2
a321 6


    FORGET ABOUT CDTV SPECIFIC LIBRARIES, DEVICES AND PROGRAMS!

    DO NOT USE!!!:  cdtv.device, playerprefs.library, bookmark.device,
                    cardmark.device, or debox.library!
d323 5
a327 1
    DO NOT USE!!!:  rmtm, CDTVPrefs
d329 1
a329 1
    DO NOT USE!!!:  ANYTHING THAT IS CDTV SPECIFIC!
a330 2
Do not use any library, device, or program that is NOT included in a
standard 3.1 OS Amiga computer except for the following items:
a331 2
cd.device
freeanim.library
d333 1
a333 130
nonvolatile.library

These are the ONLY extra Amiga OS libraries you should access.




        Getting an AmigaCD title to boot on an AmigaCD system

In order to get a title to boot on an AmigaCD, an AmigaCD trademark file
must be included DIRECTLY AFTER THE PVD SECTORS (i.e. the trademark file
should NOT be visible in the directory) -- unlike with CDTV (where the
trademark file could be located directly after the PVD, or included in the
directory).  The trademark file for an AmigaCD is different from the
trademark file for CDTV.  Talk to CATS for this trademark file if you plan
on generating your own ISO image.  In order to make sure that the
trademark gets placed directly after the PVD, DO NOT copy it to your CD's
directory, instead make sure that the trademark file is in the directory
you are currently CD'd to (probably where ISOCD is located) when creating
your ISO image.
                                                                                                  
An AmigaCD title will boot just like any other program -- through the
startup-sequence.  Nothing special; however, because the CD's seek times
are pretty slow, try to keep your startup-sequence short.  Try an make
your title do something as soon as possible, and if you do not want the
shell to open, make sure that you do not echo anything to the screen or
that you program generate any output that would force a screen open.
Redirect to >nil: if necessary.






                    Once you have something to display...


The startup-animation is some sort of thing that will be running before
and during the booting of your title.  It will not stop animating until
you tell it to (so that you will have time to get a screen ready to
display -- reducing the amount of time that a black screen is displayed).

Once you have a screen to display, you need to do the following:

    FreeAnimLibrary = OpenLibrary("freeanim.library", 0);

This will tell the startup-animation to begin shutting down (i.e. fade
to black and free up the memory).  This may take up to a second to
perform.  During this time, you can process any data that you would like.
Most likely, you would be processing data to display your title screen.
Once you have done what you need to in order to display your title screen,
you should do the following:

    CloseLibrary(FreeAnimLibrary);

This will wait for the animation to complete its shutdown.  Once this
function has returned, it is now safe to display your title screen.

If you have no data to process inbetween the OpenLibrary() and the
CloseLibrary() calls, you can do:

    CloseLibrary(OpenLibrary("freeanim.library", 0));

If the freeanim.library is not present (for whatever reason), the
OpenLibrary() call will fail returning NULL.  The CloseLibrary() call
will accept a NULL pointer on all AA machines so there is no need to
test for success of the OpenLibary() call before calling CloseLibrary().

If/when we make a CD-ROM drive for AA Amiga computers, we would like to
make sure that the titles work on these machines as well.  Under these
conditions, an animation will not exist.  What this means is that you
should not make any assumption about the graphical state left behind by
the startup-animation.  This animation may not be present on other
systems.  On an A4000, the state may be quite different.






                    Running your title from workbench


If/when we make a CD-ROM drive for the AA machines, it would be desirable
for your title to work from workbench.  This implies a few things:  1:
you should probably deal with disk removal error conditions (i.e. you
probably don't want to enable reset-on-disk-removal).  2: You should
include an icon for your program.





                        Using nonvolatile.library

The purpose of this library is to allow an application to save small
amounts of information to nonvolatile memory or a disk device without
having to burden the application with determining which device to use.  It
provides a simple, common access method to whichever device the user
chooses.  This library also provides access to true nonvolatile memory
present on the game machine.

This library has yet to be finalized.  You will be hearing more about this
in the future.




                            Using lowlevel.library


This is currently the only way to access the game controller.
There are some other functions in here you may find useful.

The main purpose of this library is to provide a legitimate way to break
the rules.  Most of the functions in this library should not be used in a
multi-tasking environment.  The honest truth is that you shouldn't be
breaking the rules to begin with, but if you are going to break the rules,
please use this library to do it.  Do not expect to be able to multi-task
when using functions from this library.  The only reason you should NEED
to use this library currently is to access the game controller.



                               Miscellaneous


Your application should not talk to the user about anything AmigaCD
specific.  Keep in mind that your title may be running on an A1200 or
A4000.
d335 52
@


1.3
log
@*** empty log message ***
@
text
@d32 2
a33 1
game.library
d45 1
a45 1
should not be visible in the directory) -- unlike with CDTV (where the
d58 4
a61 1
your title do something as soon as possible.
d76 1
a76 3
Once you have a screen to display, you need to call the
BeginShutdownAnim() and WaitShutdownAnim() functions.  This will fade the
animation to black and free the animation's memory.
d78 24
d104 4
a107 4
conditions, an animation will not exist.  These two functions will do
nothing.  What this means is that you should not make any assumption about
the state of intuition when this animation is freed.  On a computer, the
state may be quite different.
d129 9
a137 18

If you plan on saving data to nonvolatile.library, before you begin your
game (or whatever), you should make sure that there is a least enough
memory free on the nonvolatile device (by using the GetNVInfo() function)
to store one game position (or whatever you plan on storing).  If there is
not enough space available, you should warn the user before beginning the
game that he/she should make room on the nonvolatile device if the user
plans on saving a game.  Unlike with CDTV, the items on the nonvolatile
device are not purged automatically (because this library can also go to
disk and we really don't want to automatically purge disk files).  The user
can selectively delete items on the nonvolatile device by click on the A
button of the controller when the startup animation is running.  This will
bring up a window with a list of all entries on the nonvolatile device.

This was the best way we could come up with to eliminate the need for disk
formatting/nonvolatile entry deleting by the application, and to minimize
error conditions.  See nonvolatile.library introduction for more
information.
d142 1
a142 1
                            Using game.library
a143 1
NOTE:  The name of this library may change.
d145 1
a145 2

You MUST use this library to access the game controller!
d148 7
a154 1

@


1.2
log
@*** empty log message ***
@
text
@d28 1
a28 1
Do not use any library, device, or program that is not included in a
d78 4
a81 4
conditions, an animation will not exist.  These two functions will
effectively do nothing.  What this means is that you should not make any
assumption about the state of intuition when this animation is freed.  On
a computer, the state may be quite different.
d109 7
a115 7
game that he/she should make room in nonvolatile RAM if the user plans on
saving a game.  Unlike with CDTV, the items in nonvolatile RAM are not
purged automatically (because this library can also go to disk and we
really don't want to automatically purge disk files).  The user can
selectively delete items on the nonvolatile device by click on the A button
of the controller.  This will bring up a window with a list of all entries
on the nonvolatile device.
@


1.1
log
@Initial revision
@
text
@d51 2
a52 1
you are currently CD'd to (probably where ISOCD is located).
d63 1
a63 1

d109 2
a110 2
game that he/she should make room in nonvolatile RAM if he/she plans on
saving a game.  Unlike with CDTV, the items in nonvolatile ram are not
d113 3
a115 3
selectively delete items in nonvolatile RAM by click on the A button of
the controller.  This will bring up a window with a list of all entries in
nonvolatile RAM.
d124 1
a124 1

d133 10
@
