head     38.30;
branch   ;
access   ;
symbols  ;
locks    davidj:38.30; strict;
comment  @ * @;


38.30
date     92.06.20.14.26.50;  author davidj;  state Exp;
branches ;
next     38.29;

38.29
date     92.05.13.13.49.54;  author davidj;  state Exp;
branches ;
next     38.28;

38.28
date     92.05.13.12.37.56;  author davidj;  state Exp;
branches ;
next     38.27;

38.27
date     92.05.06.08.32.33;  author davidj;  state Exp;
branches ;
next     38.26;

38.26
date     92.03.25.10.49.30;  author davidj;  state Exp;
branches ;
next     38.25;

38.25
date     92.03.17.14.16.42;  author davidj;  state Exp;
branches ;
next     38.24;

38.24
date     92.01.23.15.20.09;  author davidj;  state Exp;
branches ;
next     38.23;

38.23
date     92.01.22.14.14.14;  author davidj;  state Exp;
branches ;
next     38.22;

38.22
date     92.01.10.17.17.47;  author davidj;  state Exp;
branches ;
next     38.21;

38.21
date     92.01.02.15.10.00;  author davidj;  state Exp;
branches ;
next     38.20;

38.20
date     91.12.02.14.55.21;  author davidj;  state Exp;
branches ;
next     38.19;

38.19
date     91.11.21.13.59.18;  author Unknown;  state Exp;
branches ;
next     38.18;

38.18
date     91.11.20.22.35.09;  author Unknown;  state Exp;
branches ;
next     38.17;

38.17
date     91.11.19.19.34.28;  author Unknown;  state Exp;
branches ;
next     38.16;

38.16
date     91.11.11.13.59.17;  author vertex;  state Exp;
branches ;
next     38.15;

38.15
date     91.10.25.11.37.16;  author vertex;  state Exp;
branches ;
next     38.14;

38.14
date     91.09.20.11.00.18;  author vertex;  state Exp;
branches ;
next     38.13;

38.13
date     91.09.20.10.54.52;  author vertex;  state Exp;
branches ;
next     38.12;

38.12
date     91.08.28.10.45.36;  author vertex;  state Exp;
branches ;
next     38.11;

38.11
date     91.08.20.11.33.28;  author vertex;  state Exp;
branches ;
next     38.10;

38.10
date     91.08.12.12.51.54;  author vertex;  state Exp;
branches ;
next     38.9;

38.9
date     91.08.06.18.05.07;  author vertex;  state Exp;
branches ;
next     38.8;

38.8
date     91.07.18.15.28.36;  author vertex;  state Exp;
branches ;
next     38.7;

38.7
date     91.07.15.12.08.05;  author vertex;  state Exp;
branches ;
next     38.6;

38.6
date     91.07.10.17.56.17;  author vertex;  state Exp;
branches ;
next     38.5;

38.5
date     91.07.02.15.45.03;  author vertex;  state Exp;
branches ;
next     38.4;

38.4
date     91.06.28.17.48.10;  author vertex;  state Exp;
branches ;
next     38.3;

38.3
date     91.06.24.16.49.15;  author vertex;  state Exp;
branches ;
next     38.2;

38.2
date     91.06.24.13.44.56;  author vertex;  state Exp;
branches ;
next     38.1;

38.1
date     91.06.21.13.36.00;  author vertex;  state Exp;
branches ;
next     ;


desc
@Prefs editor shell - Locale custom interface
@


38.30
log
@changed zoom top-left to -1
@
text
@
/* includes */
#include <exec/types.h>
#include <exec/libraries.h>
#include <exec/ports.h>
#include <exec/memory.h>
#include <intuition/intuition.h>
#include <intuition/screens.h>
#include <intuition/gadgetclass.h>
#include <graphics/text.h>
#include <libraries/asl.h>
#include <libraries/gadtools.h>
#include <libraries/locale.h>
#include <prefs/locale.h>
#include <dos/dos.h>
#include <dos/exall.h>
#include <string.h>

/* prototypes */
#include <clib/macros.h>
#include <clib/alib_protos.h>
#include <clib/exec_protos.h>
#include <clib/dos_protos.h>
#include <clib/iffparse_protos.h>
#include <clib/gadtools_protos.h>
#include <clib/intuition_protos.h>
#include <clib/graphics_protos.h>
#include <clib/alib_protos.h>
#include <clib/utility_protos.h>
#include <clib/locale_protos.h>

/* direct ROM interface */
#include <pragmas/exec_pragmas.h>
#include <pragmas/dos_pragmas.h>
#include <pragmas/iffparse_pragmas.h>
#include <pragmas/gadtools_pragmas.h>
#include <pragmas/intuition_pragmas.h>
#include <pragmas/graphics_pragmas.h>
#include <pragmas/utility_pragmas.h>
#include <pragmas/locale_pragmas.h>

/* application includes */
#include "pe_custom.h"
#include "pe_strings.h"
#include "pe_utils.h"
#include "worldmap.h"
#include "pe_iff.h"


#define SysBase ed->ed_SysBase;

BOOL InitMapData (EdDataPtr ed);
VOID FreeMapData (EdDataPtr ed);

/*****************************************************************************/


/* The IFF chunks known to this prefs editor. IFFPrefChunkCnt says how many
 * chunks there are
 */
#define IFFPrefChunkCnt 3
static LONG far IFFPrefChunks[] =
{
    ID_PREF, ID_PRHD,
    ID_PREF, ID_LCLE,
    ID_PREF, ID_CTRY
};


/*****************************************************************************/


/* The PrefHeader structure this editor outputs */
static struct PrefHeader far IFFPrefHeader =
{
    0,				/* version */
    0,				/* type    */
    0				/* flags   */
};


/*****************************************************************************/


EdStatus BuildList (EdDataPtr ed, struct List * list, STRPTR directory,
		     STRPTR pattern, WORD strip, STRPTR extra)
{
    UBYTE exAllBuffer[512];
    struct ExAllControl *eac;
    struct ExAllData *ead;
    BPTR lock;
    BOOL more;
    char pat[20];
    BOOL ok;
    BOOL nomem = FALSE;
    UWORD len;
    STRPTR name;
    struct Node *node;
    struct Node *new;

    NewList (list);

    if (extra)
    {
	len = strlen (extra);
	if (new = AllocRemember (&ed->ed_Tracker, sizeof (struct Node) + len + 1, MEMF_PUBLIC | MEMF_CLEAR))
	{
	    new->ln_Name = (STRPTR) ((ULONG) new + sizeof (struct Node));
	    CopyMem (extra, new->ln_Name, len);
	    AddHead (list, (struct Node *) new);
	    new->ln_Type = new->ln_Name[0];
	    new->ln_Name[0] = ToUpper (new->ln_Name[0]);
	}
    }

    ok = FALSE;
    if (eac = (struct ExAllControl *) AllocDosObject (DOS_EXALLCONTROL, 0))
    {
	ParsePatternNoCase (pattern, pat, 20);
	eac->eac_LastKey = 0;
	eac->eac_MatchString = pat;

	if (lock = Lock (directory, ACCESS_READ))
	{
	    ok = TRUE;
	    do
	    {
		more = ExAll (lock, (struct ExAllData *) exAllBuffer, sizeof (exAllBuffer), ED_TYPE, eac);
		if ((!more) && (IoErr () != ERROR_NO_MORE_ENTRIES))
		{
		    ok = FALSE;
		    break;
		}

		if (eac->eac_Entries > 0)
		{
		    ead = (struct ExAllData *) exAllBuffer;
		    do
		    {
			if (ead->ed_Type < 0)
			{
			    name = (STRPTR) ead->ed_Name;
			    len = strlen (name) - strip;

			    if (new = AllocRemember (&ed->ed_Tracker, sizeof (struct Node) + len + 1, MEMF_PUBLIC | MEMF_CLEAR))
			    {
				new->ln_Name = (STRPTR) ((ULONG) new + sizeof (struct Node));
				CopyMem (name, new->ln_Name, len);
				new->ln_Type = new->ln_Name[0];
				new->ln_Name[0] = ToUpper (new->ln_Name[0]);

				node = list->lh_Head;
				while (node->ln_Succ)
				{
				    if (Stricmp (node->ln_Name, new->ln_Name) >= 0)
					break;
				    node = node->ln_Succ;
				}
				Insert (list, new, node->ln_Pred);
			    }
			    else
			    {
				nomem = TRUE;
				break;
			    }
			}
			ead = ead->ed_Next;
		    }
		    while (ead);
		}
	    }
	    while (more);

	    UnLock (lock);
	}
	FreeDosObject (DOS_EXALLCONTROL, eac);
    }

    if (nomem)
    {
	SetIoErr (ERROR_NO_FREE_STORE);
	ok = FALSE;
    }

    if (ok)
	return (ES_NORMAL);

    return (ES_DOSERROR);
}


/*****************************************************************************/

EdStatus InitEdData (EdDataPtr ed)
{
    UWORD i;

    if (InitMapData (ed))
    {
	for (i = 0; i < 10; i++)
	{
	    ed->ed_PrefsDefaults.lp_PreferredLanguages[i][0] = NULL;
	    ed->ed_LangNodes[i].ln_Name = ed->ed_PrefsWork.lp_PreferredLanguages[i];
	}

	ed->ed_PreviousYOffset = -1;
	ed->ed_PreviousZone = -1;

#if 1
        strcpy(ed->ed_PrefsDefaults.lp_CountryName,"united_states"); /* .country"); */
        ed->ed_PrefsDefaults.lp_GMTOffset = 300;
        ed->ed_PrefsDefaults.lp_Flags = 0;

        ed->ed_PrefsDefaults.lp_CountryData.cp_CountryCode = MAKE_ID ('U', 'S', 'A', '\0');
        ed->ed_PrefsDefaults.lp_CountryData.cp_TelephoneCode = 1;
        ed->ed_PrefsDefaults.lp_CountryData.cp_MeasuringSystem = MS_AMERICAN;
        ed->ed_PrefsDefaults.lp_CountryData.cp_CalendarType    = CT_7SUN;

        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_DateTimeFormat, "%A %B %e %Y %Q:%M %p");

        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_DateFormat, "%A %B %e %Y");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_TimeFormat, "%Q:%M %p");

        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_ShortDateTimeFormat, "%m/%d/%y %Q:%M %p");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_ShortDateFormat, "%m/%d/%y");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_ShortTimeFormat, "%Q:%M %p");

        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_DecimalPoint, ".");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_GroupSeparator, ",");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_FracGroupSeparator, ",");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_Grouping, "\3\0");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_FracGrouping, "\3\0");

        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonDecimalPoint, ".");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonGroupSeparator, ",");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracGroupSeparator, ",");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonGrouping, "\3\0");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracGrouping, "\3\0");
        ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracDigits = 2;
        ed->ed_PrefsDefaults.lp_CountryData.cp_MonIntFracDigits = 2;

        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonCS, "$");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonSmallCS, "");
        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonIntCS, "USD");

        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveSign, "");
        ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveSpaceSep = SS_NOSPACE;
        ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveSignPos = SP_PREC_ALL;
        ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveCSPos = CSP_PRECEDES;

        strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSign, "-");
        ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSpaceSep = SS_NOSPACE;
        ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSignPos = SP_PREC_ALL;
        ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeCSPos = CSP_PRECEDES;

#else
	ed->ed_PrefsDefaults.lp_CountryName[0] = NULL;
	ed->ed_PrefsDefaults.lp_GMTOffset = 300;
	ed->ed_PrefsDefaults.lp_Flags = 0;

	ed->ed_PrefsDefaults.lp_CountryData.cp_CountryCode = MAKE_ID ('U', 'S', 'A', '\0');
	ed->ed_PrefsDefaults.lp_CountryData.cp_TelephoneCode = 1;
	ed->ed_PrefsDefaults.lp_CountryData.cp_MeasuringSystem = MS_AMERICAN;
	ed->ed_PrefsDefaults.lp_CountryData.cp_CalendarType    = CT_7SUN;

	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_DateTimeFormat, "%A %B %e %Y %I:%M %p");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_DateFormat, "%A %B %e %Y");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_TimeFormat, "%I:%M %p");

	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_ShortDateTimeFormat, "%m/%d/%y %I:%M %p");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_ShortDateFormat, "%m/%d/%y");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_ShortTimeFormat, "%I:%M");

	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_DecimalPoint, ".");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_GroupSeparator, ",");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_FracGroupSeparator, ",");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_Grouping, "\3\0");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_FracGrouping, "\3\0");

	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonDecimalPoint, ".");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonGroupSeparator, ",");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracGroupSeparator, ",");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonGrouping, "\3\0");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracGrouping, "\3\0");
	ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracDigits = 2;
	ed->ed_PrefsDefaults.lp_CountryData.cp_MonIntFracDigits = 2;

	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonCS, "$");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonSmallCS, "¢");
	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonIntCS, "USD");

	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveSign, "");
	ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveSpaceSep = SS_NOSPACE;
	ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveSignPos = SP_PREC_ALL;
	ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveCSPos = CSP_PRECEDES;

	strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSign, "-");
	ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSpaceSep = SS_NOSPACE;
	ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSignPos = SP_PREC_ALL;
	ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeCSPos = CSP_PRECEDES;
#endif

	ed->ed_PrefsWork = ed->ed_PrefsDefaults;
	ed->ed_PrefsInitial = ed->ed_PrefsDefaults;

	NewList (&ed->ed_PrefLanguages);

	ed->ed_ZoneYOffset = 35;

	return (ES_NORMAL);
    }

    return (ES_NO_MEMORY);
}


/*****************************************************************************/


VOID CleanUpEdData (EdDataPtr ed)
{
    FreeRemember (&ed->ed_Tracker, TRUE);
    FreeMapData (ed);
}


/*****************************************************************************/


VOID UpdateEdData (EdDataPtr ed)
{
    struct Node *node;
    UBYTE name[32];

    NewList (&ed->ed_PrefLanguages);
    ed->ed_UsedNodes = 0;

    while ((ed->ed_UsedNodes < 10) && ed->ed_PrefsWork.lp_PreferredLanguages[ed->ed_UsedNodes][0])
    {
	ed->ed_LangNodes[ed->ed_UsedNodes].ln_Type = ed->ed_PrefsWork.lp_PreferredLanguages[ed->ed_UsedNodes][0];
	ed->ed_LangNodes[ed->ed_UsedNodes].ln_Name[0] = ToUpper (ed->ed_LangNodes[ed->ed_UsedNodes].ln_Name[0]);
	AddTail (&ed->ed_PrefLanguages, &ed->ed_LangNodes[ed->ed_UsedNodes++]);
    }

    strcpy (name, ed->ed_PrefsWork.lp_CountryName);
    name[0] = ToUpper (name[0]);

    if ((!ed->ed_PrefsWork.lp_CountryName[0]) || (!FindName (&ed->ed_AvailCountries, name)))
    {
	if (node = RemHead (&ed->ed_AvailCountries))
	{
	    strcpy (ed->ed_PrefsWork.lp_CountryName, node->ln_Name);
	    AddHead (&ed->ed_AvailCountries, node);
	}
    }
}


/*****************************************************************************/

VOID SetZone (EdDataPtr ed)
{
    for (ed->ed_Zone = 0; ed->ed_Zone < MAX_ZONES; ed->ed_Zone++)
    {
	if (ed->ed_PrefsWork.lp_GMTOffset == Masks_images[ed->ed_Zone].i_Data)
	{
	    return;
	}
    }
    ed->ed_PrefsWork.lp_GMTOffset = 0;
    ed->ed_Zone = 12;
}

/*****************************************************************************/

EdStatus ReadPrefs (EdDataPtr ed, struct IFFHandle * iff, struct ContextNode * cn)
{
    if (cn->cn_ID != ID_LCLE || cn->cn_Type != ID_PREF)
	return (ES_IFF_UNKNOWNCHUNK);

    if (ReadChunkBytes (iff, ed->ed_PrefsIO, sizeof (struct LocalePrefs)) == sizeof (struct LocalePrefs))
    {
	SetZone (ed);

	return (ES_NORMAL);
    }

    return (ES_IFFERROR);
}


EdStatus OpenPrefs (EdDataPtr ed, STRPTR name)
{

    ed->ed_PrefsIO = &ed->ed_PrefsWork;
    return (ReadIFF (ed, name, IFFPrefChunks, IFFPrefChunkCnt, ReadPrefs));
}


/*****************************************************************************/


EdStatus WritePrefs (EdDataPtr ed, struct IFFHandle * iff, struct ContextNode * cn)
{
    EdStatus retval = ES_IFFERROR;
    WORD i;

    for (i = 0; i < ed->ed_UsedNodes; i++)
	ed->ed_LangNodes[i].ln_Name[0] = ed->ed_LangNodes[i].ln_Type;

    if (!PushChunk (iff, 0, ID_LCLE, sizeof (struct LocalePrefs)))
	if (WriteChunkBytes (iff, &ed->ed_PrefsWork, sizeof (struct LocalePrefs)) == sizeof (struct LocalePrefs))
	    if (!PopChunk (iff))
		retval = ES_NORMAL;

    for (i = 0; i < ed->ed_UsedNodes; i++)
	ed->ed_LangNodes[i].ln_Name[0] = ToUpper (ed->ed_LangNodes[i].ln_Name[0]);

    return (retval);
}


EdStatus SavePrefs (EdDataPtr ed, STRPTR name)
{

    return (WriteIFF (ed, name, &IFFPrefHeader, WritePrefs));
}


/*****************************************************************************/


EdStatus ReadCountry (EdDataPtr ed, struct IFFHandle * iff, struct ContextNode * cn)
{

    if (cn->cn_ID != ID_CTRY || cn->cn_Type != ID_PREF)
	return (ES_IFF_UNKNOWNCHUNK);

    if (ReadChunkBytes (iff, ed->ed_PrefsIO, sizeof (struct CountryPrefs)) == sizeof (struct CountryPrefs))
	return (ES_NORMAL);

    return (ES_IFFERROR);
}


/*****************************************************************************/


#define NW_LEFT      0
#define NW_TOP       0
#define NW_WIDTH     544
#define NW_HEIGHT    176
#define	NW_IDCMP     (IDCMP_MOUSEBUTTONS | IDCMP_MENUPICK | IDCMP_REFRESHWINDOW | BUTTONIDCMP | LISTVIEWIDCMP | SCROLLERIDCMP)
#define	NW_FLAGS     (WFLG_ACTIVATE | WFLG_DEPTHGADGET | WFLG_DRAGBAR | WFLG_SIMPLE_REFRESH)
#define NW_MINWIDTH  NW_WIDTH
#define NW_MINHEIGHT NW_HEIGHT
#define NW_MAXWIDTH  NW_WIDTH
#define NW_MAXHEIGHT NW_HEIGHT
#define ZOOMWIDTH    200

struct EdMenu far EM[] =
{
    {NM_TITLE, MSG_PROJECT_MENU, EC_NOP, 0},
    {NM_ITEM, MSG_PROJECT_OPEN, EC_OPEN, 0},
    {NM_ITEM, MSG_PROJECT_SAVE_AS, EC_SAVEAS, 0},
    {NM_ITEM, MSG_NOTHING, EC_NOP, 0},
    {NM_ITEM, MSG_PROJECT_QUIT, EC_CANCEL, 0},

    {NM_TITLE, MSG_EDIT_MENU, EC_NOP, 0},
    {NM_ITEM, MSG_EDIT_RESET_TO_DEFAULTS, EC_RESETALL, 0},
    {NM_ITEM, MSG_EDIT_LAST_SAVED, EC_LASTSAVED, 0},
    {NM_ITEM, MSG_EDIT_RESTORE, EC_RESTORE, 0},

    {NM_TITLE, MSG_OPTIONS_MENU, EC_NOP, 0},
    {NM_ITEM, MSG_OPTIONS_SAVE_ICONS, EC_SAVEICONS, CHECKIT | MENUTOGGLE},

    {NM_END, MSG_NOTHING, EC_NOP, 0}
};

/* main display gadgets */
struct EdGadget far EG[] =
{
    {BUTTON_KIND, 8, 159, 87, 14, MSG_SAVE_GAD, EC_SAVE, 0},
    {BUTTON_KIND, 228, 159, 87, 14, MSG_USE_GAD, EC_USE, 0},
    {BUTTON_KIND, 449, 159, 87, 14, MSG_CANCEL_GAD, EC_CANCEL, 0},

    {LISTVIEW_KIND, 9, 18, 155, 42, MSG_LOC_AVAILLANG_GAD, EC_ADDLANG, 0},
    {LISTVIEW_KIND, 193, 18, 155, 42, MSG_LOC_PREFLANG_GAD, EC_NOP, 0},
    {LISTVIEW_KIND, 9, 73, 155, WM_HEIGHT, MSG_LOC_COUNTRY_GAD, EC_SELECTCTRY, 0},
    {BUTTON_KIND, 364, 26, 172, 14, MSG_LOC_CLEARLANG_GAD, EC_CLEARLANG, 0},

    {SCROLLER_KIND,
     WM_LEFT + WM_WIDTH - WM_SCROLLERWIDTH,
     WM_TOP,
     WM_SCROLLERWIDTH,
     WM_HEIGHT,
     MSG_NOTHING, EC_SYNCBITMAP, 0}
};

BOOL CreateDisplay (EdDataPtr ed)
{
    struct Rectangle rect;
    BOOL scroll = TRUE;
    UWORD zoomSize[4];
    UWORD topborder;
    UWORD dif = 0;
    UWORD height;
    ULONG mode;

    mode = GetVPModeID (&ed->ed_Screen->ViewPort);
    QueryOverscan (mode, &rect, OSCAN_TEXT);
    height = rect.MaxY - rect.MinY + 1;
    if (height > ed->ed_Screen->Height)
	height = ed->ed_Screen->Height;

    topborder = ed->ed_Screen->WBorTop + ed->ed_Screen->Font->ta_YSize + 1;

    BuildList (ed, &ed->ed_AvailCountries, "LOCALE:Countries", "#?.country", 8, NULL);
    BuildList (ed, &ed->ed_AvailLanguages, "LOCALE:Languages", "#?.language", 9, "english");

    zoomSize[0] = zoomSize[1] = -1;
    zoomSize[2] = ZOOMWIDTH;
    zoomSize[3] = topborder;

    ed->ed_ZoneHeight = WM_HEIGHT;
    ed->ed_WM_LEFT = WM_LEFT;
    ed->ed_WM_WIDTH = WM_WIDTH;

    if ((topborder + EG[7].eg_TopEdge + WM_IMAGEHEIGHT + 26) < height)
    {
	dif = WM_IMAGEHEIGHT - EG[7].eg_Height;

	/* Save, Use & Cancel */
	EG[0].eg_TopEdge += dif;
	EG[1].eg_TopEdge += dif;
	EG[2].eg_TopEdge += dif;

	EG[5].eg_Height += dif;
	EG[7].eg_Height += dif + 4;

	ed->ed_ZoneHeight += dif + 4;
	ed->ed_ZoneYOffset = 0;

	scroll = FALSE;
	ed->ed_WM_LEFT += WM_SCROLLERWIDTH + 1;
	ed->ed_WM_WIDTH -= WM_SCROLLERWIDTH + 1;
    }

    /* How big are we */
    ed->ed_WinHeight = NW_HEIGHT + dif;

    ed->ed_LastAdded = CreateContext (&ed->ed_Gadgets);

    DoPrefsGadget (ed, &EG[0], NULL, TAG_DONE);
    DoPrefsGadget (ed, &EG[1], NULL, TAG_DONE);
    DoPrefsGadget (ed, &EG[2], NULL, TAG_DONE);

    DoPrefsGadget (ed, &EG[3], NULL, GTLV_Labels, &ed->ed_AvailLanguages,
		   LAYOUTA_SPACING, 1,
		   GTLV_ScrollWidth, 18,
		   TAG_DONE);

    if (scroll)
    {
        EG[7].eg_LeftEdge = ed->ed_WM_LEFT + WM_WIDTH - WM_SCROLLERWIDTH;
        ed->ed_VZoneScroller = DoPrefsGadget (ed, &EG[7], NULL,
                                              PGA_Freedom, LORIENT_VERT,
                                              GA_Immediate, TRUE,
                                              GTSC_Top, ed->ed_ZoneYOffset,
                                              GTSC_Visible, ed->ed_ZoneHeight - 4,
                                              GTSC_Total, WM_IMAGEHEIGHT,
                                              GTSC_Arrows, 9,
                                              TAG_DONE);
    }

    RenderGadgets (ed);

    if ((ed->ed_LastAdded)
	&& (ed->ed_Menus = CreatePrefsMenus (ed, EM))
	&& (ed->ed_Window = OpenPrefsWindow (ed,
#if 0
					     WA_Left, NW_LEFT,
					     WA_Top, NW_TOP,
#endif
					     WA_InnerWidth, NW_WIDTH,
					     WA_InnerHeight, ed->ed_WinHeight,
					     WA_MinWidth, NW_MINWIDTH,
					     WA_MinHeight, NW_MINHEIGHT,
					     WA_MaxWidth, NW_MAXWIDTH,
					     WA_MaxHeight, NW_MAXHEIGHT,
					     WA_IDCMP, NW_IDCMP,
					     WA_Flags, NW_FLAGS,
					     WA_Zoom, zoomSize,
					     WA_AutoAdjust, TRUE,
					     WA_PubScreen, ed->ed_Screen,
					     WA_Title, GetString (&ed->ed_LocaleInfo, MSG_LOC_NAME),
					     WA_NewLookMenus, TRUE,
					     WA_Gadgets, ed->ed_Gadgets,
					     TAG_DONE)))
    {
	return (TRUE);
    }

    DisposeDisplay (ed);
    return (FALSE);
}


/*****************************************************************************/


VOID DisposeDisplay (EdDataPtr ed)
{

    if (ed->ed_Window)
    {
	ClearMenuStrip (ed->ed_Window);
	CloseWindow (ed->ed_Window);
    }
    FreeMenus (ed->ed_Menus);
    FreeGadgets (ed->ed_Gadgets);
}


/*****************************************************************************/


VOID PrintTimeZone (EdDataPtr ed)
{
    struct RastPort *rp;
    UWORD len, len2;
    UBYTE str2[60];
    STRPTR str3;
    STRPTR str;
    LONG hour;
    LONG min;

    rp = ed->ed_Window->RPort;
    SetAPen (rp, ed->ed_DrawInfo->dri_Pens[BACKGROUNDPEN]);
    RectFill(rp, ed->ed_WM_LEFT + ed->ed_Window->BorderLeft - 8,
		 WM_TOP + ed->ed_Window->BorderTop - 12,
		 ed->ed_WM_LEFT + ed->ed_Window->BorderLeft + ed->ed_WM_WIDTH + 8 - 1,
		 WM_TOP + ed->ed_Window->BorderTop - 2);

    SetAPen (rp, ed->ed_DrawInfo->dri_Pens[TEXTPEN]);
    SetBPen (rp, ed->ed_DrawInfo->dri_Pens[BACKGROUNDPEN]);

    str = GetString (&ed->ed_LocaleInfo, MSG_LOC_TIMEZONE_BOX);
    len = strlen (str);

    hour = (LONG)ed->ed_PrefsWork.lp_GMTOffset / 60L;
    min  = (LONG) ABS (ed->ed_PrefsWork.lp_GMTOffset - (hour * 60L));
    hour = ABS (hour);
    if (min)
    {
	str3 = GetString (&ed->ed_LocaleInfo, MSG_LOC_HR_MIN);
	sprintf (str2, str3, hour, min);
    }
    else if (hour)
    {
	str3 = GetString (&ed->ed_LocaleInfo, MSG_LOC_HR);
	sprintf (str2, str3, hour);
    }
    else
    {
	strcpy (str2, GetString (&ed->ed_LocaleInfo, MSG_LOC_GMT));
    }
    len2 = strlen (str2);

    Move (rp, (ed->ed_WM_WIDTH - TextLength (rp, str, len) - TextLength (rp, str2, len2)) / 2 + ed->ed_WM_LEFT + ed->ed_Window->BorderLeft,
	  WM_TOP + ed->ed_Window->BorderTop - 6);
    Text (rp, str, len);

    SetAPen (rp, ed->ed_DrawInfo->dri_Pens[HIGHLIGHTTEXTPEN]);
    Text (rp, str2, len2);
}


/*****************************************************************************/


VOID DrawBB (EdDataPtr ed, SHORT x, SHORT y, SHORT w, SHORT h, ULONG tags,...)
{
    DrawBevelBoxA (ed->ed_Window->RPort, x + ed->ed_Window->BorderLeft,
		   y + ed->ed_Window->BorderTop,
		   w, h, (struct TagItem *) & tags);
}


/*****************************************************************************/

VOID CopyPrefs (EdDataPtr ed, struct LocalePrefs *p1, struct LocalePrefs *p2)
{
    *p1 = *p2;
    SetZone (ed);
}

/*****************************************************************************/


VOID RenderDisplay (EdDataPtr ed)
{
    ed->ed_PreviousZone = -1;

    PrintTimeZone (ed);
    DrawBB (ed, ed->ed_WM_LEFT, WM_TOP,
	    WM_WIDTH - WM_SCROLLERWIDTH, ed->ed_ZoneHeight,
	    GT_VisualInfo, ed->ed_VisualInfo,
	    TAG_DONE);

    PutMap (ed);
}


/*****************************************************************************/


VOID RenderGadgets (EdDataPtr ed)
{
    struct Node *node;
    UWORD i;

    if (ed->ed_LangList)
	ed->ed_LangList = DoPrefsGadget (ed, &EG[4], ed->ed_LangList,
					 GTLV_Labels, ~0,
					 TAG_DONE);

    UpdateEdData (ed);

    ed->ed_LangList = DoPrefsGadget (ed, &EG[4], ed->ed_LangList,
				     GTLV_Labels, &ed->ed_PrefLanguages,
				     GTLV_Top, ed->ed_UsedNodes,
				     GTLV_ReadOnly, TRUE,
				     LAYOUTA_SPACING, 1,
				     GTLV_ScrollWidth, 18,
				     TAG_DONE);

    ed->ed_ClearLang = DoPrefsGadget (ed, &EG[6], ed->ed_ClearLang,
				      GA_Disabled, ed->ed_UsedNodes == 0,
				      TAG_DONE);

    i = 0;
    node = ed->ed_AvailCountries.lh_Head;
    while (node->ln_Succ)
    {
	if (Stricmp (ed->ed_PrefsWork.lp_CountryName, node->ln_Name) == 0)
	    break;

	i++;
	node = node->ln_Succ;
    }

    if (!node->ln_Succ)
	i = 0;

    ed->ed_CountryList = DoPrefsGadget (ed, &EG[5], ed->ed_CountryList,
					GTLV_Labels, &ed->ed_AvailCountries,
					GTLV_Selected, i,
					GTLV_MakeVisible, i,
					GTLV_ShowSelected, NULL,
					LAYOUTA_SPACING, 1,
					GTLV_ScrollWidth, 18,
					TAG_DONE);

    if (ed->ed_Window)
    {
	PrintTimeZone (ed);
	PutMap (ed);
    }
}


/*****************************************************************************/


/*
#undef DOSBase
#define DOSBase DOSBase
struct Library * far DOSBase;


VOID MyPrintf(STRPTR format, STRPTR args, ...)
{
    VPrintf(format,&args);
}


VOID __asm PutCh(register __d0 char ch)
{
    if (ch)
        MyPrintf("%lc",(STRPTR)ch);
}


VOID MakeNumber(STRPTR result, STRPTR decPoint, STRPTR thouSep, STRPTR fracSep,
                UBYTE *thouGroup, UBYTE *fracGroup, UBYTE maxFrac)
{
char string[60],string2[60];
WORD i,j,k,cnt,split,oldSplit;

    strcpy(string,"1234567890");

    i        = 0;
    j        = strlen(string)-1;
    oldSplit = 255;
    cnt      = 58;

    while (j >= 0)
    {
        split = thouGroup[i++];
        if (split == 0)
            split = oldSplit;
        oldSplit = split;

        while ((split > 0) && (j >= 0))
        {
            string2[cnt--] = string[j--];
            split--;
        }

        if (j >= 0)
        {
            k = strlen(thouSep);
            while (k > 0)
                string2[cnt--] = thouSep[--k];
        }
    }

    string2[59] = 0;
    strcpy(result,&string2[cnt+1]);

    if (maxFrac)
      strcat(result,decPoint);

    strcpy(string,"987654321");

    i        = 0;
    j        = 0;
    oldSplit = 255;
    cnt      = 0;

    if (maxFrac > strlen(string))
        maxFrac = strlen(string);

    while (j < maxFrac)
    {
        split = fracGroup[i++];
        if (split == 0)
            split = oldSplit;
        oldSplit = split;

        while ((split > 0) && (j < maxFrac))
        {
            string2[cnt++] = string[j++];
            split--;
        }

        if (j < maxFrac)
        {
            k = strlen(fracSep);
            while (k > 0)
                string2[cnt++] = fracSep[--k];
        }
    }

    string2[cnt] = 0;
    strcat(result,string2);
}


VOID DumpCountries(EdDataPtr ed)
{
STRPTR           ms;
char             str[4],string[100];
struct DateStamp date;
struct Locale   *locale;
struct Hook      hook;
struct Node     *node;
char             name[100];

    DateStamp(&date);
    locale = OpenLocale(NULL);
    hook.h_Entry = PutCh;

    MyPrintf("******************\n****************\nLANGUAGE = %s\n\n",locale->loc_LanguageName);

    node = ed->ed_AvailCountries.lh_Head;
    while (node->ln_Succ)
    {
        strcpy(name,"LOCALE:Countries/");
        strcat(name,node->ln_Name);
        strcat(name,".country");

        ed->ed_PrefsIO = &ed->ed_PrefsWork.lp_CountryData;
        ReadIFF(ed,name,IFFPrefChunks,IFFPrefChunkCnt,ReadCountry);
        strcpy(ed->ed_PrefsWork.lp_CountryName,node->ln_Name);

        switch (ed->ed_PrefsWork.lp_CountryData.cp_MeasuringSystem)
        {
            case MS_ISO      : ms = "Metric";
                               break;
            case MS_AMERICAN : ms = "American";
                               break;
            case MS_IMPERIAL : ms = "Imperial";
                               break;
            case MS_BRITISH  : ms = "British";
                               break;
        }

        str[3] = ed->ed_PrefsWork.lp_CountryData.cp_CountryCode & 0xff;
        str[2] = (ed->ed_PrefsWork.lp_CountryData.cp_CountryCode >> 8) & 0xff;
        str[1] = (ed->ed_PrefsWork.lp_CountryData.cp_CountryCode >> 16) & 0xff;
        str[0] = (ed->ed_PrefsWork.lp_CountryData.cp_CountryCode >> 24) & 0xff;

        MyPrintf("\n\nCountry Name                 : %s \n", ed->ed_PrefsWork.lp_CountryName,"");
        MyPrintf("Country Code                 : %.4s\n", str,"");
        MyPrintf("Telephone Code               : %lu\n", (STRPTR)ed->ed_PrefsWork.lp_CountryData.cp_TelephoneCode,"");
        MyPrintf("Measuring System             : %s \n\n", ms,"");

        MyPrintf("Combined Date and Time       : ","","");
        FormatDate(locale,ed->ed_PrefsWork.lp_CountryData.cp_DateTimeFormat,&date,&hook);
        MyPrintf("\n","","");

        MyPrintf("Date                         : ","","");
        FormatDate(locale,ed->ed_PrefsWork.lp_CountryData.cp_DateFormat,&date,&hook);
        MyPrintf("\n","","");

        MyPrintf("Time                         : ","","");
        FormatDate(locale,ed->ed_PrefsWork.lp_CountryData.cp_TimeFormat,&date,&hook);
        MyPrintf("\n\n","","");

        MyPrintf("Short Combined Date and Time : ","","");
        FormatDate(locale,ed->ed_PrefsWork.lp_CountryData.cp_ShortDateTimeFormat,&date,&hook);
        MyPrintf("\n","","");

        MyPrintf("Short Date                   : ","","");
        FormatDate(locale,ed->ed_PrefsWork.lp_CountryData.cp_ShortDateFormat,&date,&hook);
        MyPrintf("\n","","");

        MyPrintf("Short Time                   : ","","");
        FormatDate(locale,ed->ed_PrefsWork.lp_CountryData.cp_ShortTimeFormat,&date,&hook);
        MyPrintf("\n\n","","");

        MyPrintf("Number format                : ","","");
        MakeNumber(string,ed->ed_PrefsWork.lp_CountryData.cp_DecimalPoint,
                          ed->ed_PrefsWork.lp_CountryData.cp_GroupSeparator,
                          ed->ed_PrefsWork.lp_CountryData.cp_FracGroupSeparator,
                          ed->ed_PrefsWork.lp_CountryData.cp_Grouping,
                          ed->ed_PrefsWork.lp_CountryData.cp_FracGrouping,
                          255);
        MyPrintf("%s\n",string,"");

        MyPrintf("Positive Monetary format     : ","","");
        MakeNumber(string,ed->ed_PrefsWork.lp_CountryData.cp_MonDecimalPoint,
                          ed->ed_PrefsWork.lp_CountryData.cp_MonGroupSeparator,
                          ed->ed_PrefsWork.lp_CountryData.cp_MonFracGroupSeparator,
                          ed->ed_PrefsWork.lp_CountryData.cp_MonGrouping,
                          ed->ed_PrefsWork.lp_CountryData.cp_MonFracGrouping,
                          ed->ed_PrefsWork.lp_CountryData.cp_MonFracDigits);


        if (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveCSPos == CSP_PRECEDES)
        {
            switch (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSignPos)
            {
                case SP_PARENS   : MyPrintf("(","");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf("%s",string,"");
                                   MyPrintf(")","");
                                   break;

                case SP_PREC_ALL : MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSign,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf("%s",string,"");
                                   break;

                case SP_SUCC_ALL : MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf("%s",string,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSign,"");
                                   break;

                case SP_PREC_CURR: MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSign,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf("%s",string,"");
                                   break;

                case SP_SUCC_CURR: MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSign,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf("%s",string,"");
                                   break;

            }
        }
        else
        {
            switch (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSignPos)
            {
                case SP_PARENS   : MyPrintf("(","");
                                   MyPrintf("%s",string,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   MyPrintf(")","");
                                   break;

                case SP_PREC_ALL : MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSign,"");
                                   MyPrintf("%s",string,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   break;

                case SP_SUCC_ALL : MyPrintf("%s",string,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSign,"");
                                   break;

                case SP_PREC_CURR: MyPrintf("%s",string,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSign,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   break;

                case SP_SUCC_CURR: MyPrintf("%s",string,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonPositiveSign,"");
                                   break;

            }
        }
        MyPrintf("\n","");


        MyPrintf("Negative Monetary format     : ","");
        MakeNumber(string,ed->ed_PrefsWork.lp_CountryData.cp_MonDecimalPoint,
                          ed->ed_PrefsWork.lp_CountryData.cp_MonGroupSeparator,
                          ed->ed_PrefsWork.lp_CountryData.cp_MonFracGroupSeparator,
                          ed->ed_PrefsWork.lp_CountryData.cp_MonGrouping,
                          ed->ed_PrefsWork.lp_CountryData.cp_MonFracGrouping,
                          ed->ed_PrefsWork.lp_CountryData.cp_MonFracDigits);


        if (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeCSPos == CSP_PRECEDES)
        {
            switch (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSignPos)
            {
                case SP_PARENS   : MyPrintf("(","");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf("%s",string);
                                   MyPrintf(")","");
                                   break;

                case SP_PREC_ALL : MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSign,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf("%s",string);
                                   break;

                case SP_SUCC_ALL : MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf("%s",string);
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSign,"");
                                   break;

                case SP_PREC_CURR: MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSign,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf("%s",string);
                                   break;

                case SP_SUCC_CURR: MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSign,"");
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf("%s",string);
                                   break;

            }
        }
        else
        {
            switch (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSignPos)
            {
                case SP_PARENS   : MyPrintf("(","");
                                   MyPrintf("%s",string);
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   MyPrintf(")","");
                                   break;

                case SP_PREC_ALL : MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSign,"");
                                   MyPrintf("%s",string);
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   break;

                case SP_SUCC_ALL : MyPrintf("%s",string);
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSign,"");
                                   break;

                case SP_PREC_CURR: MyPrintf("%s",string);
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSign,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   break;

                case SP_SUCC_CURR: MyPrintf("%s",string);
                                   if (ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSpaceSep == SS_SPACE)
                                       MyPrintf(" ","");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonCS,"");
                                   MyPrintf(ed->ed_PrefsWork.lp_CountryData.cp_MonNegativeSign,"");
                                   break;

            }
        }

        MyPrintf("\n\n","");
        MyPrintf("Small Currency Symbol        : %s\n",ed->ed_PrefsWork.lp_CountryData.cp_MonSmallCS);
        MyPrintf("International Monetary Symbol: %s\n",ed->ed_PrefsWork.lp_CountryData.cp_MonIntCS);

        node = node->ln_Succ;
    }
    CloseLocale(locale);
}
*/


/*****************************************************************************/


VOID ProcessSpecialCommand (EdDataPtr ed, EdCommand ec)
{
    struct Node *node;
    struct Node *langNode;
    UWORD i;
    EdStatus error;
    char name[60];

/*
    DOSBase = ed->ed_DOSBase;
*/

    switch (ec)
    {
	case EC_SYNCBITMAP:
	    PutMap (ed);
	    break;

	case EC_CLEARLANG:
	    SetGadgetAttr (ed, ed->ed_LangList, GTLV_Labels, NULL,
			   TAG_DONE);
	    NewList (&ed->ed_PrefLanguages);
	    ed->ed_UsedNodes = 0;
	    for (i = 0; i < 10; i++)
		ed->ed_PrefsWork.lp_PreferredLanguages[i][0] = NULL;

	    SetGadgetAttr (ed, ed->ed_ClearLang, GA_Disabled, TRUE,
			   TAG_DONE);
	    break;

	case EC_ADDLANG:
	    i = ed->ed_CurrentMsg.Code;
	    langNode = ed->ed_AvailLanguages.lh_Head;
	    while (i--)
	    {
		langNode = langNode->ln_Succ;
	    }

	    node = ed->ed_PrefLanguages.lh_Head;
	    while (node->ln_Succ)
	    {
		if (Stricmp (node->ln_Name, langNode->ln_Name) == 0)
		{
		    break;
		}
		node = node->ln_Succ;
	    }

	    if ((!node->ln_Succ) && (ed->ed_UsedNodes < 10))
	    {
		SetGadgetAttr (ed, ed->ed_LangList, GTLV_Labels, ~0,
			       TAG_DONE);

		strcpy (ed->ed_PrefsWork.lp_PreferredLanguages[ed->ed_UsedNodes], langNode->ln_Name);
		node = &ed->ed_LangNodes[ed->ed_UsedNodes];
		node->ln_Type = langNode->ln_Type;
		AddTail (&ed->ed_PrefLanguages, node);

		SetGadgetAttr (ed, ed->ed_LangList, GTLV_Labels, &ed->ed_PrefLanguages,
			       GTLV_Top, ed->ed_UsedNodes,
			       TAG_DONE);
		SetGadgetAttr (ed, ed->ed_ClearLang, GA_Disabled, FALSE,
			       TAG_DONE);
		ed->ed_UsedNodes++;
	    }
	    else
	    {
		DisplayBeep (NULL);
	    }
	    break;

	case EC_SELECTCTRY:	/* DumpCountries(ed); */
	    i = ed->ed_CurrentMsg.Code;
	    node = ed->ed_AvailCountries.lh_Head;
	    while (i--)
	    {
		node = node->ln_Succ;
	    }
	    strcpy (name, "LOCALE:Countries/");
	    strcat (name, node->ln_Name);
	    name[17] = node->ln_Type;
	    strcat (name, ".country");

	    ed->ed_PrefsIO = &ed->ed_PrefsWork.lp_CountryData;
	    if ((error = ReadIFF (ed, name, IFFPrefChunks, IFFPrefChunkCnt, ReadCountry)) != ES_NORMAL)
	    {
		ShowError2 (ed, error);
	    }

	    strcpy (ed->ed_PrefsWork.lp_CountryName, node->ln_Name);
	    ed->ed_PrefsWork.lp_CountryName[0] = node->ln_Type;
	    break;

	default:
	    break;
    }
}


/*****************************************************************************/


EdCommand GetCommand (EdDataPtr ed)
{
    struct IntuiMessage *intuiMsg;
    struct Window *intuiWindow;
    UWORD oldzone = ed->ed_Zone;

    intuiMsg = &ed->ed_CurrentMsg;
    intuiWindow = intuiMsg->IDCMPWindow;

    switch (intuiMsg->Class)
    {
	case MOUSEBUTTONS:
	    if (intuiMsg->Code == SELECTDOWN)
	    {
		if ((intuiMsg->MouseX - intuiWindow->BorderLeft >= ed->ed_WM_LEFT)
		    && (intuiMsg->MouseX - intuiWindow->BorderLeft <= ed->ed_WM_LEFT + WM_WIDTH - WM_SCROLLERWIDTH - 4)
		    && (intuiMsg->MouseY - intuiWindow->BorderTop >= WM_TOP)
		    && (intuiMsg->MouseY - intuiWindow->BorderTop <= WM_TOP + ed->ed_ZoneHeight - 1))
		{
		    PickTimeZone (ed, intuiMsg->MouseX, intuiMsg->MouseY);

		    if (ed->ed_Zone != oldzone)
		    {
			PrintTimeZone (ed);
			PutMap (ed);
		    }
		}
	    }
	    break;

	default:
	    break;
    }

    return (EC_NOP);
}


/*****************************************************************************/


VOID GetSpecialCmdState (EdDataPtr ed, EdCommand ec, CmdStatePtr state)
{

    state->cs_Available = TRUE;
    state->cs_Selected = FALSE;
}
@


38.29
log
@removed .country from united_states.country
@
text
@d521 1
a521 2
    zoomSize[0] = NW_LEFT;
    zoomSize[1] = NW_TOP;
d759 1
@


38.28
log
@updated default settings
@
text
@d210 1
a210 1
        strcpy(ed->ed_PrefsDefaults.lp_CountryName,"united_states.country");
@


38.27
log
@add setzone to the copyprefs function.
@
text
@d209 48
d301 1
@


38.26
log
@removed WA_LeftEdge, WA_TopEdge tags
added OSCAN_TEXT checking
@
text
@d634 1
a634 2
VOID DrawBB (EdDataPtr ed, SHORT x, SHORT y,
	      SHORT w, SHORT h, ULONG tags,...)
a635 1

d641 8
@


38.25
log
@changed offset of GMT display
@
text
@d453 1
d458 2
d461 6
d481 1
a481 1
    if ((topborder + EG[7].eg_TopEdge + WM_IMAGEHEIGHT + 26) < ed->ed_Screen->Height)
d532 3
a534 1
	&& (ed->ed_Window = OpenPrefsWindow (ed, WA_Left, NW_LEFT,
d536 1
@


38.24
log
@Fixed array overrun problem
@
text
@d580 1
a580 1
    RectFill(rp, ed->ed_WM_LEFT + ed->ed_Window->BorderLeft,
d582 1
a582 1
		 ed->ed_WM_LEFT + ed->ed_Window->BorderLeft + ed->ed_WM_WIDTH - 1,
@


38.23
log
@now use GMT when offset is zero.
Uppercase the first letter of country and catalog names
@
text
@d359 1
a359 1
    for (i = 0; i <= ed->ed_UsedNodes; i++)
d367 1
a367 1
    for (i = 0; i <= ed->ed_UsedNodes; i++)
@


38.22
log
@added arrows to map scroller.
remove map scroller if map can't scroll.
@
text
@d111 2
d149 2
d284 1
d291 2
d296 4
a299 1
    if ((!ed->ed_PrefsWork.lp_CountryName[0]) || (!FindName (&ed->ed_AvailCountries, ed->ed_PrefsWork.lp_CountryName)))
d356 5
d365 1
a365 1
		return (ES_NORMAL);
d367 4
a370 1
    return (ES_IFFERROR);
d599 1
a599 1
    else
d604 4
d1145 1
d1170 1
d1180 1
@


38.21
log
@shows hours as absolute.
fixed array max. problem.
@
text
@d423 1
a423 1
    {BUTTON_KIND, 364, 26, 171, 14, MSG_LOC_CLEARLANG_GAD, EC_CLEARLANG, 0},
a432 1

d435 1
d451 2
d468 4
d488 12
a499 6
    ed->ed_VZoneScroller = DoPrefsGadget (ed, &EG[7], NULL, GTSC_Top, ed->ed_ZoneYOffset,
					  GTSC_Visible, ed->ed_ZoneHeight - 4,
					  GTSC_Total, WM_IMAGEHEIGHT,
					  PGA_Freedom, LORIENT_VERT,
					  GA_Immediate, TRUE,
					  TAG_DONE);
d562 1
a562 1
    RectFill(rp, WM_LEFT + ed->ed_Window->BorderLeft,
d564 1
a564 1
		 WM_LEFT + ed->ed_Window->BorderLeft + WM_WIDTH - 1,
d588 1
a588 1
    Move (rp, (WM_WIDTH - TextLength (rp, str, len) - TextLength (rp, str2, len2)) / 2 + WM_LEFT + ed->ed_Window->BorderLeft,
d618 1
a618 1
    DrawBB (ed, WM_LEFT, WM_TOP,
d1171 1
d1181 2
a1182 2
		if ((intuiMsg->MouseX - intuiWindow->BorderLeft >= WM_LEFT)
		    && (intuiMsg->MouseX - intuiWindow->BorderLeft <= WM_LEFT + WM_WIDTH - WM_SCROLLERWIDTH - 4)
d1187 6
a1192 2
		    PrintTimeZone (ed);
		    PutMap (ed);
@


38.20
log
@changed time values to minutes from GMT
@
text
@d212 1
d311 2
d562 2
a563 1
    min  = (LONG)ed->ed_PrefsWork.lp_GMTOffset - (hour * 60L);
d567 1
a567 1
	sprintf (str2, str3, hour, ABS(min));
@


38.19
log
@fixed refresh problem (map not updating on REFRESH event)
@
text
@d20 1
d206 1
a206 1
	ed->ed_PrefsDefaults.lp_GMTOffset = 5;
d301 10
d312 2
a315 1

d320 3
d324 1
d537 4
d542 2
a543 3
    UBYTE str2[20];
    UWORD len, len2;
    struct RastPort *rp;
d546 6
d557 13
a569 5
#if 1
    sprintf (str2, "%2ld ", ed->ed_PrefsWork.lp_GMTOffset);
#else
    str2 = GetString (&ed->ed_LocaleInfo, MSG_LOC_TZ0 + ed->ed_PrefsWork.lp_GMTOffset + 10);
#endif
@


38.18
log
@new zone message
@
text
@d566 1
@


38.17
log
@made time zone listview dynamic in height.
@
text
@d20 1
d51 2
a188 1

d193 1
a193 1
    for (i = 0; i < 10; i++)
d195 55
a249 50
	ed->ed_PrefsDefaults.lp_PreferredLanguages[i][0] = NULL;
	ed->ed_LangNodes[i].ln_Name = ed->ed_PrefsWork.lp_PreferredLanguages[i];
    }

    ed->ed_PreviousYOffset = -1;
    ed->ed_PreviousZone = -1;

    ed->ed_PrefsDefaults.lp_CountryName[0] = NULL;
    ed->ed_PrefsDefaults.lp_GMTOffset = -5;
    ed->ed_PrefsDefaults.lp_Flags = 0;

    ed->ed_PrefsDefaults.lp_CountryData.cp_CountryCode = MAKE_ID ('U', 'S', 'A', '\0');
    ed->ed_PrefsDefaults.lp_CountryData.cp_TelephoneCode = 1;
    ed->ed_PrefsDefaults.lp_CountryData.cp_MeasuringSystem = MS_AMERICAN;

    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_DateTimeFormat, "%A %B %e %Y %I:%M %p");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_DateFormat, "%A %B %e %Y");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_TimeFormat, "%I:%M %p");

    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_ShortDateTimeFormat, "%m/%d/%y %I:%M %p");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_ShortDateFormat, "%m/%d/%y");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_ShortTimeFormat, "%I:%M");

    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_DecimalPoint, ".");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_GroupSeparator, ",");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_FracGroupSeparator, ",");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_Grouping, "\3\0");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_FracGrouping, "\3\0");

    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonDecimalPoint, ".");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonGroupSeparator, ",");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracGroupSeparator, ",");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonGrouping, "\3\0");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracGrouping, "\3\0");
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracDigits = 2;
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonIntFracDigits = 2;

    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonCS, "$");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonSmallCS, "¢");
    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonIntCS, "USD");

    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveSign, "");
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveSpaceSep = SS_NOSPACE;
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveSignPos = SP_PREC_ALL;
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveCSPos = CSP_PRECEDES;

    strcpy (ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSign, "-");
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSpaceSep = SS_NOSPACE;
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSignPos = SP_PREC_ALL;
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeCSPos = CSP_PRECEDES;
d251 1
a251 2
    ed->ed_PrefsWork = ed->ed_PrefsDefaults;
    ed->ed_PrefsInitial = ed->ed_PrefsDefaults;
d253 1
a253 1
    NewList (&ed->ed_PrefLanguages);
d255 2
a256 1
    ed->ed_ZoneYOffset = 45;
d258 1
a258 1
    return (ES_NORMAL);
a266 1

d268 1
d397 3
a399 3
    {BUTTON_KIND,     8, 159, 87, 14, MSG_SAVE_GAD, EC_SAVE, 0},
    {BUTTON_KIND,   228, 159, 87, 14, MSG_USE_GAD, EC_USE, 0},
    {BUTTON_KIND,   449, 159, 87, 14, MSG_CANCEL_GAD, EC_CANCEL, 0},
d401 4
a404 4
    {LISTVIEW_KIND,   9, 18, 155, 42, MSG_LOC_AVAILLANG_GAD, EC_ADDLANG, 0},
    {LISTVIEW_KIND, 193, 18, 155, 42, MSG_LOC_PREFLANG_GAD,  EC_NOP, 0},
    {LISTVIEW_KIND,   9, 73, 155, 76, MSG_LOC_COUNTRY_GAD,   EC_SELECTCTRY, 0},
    {BUTTON_KIND,   364, 26, 171, 14, MSG_LOC_CLEARLANG_GAD, EC_CLEARLANG, 0},
d407 5
a411 5
	WM_LEFT + WM_WIDTH - WM_SCROLLERWIDTH,
	WM_TOP,
	WM_SCROLLERWIDTH,
	WM_HEIGHT,
	MSG_NOTHING, EC_SYNCBITMAP, 0}
d433 1
a433 1
    if ((topborder + EG[7].eg_TopEdge + WM_IMAGEHEIGHT) < ed->ed_Screen->Height)
d437 1
d441 1
d444 1
d521 2
a522 1
    STRPTR str, str2;
d532 3
d536 1
d566 1
@


38.16
log
@Changes for new prefs shell
@
text
@d72 3
a74 3
    0,   /* version */
    0,   /* type    */
    0    /* flags   */
d81 2
a82 2
EdStatus BuildList(EdDataPtr ed, struct List *list, STRPTR directory,
		   STRPTR pattern, WORD strip, STRPTR extra)
d84 12
a95 12
UBYTE                exAllBuffer[512];
struct ExAllControl *eac;
struct ExAllData    *ead;
BPTR                 lock;
BOOL                 more;
char                 pat[20];
BOOL                 ok;
BOOL                 nomem = FALSE;
UWORD                len;
STRPTR		     name;
struct Node         *node;
struct Node         *new;
d97 1
a97 1
    NewList(list);
d101 2
a102 2
        len = strlen(extra);
	if (new = AllocRemember(&ed->ed_Tracker,sizeof(struct Node)+len+1,MEMF_PUBLIC|MEMF_CLEAR))
d104 4
a107 4
	    new->ln_Name = (STRPTR)((ULONG)new + sizeof(struct Node));
            CopyMem(extra,new->ln_Name,len);
            AddHead(list,(struct Node *)new);
        }
d111 1
a111 1
    if (eac = (struct ExAllControl *) AllocDosObject(DOS_EXALLCONTROL,0))
d113 3
a115 3
        ParsePatternNoCase(pattern,pat,20);
        eac->eac_LastKey     = 0;
        eac->eac_MatchString = pat;
d117 40
a156 35
        if (lock = Lock(directory,ACCESS_READ))
        {
            ok = TRUE;
            do
            {
                more = ExAll(lock,(struct ExAllData *)exAllBuffer,sizeof(exAllBuffer),ED_TYPE,eac);
                if ((!more) && (IoErr() != ERROR_NO_MORE_ENTRIES))
                {
                    ok = FALSE;
                    break;
                }

                if (eac->eac_Entries > 0)
                {
                    ead = (struct ExAllData *) exAllBuffer;
                    do
                    {
                        if (ead->ed_Type < 0)
                        {
		            name = (STRPTR)ead->ed_Name;
		    	    len  = strlen(name) - strip;

			    if (new = AllocRemember(&ed->ed_Tracker,sizeof(struct Node)+len+1,MEMF_PUBLIC|MEMF_CLEAR))
		            {
			        new->ln_Name = (STRPTR)((ULONG)new + sizeof(struct Node));
                                CopyMem(name,new->ln_Name,len);

                                node = list->lh_Head;
                                while (node->ln_Succ)
                                {
                                    if (Stricmp(node->ln_Name,new->ln_Name) >= 0)
                                        break;
                                    node = node->ln_Succ;
                                }
                                Insert(list,new,node->ln_Pred);
d158 11
a168 16
                            else
                            {
                                nomem = TRUE;
                                break;
                            }
                        }
                        ead = ead->ed_Next;
                    }
                    while (ead);
                }
            }
            while (more);

            UnLock(lock);
        }
        FreeDosObject(DOS_EXALLCONTROL,eac);
d173 2
a174 2
        SetIoErr(ERROR_NO_FREE_STORE);
        ok = FALSE;
d178 1
a178 1
      return(ES_NORMAL);
d180 1
a180 1
    return(ES_DOSERROR);
d187 1
a187 1
EdStatus InitEdData(EdDataPtr ed)
d189 1
a189 1
UWORD i;
d191 1
a191 1
    for (i=0; i<10; i++)
d193 2
a194 2
        ed->ed_PrefsDefaults.lp_PreferredLanguages[i][0] = NULL;
        ed->ed_LangNodes[i].ln_Name = ed->ed_PrefsWork.lp_PreferredLanguages[i];
d197 3
d201 2
a202 2
    ed->ed_PrefsDefaults.lp_GMTOffset      = -5;
    ed->ed_PrefsDefaults.lp_Flags          = 0;
d204 29
a232 29
    ed->ed_PrefsDefaults.lp_CountryData.cp_CountryCode         = MAKE_ID('U','S','A','\0');
    ed->ed_PrefsDefaults.lp_CountryData.cp_TelephoneCode       = 1;
    ed->ed_PrefsDefaults.lp_CountryData.cp_MeasuringSystem     = MS_AMERICAN;

    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_DateTimeFormat,      "%A %B %e %Y %I:%M %p");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_DateFormat,          "%A %B %e %Y");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_TimeFormat,          "%I:%M %p");

    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_ShortDateTimeFormat, "%m/%d/%y %I:%M %p");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_ShortDateFormat,     "%m/%d/%y");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_ShortTimeFormat,     "%I:%M");

    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_DecimalPoint,        ".");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_GroupSeparator,      ",");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_FracGroupSeparator,  ",");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_Grouping,            "\3\0");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_FracGrouping,        "\3\0");

    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonDecimalPoint,      ".");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonGroupSeparator,    ",");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracGroupSeparator,",");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonGrouping,          "\3\0");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracGrouping,      "\3\0");
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracDigits       = 2;
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonIntFracDigits    = 2;

    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonCS,               "$");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonSmallCS,          "¢");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonIntCS,            "USD");
d234 1
a234 1
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveSign,"");
d236 2
a237 2
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveSignPos  = SP_PREC_ALL;
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveCSPos    = CSP_PRECEDES;
d239 1
a239 1
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSign,"-");
d241 2
a242 2
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSignPos  = SP_PREC_ALL;
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeCSPos    = CSP_PRECEDES;
d244 1
a244 1
    ed->ed_PrefsWork    = ed->ed_PrefsDefaults;
d247 1
a247 1
    NewList(&ed->ed_PrefLanguages);
d251 1
a251 1
    return(ES_NORMAL);
d258 1
a258 1
VOID CleanUpEdData(EdDataPtr ed)
d260 2
a261 1
    FreeRemember(&ed->ed_Tracker,TRUE);
d268 1
a268 1
VOID UpdateEdData(EdDataPtr ed)
d270 1
a270 1
struct Node *node;
d272 1
a272 1
    NewList(&ed->ed_PrefLanguages);
d277 1
a277 1
        AddTail(&ed->ed_PrefLanguages,&ed->ed_LangNodes[ed->ed_UsedNodes++]);
d280 1
a280 1
    if ((!ed->ed_PrefsWork.lp_CountryName[0]) || (!FindName(&ed->ed_AvailCountries,ed->ed_PrefsWork.lp_CountryName)))
d282 5
a286 5
        if (node = RemHead(&ed->ed_AvailCountries))
        {
            strcpy(ed->ed_PrefsWork.lp_CountryName,node->ln_Name);
            AddHead(&ed->ed_AvailCountries,node);
        }
d294 1
a294 1
EdStatus ReadPrefs(EdDataPtr ed, struct IFFHandle *iff, struct ContextNode *cn)
d296 1
d298 1
a298 1
        return(ES_IFF_UNKNOWNCHUNK);
d300 2
a301 2
    if (ReadChunkBytes(iff,ed->ed_PrefsIO,sizeof(struct LocalePrefs)) == sizeof(struct LocalePrefs))
        return(ES_NORMAL);
d303 2
a304 2
    return(ES_IFFERROR);
}
d307 1
a307 1
EdStatus OpenPrefs(EdDataPtr ed, STRPTR name)
d309 1
d311 1
a311 1
    return(ReadIFF(ed,name,IFFPrefChunks,IFFPrefChunkCnt,ReadPrefs));
d318 1
a318 1
EdStatus WritePrefs(EdDataPtr ed, struct IFFHandle *iff, struct ContextNode *cn)
d320 5
a324 4
    if (!PushChunk(iff,0,ID_LCLE,sizeof(struct LocalePrefs)))
        if (WriteChunkBytes(iff,&ed->ed_PrefsWork,sizeof(struct LocalePrefs)) == sizeof(struct LocalePrefs))
            if (!PopChunk(iff))
                return(ES_NORMAL);
d326 1
a326 1
    return(ES_IFFERROR);
d330 1
a330 1
EdStatus SavePrefs(EdDataPtr ed, STRPTR name)
d332 2
a333 1
    return(WriteIFF(ed,name,&IFFPrefHeader,WritePrefs));
d340 1
a340 1
EdStatus ReadCountry(EdDataPtr ed, struct IFFHandle *iff, struct ContextNode *cn)
d342 1
d344 1
a344 1
        return(ES_IFF_UNKNOWNCHUNK);
d346 2
a347 2
    if (ReadChunkBytes(iff,ed->ed_PrefsIO,sizeof(struct CountryPrefs)) == sizeof(struct CountryPrefs))
        return(ES_NORMAL);
d349 1
a349 1
    return(ES_IFFERROR);
d368 12
a379 11
struct EdMenu far EM[] = {
    {NM_TITLE,  MSG_PROJECT_MENU,           EC_NOP, 0},
      {NM_ITEM, MSG_PROJECT_OPEN,           EC_OPEN, 0},
      {NM_ITEM, MSG_PROJECT_SAVE_AS,        EC_SAVEAS, 0},
      {NM_ITEM, MSG_NOTHING,                EC_NOP, 0},
      {NM_ITEM, MSG_PROJECT_QUIT,           EC_CANCEL, 0},

    {NM_TITLE,  MSG_EDIT_MENU,              EC_NOP, 0},
      {NM_ITEM, MSG_EDIT_RESET_TO_DEFAULTS, EC_RESETALL, 0},
      {NM_ITEM, MSG_EDIT_LAST_SAVED,        EC_LASTSAVED, 0},
      {NM_ITEM, MSG_EDIT_RESTORE,           EC_RESTORE, 0},
d381 2
a382 2
    {NM_TITLE,  MSG_OPTIONS_MENU,           EC_NOP, 0},
      {NM_ITEM, MSG_OPTIONS_SAVE_ICONS,     EC_SAVEICONS, CHECKIT|MENUTOGGLE},
d384 1
a384 1
    {NM_END,    MSG_NOTHING,                EC_NOP, 0}
d388 17
a404 11
struct EdGadget far EG[] = {
    {BUTTON_KIND,   8,   159, 87,  14, MSG_SAVE_GAD,      EC_SAVE,      0},
    {BUTTON_KIND,   228, 159, 87,  14, MSG_USE_GAD,       EC_USE,       0},
    {BUTTON_KIND,   449, 159, 87,  14, MSG_CANCEL_GAD,    EC_CANCEL,    0},

    {LISTVIEW_KIND, 9,   18,  155, 42, MSG_LOC_AVAILLANG_GAD, EC_ADDLANG,   0},
    {LISTVIEW_KIND, 193, 18,  155, 42, MSG_LOC_PREFLANG_GAD,  EC_NOP,       0},
    {LISTVIEW_KIND, 9,   73,  155, 76, MSG_LOC_COUNTRY_GAD,   EC_SELECTCTRY,0},
    {BUTTON_KIND,   364, 26,  171, 14, MSG_LOC_CLEARLANG_GAD, EC_CLEARLANG, 0},

    {SCROLLER_KIND, WM_LEFT+WM_WIDTH-WM_SCROLLERWIDTH, WM_TOP, WM_SCROLLERWIDTH, WM_HEIGHT, MSG_NOTHING, EC_SYNCBITMAP, 0}
d408 1
a408 1
BOOL CreateDisplay(EdDataPtr ed)
d410 5
a414 1
UWORD zoomSize[4];
d416 2
a417 2
    BuildList(ed,&ed->ed_AvailCountries,"LOCALE:Countries","#?.country",8,NULL);
    BuildList(ed,&ed->ed_AvailLanguages,"LOCALE:Languages","#?.language",9,"english");
d422 3
a424 1
    zoomSize[3] = ed->ed_Screen->WBorTop + ed->ed_Screen->Font->ta_YSize + 1;
d426 33
a458 16
    ed->ed_LastAdded = CreateContext(&ed->ed_Gadgets);
    DoPrefsGadget(ed,&EG[0],NULL,TAG_DONE);
    DoPrefsGadget(ed,&EG[1],NULL,TAG_DONE);
    DoPrefsGadget(ed,&EG[2],NULL,TAG_DONE);

    DoPrefsGadget(ed,&EG[3],NULL,GTLV_Labels,       &ed->ed_AvailLanguages,
                                 LAYOUTA_SPACING,   1,
                                 GTLV_ScrollWidth,  18,
                                 TAG_DONE);

    ed->ed_VZoneScroller = DoPrefsGadget(ed,&EG[7],NULL,GTSC_Top,     ed->ed_ZoneYOffset,
                                                        GTSC_Visible, WM_HEIGHT-4,
                                                        GTSC_Total,   WM_IMAGEHEIGHT,
                                                        PGA_Freedom,  LORIENT_VERT,
                                                        GA_Immediate, TRUE,
                                                        TAG_DONE);
d460 1
a460 1
    RenderGadgets(ed);
d463 28
a490 28
    &&  (ed->ed_Menus = CreatePrefsMenus(ed,EM))
    &&  (ed->ed_Window = OpenPrefsWindow(ed,WA_Left,        NW_LEFT,
                                            WA_Top,         NW_TOP,
                                            WA_InnerWidth,  NW_WIDTH,
                                            WA_InnerHeight, NW_HEIGHT,
                                            WA_MinWidth,    NW_MINWIDTH,
                                            WA_MinHeight,   NW_MINHEIGHT,
                                            WA_MaxWidth,    NW_MAXWIDTH,
                                            WA_MaxHeight,   NW_MAXHEIGHT,
                                            WA_IDCMP,       NW_IDCMP,
                                            WA_Flags,       NW_FLAGS,
                                            WA_Zoom,        zoomSize,
                                            WA_AutoAdjust,  TRUE,
                                            WA_PubScreen,   ed->ed_Screen,
                                            WA_Title,       GetString(&ed->ed_LocaleInfo,MSG_LOC_NAME),
                                            WA_NewLookMenus,TRUE,
                                            WA_Gadgets,     ed->ed_Gadgets,
                                            TAG_DONE)))
    {
        return(TRUE);
    }

    DisposeDisplay(ed);
    return(FALSE);
}


/*****************************************************************************/
d493 1
a493 1
VOID DisposeDisplay(EdDataPtr ed)
d495 1
d498 2
a499 2
        ClearMenuStrip(ed->ed_Window);
        CloseWindow(ed->ed_Window);
d501 9
a509 9
    FreeMenus(ed->ed_Menus);
    FreeGadgets(ed->ed_Gadgets);
}


/*****************************************************************************/


VOID PrintTimeZone(EdDataPtr ed)
d511 3
a513 3
STRPTR           str,str2;
UWORD            len,len2;
struct RastPort *rp;
d516 2
a517 2
    SetAPen(rp,ed->ed_DrawInfo->dri_Pens[TEXTPEN]);
    SetBPen(rp,ed->ed_DrawInfo->dri_Pens[BACKGROUNDPEN]);
d519 46
a564 44
    str  = GetString(&ed->ed_LocaleInfo,MSG_LOC_TIMEZONE_BOX);
    len  = strlen(str);
    str2 = GetString(&ed->ed_LocaleInfo,MSG_LOC_TZ0+ed->ed_PrefsWork.lp_GMTOffset+10);
    len2 = strlen(str2);

    Move(rp,(WM_WIDTH-TextLength(rp,str,len)-TextLength(rp,str2,len2)) / 2 + WM_LEFT + ed->ed_Window->BorderLeft,
                WM_TOP+ed->ed_Window->BorderTop-6);
    Text(rp,str,len);

    SetAPen(rp,ed->ed_DrawInfo->dri_Pens[HIGHLIGHTTEXTPEN]);
    Text(rp,str2,len2);
}


/*****************************************************************************/


VOID DrawBB(EdDataPtr ed, SHORT x, SHORT y,
                                     SHORT w, SHORT h, ULONG tags, ...)
{
    DrawBevelBoxA(ed->ed_Window->RPort,x+ed->ed_Window->BorderLeft,
                                       y+ed->ed_Window->BorderTop,
                                       w,h,(struct TagItem *)&tags);
}


/*****************************************************************************/


VOID RenderDisplay(EdDataPtr ed)
{
    PrintTimeZone(ed);
    DrawBB(ed,WM_LEFT,WM_TOP,WM_WIDTH-WM_SCROLLERWIDTH,WM_HEIGHT,
              GT_VisualInfo,ed->ed_VisualInfo,
              TAG_DONE);

    PutMap(ed);
}


/*****************************************************************************/


VOID RenderGadgets(EdDataPtr ed)
d566 2
a567 2
struct Node *node;
UWORD        i;
d570 3
a572 3
        ed->ed_LangList = DoPrefsGadget(ed,&EG[4],ed->ed_LangList,
                                                  GTLV_Labels,      ~0,
                                                  TAG_DONE);
d574 13
a586 13
    UpdateEdData(ed);

    ed->ed_LangList = DoPrefsGadget(ed,&EG[4],ed->ed_LangList,
                                              GTLV_Labels,      &ed->ed_PrefLanguages,
                                              GTLV_Top,         ed->ed_UsedNodes,
                                              GTLV_ReadOnly,    TRUE,
                                              LAYOUTA_SPACING,  1,
                                              GTLV_ScrollWidth, 18,
                                              TAG_DONE);

    ed->ed_ClearLang = DoPrefsGadget(ed,&EG[6],ed->ed_ClearLang,
                                               GA_Disabled,ed->ed_UsedNodes == 0,
                                               TAG_DONE);
d588 1
a588 1
    i    = 0;
d592 2
a593 2
        if (Stricmp(ed->ed_PrefsWork.lp_CountryName,node->ln_Name) == 0)
            break;
d595 2
a596 2
        i++;
        node = node->ln_Succ;
d600 1
a600 1
        i = 0;
d602 7
a608 7
    ed->ed_CountryList = DoPrefsGadget(ed,&EG[5],ed->ed_CountryList,
                                                 GTLV_Labels,       &ed->ed_AvailCountries,
                                                 GTLV_Selected,     i,
                                                 GTLV_ShowSelected, NULL,
                                                 LAYOUTA_SPACING,   1,
                                                 GTLV_ScrollWidth,  18,
                                                 TAG_DONE);
d612 2
a613 2
        PrintTimeZone(ed);
        PutMap(ed);
d1002 1
a1002 1
VOID ProcessSpecialCommand(EdDataPtr ed, EdCommand ec)
d1004 5
a1008 5
struct Node   *node;
struct Node   *langNode;
UWORD          i;
EdStatus       error;
char	       name[60];
d1016 3
a1018 2
        case EC_SYNCBITMAP : PutMap(ed);
                             break;
d1020 82
a1101 79
        case EC_CLEARLANG  : SetGadgetAttr(ed,ed->ed_LangList,GTLV_Labels,NULL,
                                                              TAG_DONE);
                             NewList(&ed->ed_PrefLanguages);
                             ed->ed_UsedNodes = 0;
                             for (i=0; i<10; i++)
                                 ed->ed_PrefsWork.lp_PreferredLanguages[i][0] = NULL;

                             SetGadgetAttr(ed,ed->ed_ClearLang,GA_Disabled,TRUE,
                                                               TAG_DONE);
                             break;

        case EC_ADDLANG    : i        = ed->ed_CurrentMsg.Code;
                             langNode = ed->ed_AvailLanguages.lh_Head;
                             while (i--)
                             {
                                 langNode = langNode->ln_Succ;
                             }

                             node  = ed->ed_PrefLanguages.lh_Head;
                             while (node->ln_Succ)
                             {
                                 if (Stricmp(node->ln_Name,langNode->ln_Name) == 0)
                                 {
                                     break;
                                 }
                                 node = node->ln_Succ;
                             }

                             if ((!node->ln_Succ) && (ed->ed_UsedNodes < 10))
                             {
                                 SetGadgetAttr(ed,ed->ed_LangList,GTLV_Labels,~0,
                                                                  TAG_DONE);

                                 strcpy(ed->ed_PrefsWork.lp_PreferredLanguages[ed->ed_UsedNodes],langNode->ln_Name);
                                 node = &ed->ed_LangNodes[ed->ed_UsedNodes];
                                 AddTail(&ed->ed_PrefLanguages,node);

                                 SetGadgetAttr(ed,ed->ed_LangList,GTLV_Labels,&ed->ed_PrefLanguages,
                                                                  GTLV_Top,   ed->ed_UsedNodes,
                                                                  TAG_DONE);
                                 SetGadgetAttr(ed,ed->ed_ClearLang,GA_Disabled,FALSE,
                                                                   TAG_DONE);
                                 ed->ed_UsedNodes++;
                             }
                             else
                             {
                                 DisplayBeep(NULL);
                             }
                             break;

        case EC_SELECTCTRY : /* DumpCountries(ed); */
                             i    = ed->ed_CurrentMsg.Code;
                             node = ed->ed_AvailCountries.lh_Head;
                             while (i--)
                             {
                                 node = node->ln_Succ;
                             }
                             strcpy(name,"LOCALE:Countries/");
                             strcat(name,node->ln_Name);
                             strcat(name,".country");

                             ed->ed_PrefsIO = &ed->ed_PrefsWork.lp_CountryData;
                             if ((error = ReadIFF(ed,name,IFFPrefChunks,IFFPrefChunkCnt,ReadCountry)) != ES_NORMAL)
                             {
                                 ShowError2(ed,error);
                             }

                             strcpy(ed->ed_PrefsWork.lp_CountryName,node->ln_Name);
                             break;

        default            : break;
    }
}


/*****************************************************************************/


EdCommand GetCommand(EdDataPtr ed)
d1103 2
a1104 2
struct IntuiMessage *intuiMsg;
struct Window       *intuiWindow;
d1106 1
a1106 1
    intuiMsg    = &ed->ed_CurrentMsg;
d1109 1
a1109 1
    switch(intuiMsg->Class)
d1111 24
a1134 22
	case MOUSEBUTTONS: if (intuiMsg->Code == SELECTDOWN)
	                   {
                               if ((intuiMsg->MouseX-intuiWindow->BorderLeft >= WM_LEFT)
                               &&  (intuiMsg->MouseX-intuiWindow->BorderLeft <= WM_LEFT+WM_WIDTH-WM_SCROLLERWIDTH-4)
                               &&  (intuiMsg->MouseY-intuiWindow->BorderTop >= WM_TOP)
                               &&  (intuiMsg->MouseY-intuiWindow->BorderTop <= WM_TOP+WM_HEIGHT-1))
                               {
                                   PickTimeZone(ed,intuiMsg->MouseX,intuiMsg->MouseY);
                                   PrintTimeZone(ed);
                                   PutMap(ed);
                               }
                           }
                           break;

	default          : break;
    }

    return(EC_NOP);
}


/*****************************************************************************/
d1137 1
a1137 1
VOID GetSpecialCmdState(EdDataPtr ed, EdCommand ec, CmdStatePtr state)
d1139 1
d1141 1
a1141 1
    state->cs_Selected  = FALSE;
@


38.15
log
@*** empty log message ***
@
text
@a80 8
VOID ProcessArgs(EdDataPtr ed, struct DiskObject *diskObj)
{
}


/*****************************************************************************/


d418 1
a954 8


/*****************************************************************************/


VOID SyncTextGadgets(EdDataPtr ed)
{
}
@


38.14
log
@Improved CreateDisplay
@
text
@d207 1
a207 1
    ed->ed_PrefsDefaults.lp_Flags          = LOCF_USES_DST;
d253 2
@


38.13
log
@Added SyncTextGadgets() support
Changes for new pe_iff
Removed Daylight Savings Time gadget

@
text
@d2 1
a2 1
/* includes */                      /*****************************************************************************/
a409 5
    if (!(ed->ed_Menus = CreatePrefsMenus(ed,EM)))
    {
	return(FALSE);
    }

d428 21
a448 26
    if (!ed->ed_LastAdded)
    {
        DisposeDisplay(ed);
        return(FALSE);
    }

    if (!(ed->ed_Window = OpenPrefsWindow(ed,WA_Left,        NW_LEFT,
                                             WA_Top,         NW_TOP,
                                             WA_InnerWidth,  NW_WIDTH,
                                             WA_InnerHeight, NW_HEIGHT,
                                             WA_MinWidth,    NW_MINWIDTH,
                                             WA_MinHeight,   NW_MINHEIGHT,
                                             WA_MaxWidth,    NW_MAXWIDTH,
                                             WA_MaxHeight,   NW_MAXHEIGHT,
                                             WA_IDCMP,       NW_IDCMP,
                                             WA_Flags,       NW_FLAGS,
                                             WA_Zoom,        zoomSize,
                                             WA_AutoAdjust,  TRUE,
                                             WA_PubScreen,   ed->ed_Screen,
                                             WA_Title,       GetString(&ed->ed_LocaleInfo,MSG_LOC_NAME),
                                             WA_NewLookMenus,TRUE,
                                             WA_Gadgets,     ed->ed_Gadgets,
                                             TAG_DONE)))
    {
        DisposeDisplay(ed);
	return(FALSE);
d451 2
a452 1
    return(TRUE);
@


38.12
log
@Added code to output all country information, currently commented out
@
text
@d2 1
a2 7

/* add a dummy country node with US data in it and make it the default
   country if no disk-based prefs file is found
 */


/* includes */
d54 27
d311 1
a311 1
    return(ReadIFF(ed,name,ReadPrefs));
d331 1
a331 1
    return(WriteIFF(ed,name,WritePrefs));
a392 1
    {CHECKBOX_KIND, 193, 142, 12,  14, MSG_LOC_DAYLIGHTSAVINGS_GAD, EC_TOGGLEDAYLIGHT, PLACETEXT_RIGHT},
d425 1
a425 1
    ed->ed_VZoneScroller = DoPrefsGadget(ed,&EG[8],NULL,GTSC_Top,     ed->ed_ZoneYOffset,
a559 4
    ed->ed_Daylight = DoPrefsGadget(ed,&EG[7],ed->ed_Daylight,
                                              GTCB_Checked,ed->ed_PrefsWork.lp_Flags & LOCF_USES_DST,
                                              TAG_DONE);

d712 1
a712 1
        ReadIFF(ed,name,ReadCountry);
d974 8
a988 1
struct Gadget *gadget;
a993 1
    gadget = ed->ed_CurrentMsg.IAddress;
a995 4
        case EC_TOGGLEDAYLIGHT: ed->ed_PrefsWork.lp_Flags &= ~(LOCF_USES_DST);
                                if (gadget->Flags & SELECTED)
                                    ed->ed_PrefsWork.lp_Flags |= LOCF_USES_DST;

d1061 1
a1061 1
                             if ((error = ReadIFF(ed,name,ReadCountry)) != ES_NORMAL)
@


38.11
log
@Now uses DoPrefsGadget() instead of CreatePrefsGadget() for better visuals upon window
  opening
@
text
@d34 1
d44 1
d322 1
a322 1
    if (ReadChunkBytes(iff,&ed->ed_PrefsWork,sizeof(struct CountryPrefs)) == sizeof(struct CountryPrefs))
d577 381
d967 4
d1031 2
a1032 1
        case EC_SELECTCTRY : i    = ed->ed_CurrentMsg.Code;
@


38.10
log
@Now uses WA_Gadgets to add the gadgets to the window
@
text
@d79 1
a79 2
struct Node         *current;
struct Node         *previous;
d129 8
a136 16
                        	current  = list->lh_Head;
                        	previous = (struct Node *)list;

                        	while (current->ln_Succ)
                        	{
                            	    if (Stricmp(current->ln_Name,new->ln_Name) > 0)
                                    {
                                	Insert(list,new,previous);
                                	break;
	                            }
        	                    previous = current;
                	            current  = current->ln_Succ;
                        	}

		        	if (!current->ln_Succ)
		            	    AddTail(list,new);
d394 3
a396 3
    CreatePrefsGadget(ed,&EG[0],TAG_DONE);
    CreatePrefsGadget(ed,&EG[1],TAG_DONE);
    CreatePrefsGadget(ed,&EG[2],TAG_DONE);
d398 10
a407 24
    CreatePrefsGadget(ed,&EG[3],GTLV_Labels, &ed->ed_AvailLanguages,
                                LAYOUTA_SPACING,   1,
                                GTLV_ScrollWidth,  18,
                                TAG_DONE);

    ed->ed_LangList      = CreatePrefsGadget(ed,&EG[4],GTLV_ReadOnly,     TRUE,
                                                       LAYOUTA_SPACING,   1,
                                                       GTLV_ScrollWidth,  18,
                                                       TAG_DONE);

    ed->ed_CountryList   = CreatePrefsGadget(ed,&EG[5],GTLV_Labels,       &ed->ed_AvailCountries,
                                                       GTLV_ShowSelected, NULL,
                                                       LAYOUTA_SPACING,   1,
                                                       GTLV_ScrollWidth,  18,
                                                       TAG_DONE);

    ed->ed_ClearLang     = CreatePrefsGadget(ed,&EG[6],TAG_DONE);
    ed->ed_Daylight      = CreatePrefsGadget(ed,&EG[7],TAG_DONE);

    ed->ed_VZoneScroller = CreatePrefsGadget(ed,&EG[8],GTSC_Top,     ed->ed_ZoneYOffset,
                                                       GTSC_Visible, WM_HEIGHT-4,
                                                       GTSC_Total,   WM_IMAGEHEIGHT,
                                                       PGA_Freedom,  LORIENT_VERT,
                                                       TAG_DONE);
d409 2
d488 12
d503 3
a505 3
    DrawPrefsBevelBox(ed,WM_LEFT,WM_TOP,WM_WIDTH-WM_SCROLLERWIDTH,WM_HEIGHT,
                         GT_VisualInfo,ed->ed_VisualInfo,
                         TAG_DONE);
d519 4
a522 2
    SetGadgetAttr(ed,ed->ed_LangList,GTLV_Labels, ~0,
                                     TAG_DONE);
d526 11
a536 6
    SetGadgetAttr(ed,ed->ed_LangList,GTLV_Labels, &ed->ed_PrefLanguages,
                                     GTLV_Top,    ed->ed_UsedNodes,
                                     TAG_DONE);

    SetGadgetAttr(ed,ed->ed_ClearLang,GA_Disabled,ed->ed_UsedNodes == 0,
                                      TAG_DONE);
d538 3
a540 2
    SetGadgetAttr(ed,ed->ed_Daylight,GTCB_Checked,ed->ed_PrefsWork.lp_Flags & LOCF_USES_DST,
                                     TAG_DONE);
d553 2
a554 3
    SetGadgetAttr(ed,ed->ed_CountryList,GTLV_Labels,   &ed->ed_AvailCountries,
                                        GTLV_Selected, i,
                                        TAG_DONE);
d556 13
a568 2
    PrintTimeZone(ed);
    PutMap(ed);
@


38.9
log
@Changes for new prefs shell

@
text
@a401 21
    if (!(ed->ed_Window = OpenPrefsWindow(ed,WA_Left,        NW_LEFT,
                                             WA_Top,         NW_TOP,
                                             WA_InnerWidth,  NW_WIDTH,
                                             WA_InnerHeight, NW_HEIGHT,
                                             WA_MinWidth,    NW_MINWIDTH,
                                             WA_MinHeight,   NW_MINHEIGHT,
                                             WA_MaxWidth,    NW_MAXWIDTH,
                                             WA_MaxHeight,   NW_MAXHEIGHT,
                                             WA_IDCMP,       NW_IDCMP,
                                             WA_Flags,       NW_FLAGS,
                                             WA_Zoom,        zoomSize,
                                             WA_AutoAdjust,  TRUE,
                                             WA_PubScreen,   ed->ed_Screen,
                                             WA_Title,       GetString(&ed->ed_LocaleInfo,MSG_LOC_NAME),
                                             WA_NewLookMenus,TRUE,
                                             TAG_DONE)))
    {
        FreeMenus(ed->ed_Menus);
	return(FALSE);
    }

d438 22
d469 5
a473 2
    ClearMenuStrip(ed->ed_Window);
    CloseWindow(ed->ed_Window);
@


38.8
log
@Changes for new <prefs/locale.h> and <libraries/locale.h>
@
text
@d228 1
a228 1
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveCSPos    = CSP_PRECEEDS;
d233 1
a233 1
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeCSPos    = CSP_PRECEEDS;
d249 1
d294 1
a294 1
EdStatus OpenPrefs(EdDataPtr ed, STRPTR name, APTR destPrefs)
d296 1
a296 1
    ed->ed_PrefsIO = destPrefs;
d307 1
a307 1
        if (WriteChunkBytes(iff,ed->ed_PrefsIO,sizeof(struct LocalePrefs)) == sizeof(struct LocalePrefs))
d315 1
a315 1
EdStatus SavePrefs(EdDataPtr ed, STRPTR name, APTR sourPrefs)
a316 1
    ed->ed_PrefsIO = sourPrefs;
d329 1
a329 1
    if (ReadChunkBytes(iff,ed->ed_PrefsIO,sizeof(struct CountryPrefs)) == sizeof(struct CountryPrefs))
d374 1
d377 1
a377 1
    {LISTVIEW_KIND, 9,   73,  155, 68, MSG_LOC_COUNTRY_GAD,   EC_SELECTCTRY,0},
d429 2
d433 3
a435 1
    ed->ed_LangList      = CreatePrefsGadget(ed,&EG[4],GTLV_ReadOnly, TRUE,
d440 2
a444 1

d455 1
a455 3
        CloseWindow(ed->ed_Window);
        FreeMenus(ed->ed_Menus);
        FreeGadgets(ed->ed_Gadgets);
a458 6
    SetFont(ed->ed_Window->RPort,ed->ed_Font);
    SetMenuStrip(ed->ed_Window,ed->ed_Menus);
    AddGList(ed->ed_Window,ed->ed_Gadgets,-1,-1,NULL);
    RefreshGList(ed->ed_Gadgets,ed->ed_Window,NULL,-1);
    GT_RefreshWindow(ed->ed_Window,NULL);

d564 6
a569 5
struct Node *node;
struct Node *langNode;
UWORD        i;
EdStatus     error;
char	     name[60];
d571 1
d574 2
a575 3
        case EC_TOGGLEDAYLIGHT: if (ed->ed_PrefsWork.lp_Flags & LOCF_USES_DST)
                                    ed->ed_PrefsWork.lp_Flags &= ~(LOCF_USES_DST);
                                else
d592 1
a592 1
        case EC_ADDLANG    : i        = ed->ed_CurrentMsg->Code;
d631 1
a631 1
        case EC_SELECTCTRY : i    = ed->ed_CurrentMsg->Code;
d663 1
a663 1
    intuiMsg    = ed->ed_CurrentMsg;
a695 3

    if (ec == EC_SAVEICONS)
        state->cs_Selected = ed->ed_SaveIcons;
@


38.7
log
@Changes for new pe_strings.c prefs shell module
@
text
@d203 4
d208 4
a211 3
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_ThousandSeparator,   ",");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_GroupingTable,       "\3\0");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_RadixChar,           ",");
d213 7
a219 3
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonDecimalPoint,     ".");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonThousandSeparator,",");
    strcpy(ed->ed_PrefsDefaults.lp_CountryData.cp_MonGroupingTable,    "\3\0");
d226 1
a226 1
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonPositiveSpaceSep = SS_SPACE;
d231 2
a232 2
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSpaceSep = SS_SPACE;
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonNegativeSignPos  = SP_PARENS;
a233 3

    ed->ed_PrefsDefaults.lp_CountryData.cp_MonFracDigits       = 2;
    ed->ed_PrefsDefaults.lp_CountryData.cp_MonIntFracDigits    = 2;
@


38.6
log
@Changes for new prefs shell
@
text
@d46 1
a46 1
#include "texttable.h"
a233 6
    if (BuildList(ed,&ed->ed_AvailCountries,"LOCALE:Countries","#?.country",8,NULL) != ES_NORMAL)
        return(ES_NO_COUNTRIES);

    if (BuildList(ed,&ed->ed_AvailLanguages,"LOCALE:Languages","#?.language",9,"english") != ES_NORMAL)
        return(ES_NO_LANGUAGES);

a242 1
    return;
d368 5
a372 5
    {LISTVIEW_KIND, 9,   18,  155, 42, MSG_AVAILLANG_GAD, EC_ADDLANG,   0},
    {LISTVIEW_KIND, 193, 18,  155, 42, MSG_PREFLANG_GAD,  EC_NOP,       0},
    {LISTVIEW_KIND, 9,   73,  155, 68, MSG_COUNTRY_GAD,   EC_SELECTCTRY,0},
    {BUTTON_KIND,   364, 26,  171, 14, MSG_CLEARLANG_GAD, EC_CLEARLANG, 0},
    {CHECKBOX_KIND, 193, 142, 12,  14, MSG_DAYLIGHTSAVINGS_GAD, EC_TOGGLEDAYLIGHT, PLACETEXT_RIGHT},
d382 3
d408 1
a408 1
                                             WA_Title,       EDITOR_NAME,
d484 1
a484 1
    str  = GetString(&ed->ed_LocaleInfo,MSG_TIMEZONE_BOX);
d486 1
a486 1
    str2 = GetString(&ed->ed_LocaleInfo,MSG_TZ0+ed->ed_PrefsWork.lp_GMTOffset+10);
@


38.5
log
@Changed from using MSG_ENGLISH texttable string to simply using "english"
@
text
@d57 4
@


38.4
log
@Corrected a buglet
@
text
@d229 1
a229 1
    if (BuildList(ed,&ed->ed_AvailLanguages,"LOCALE:Languages","#?.language",9,GetString(&ed->ed_LocaleInfo,MSG_ENGLISH)) != ES_NORMAL)
@


38.3
log
@Changed ed_PrefsVirtual to ed_PrefsInitial
@
text
@d238 4
@


38.2
log
@Made bool gadgets larger for easier localization
@
text
@d222 1
a222 1
    ed->ed_PrefsVirtual = ed->ed_PrefsDefaults;
@


38.1
log
@Initial V38 RCS checkin
@
text
@d355 3
a357 3
    {BUTTON_KIND,   8,   159, 67,  14, MSG_SAVE_GAD,      EC_SAVE,      0},
    {BUTTON_KIND,   238, 159, 67,  14, MSG_USE_GAD,       EC_USE,       0},
    {BUTTON_KIND,   469, 159, 67,  14, MSG_CANCEL_GAD,    EC_CANCEL,    0},
@
