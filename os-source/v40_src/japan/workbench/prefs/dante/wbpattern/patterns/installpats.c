/*------------------------------------------------------------------------*/

#include <exec/types.h>
#include <exec/memory.h>
#include <graphics/gfx.h>
#include <clib/macros.h>

#include "/wbpattern.h"
#define SIZEPERPLANE	(16 * sizeof(UWORD))

BOOL ReadWBPat(struct BitMap *bm, UBYTE *name);

/*------------------------------------------------------------------------*/

struct BitMap TempBitMap;
#define NUMPRESETS 8
char *PresetName[NUMPRESETS] =
    {
    "blackchecks.pattern",
    "bluestripes.pattern",
    "whitedots.pattern",
    "bluesplats.pattern",

    "randomblue.pattern",
    "braille.pattern",
    "shadycircles.pattern",
    "grateonblue.pattern",
    };

BOOL Plane1Better[NUMPRESETS] =
    {
    /*  If in monochrome, plane 1 should be used instead of plane zero: */
    FALSE,
    FALSE,
    TRUE,
    FALSE,

    FALSE,
    FALSE,
    TRUE,
    FALSE,
    };

/*------------------------------------------------------------------------*/

struct GfxBase *GfxBase = NULL;
struct DosLibrary *DOSBase = NULL;

main()
    {
    WORD plane, pat, byte;
    struct BitMap bmap;
    UBYTE *mem;

    GfxBase = (struct GfxBase *)OpenLibrary("graphics.library",0L);
    DOSBase = (struct DosLibrary *)OpenLibrary("dos.library",0L);
    printf("/*\n");
    printf("\twbpatdefaults.c - Default Patterns for WBPattern Editor\n\n");
    printf("\tCopyright 1989, 1990, Commodore-Amiga, Inc., All Rights Reserved\n\n");
    printf("\tAUTOMATICALLY GENERATED BY INSTALLPATS - DO NOT EDIT!\n\n");
    printf("*/\n\n");

    printf("#include <exec/types.h>\n\n");

    printf("BOOL Plane1Better[] =\n");
    printf("\t{\n");
    for (pat = 0; pat < NUMPRESETS; pat++)
	{
	if (Plane1Better[pat])
	    {
	    printf("\tTRUE,\n");
	    }
	else
	    {
	    printf("\tFALSE,\n");
	    }
	
	}
    printf("\t};\n\n");

    printf("UWORD DefaultPatterns[] =\n");
    printf("\t{\n");
    InitBitMap(&bmap, DEFPATDEPTH, PAT_WIDTH, PAT_HEIGHT);
    for (plane = 0; plane < DEFPATDEPTH; plane++)
	{
	bmap.Planes[plane] = AllocRaster(PAT_WIDTH, PAT_HEIGHT);
	BltClear(bmap.Planes[plane], RASSIZE(PAT_WIDTH, PAT_HEIGHT), 1);
	}
    for (pat = 0; pat < NUMPRESETS; pat++)
	{
	ReadWBPat(&bmap, PresetName[pat]);
	for (plane = 0; plane < DEFPATDEPTH; plane++)
	    {
	    mem = (UBYTE *)bmap.Planes[plane];
 	    printf("\t");
	    for (byte = 0; byte < RASSIZE(PAT_WIDTH, PAT_HEIGHT); byte++)
		{
		if (byte & 1)
		    printf("%02lx, ", *mem++);
		else
		    printf("0x%02lx", *mem++);
		if ((byte & 7) == 7)
		    printf("\n\t");
		}
	    if (byte & 1)
		printf("00, ");
	    printf("\n");
	    }
	printf("\n");
	}
    for (plane = 0; plane < DEFPATDEPTH; plane++)
	{
	FreeRaster(bmap.Planes[plane], PAT_WIDTH, PAT_HEIGHT);
	}
    printf("\t};\n");
    if (DOSBase)
	CloseLibrary((struct Library *)DOSBase);
    if (GfxBase)
	CloseLibrary((struct Library *)GfxBase);
    }


/*------------------------------------------------------------------------*/

/*/ ReadWBPat()
 *
 * Function to read the Workbench backdrop pattern from its env: file.
 *
 * Created:  06-Jun-89, Peter Cherna
 * Modified: 21-Jun-89, Peter Cherna
 *
 * Bugs: none
 *
 */

BOOL ReadWBPat(bm, name)

    struct BitMap *bm;
    UBYTE *name;

    {
    BPTR fileh = NULL;
    BOOL ok;
    struct WBPatHeader *PatHeader = NULL;
    LONG iolength;
    WORD plane;
    UBYTE maxdepth;

    PatHeader = (struct WBPatHeader *) AllocMem(sizeof(struct WBPatHeader),
	MEMF_CLEAR);
    ok = (PatHeader != NULL);

    if (ok)
	{
	fileh = Open(name, MODE_OLDFILE);
	ok = (fileh != NULL);
	}
    if (ok)
	{
	iolength = Read(fileh, (char *) PatHeader,
	    sizeof(struct WBPatHeader));
	ok = ((iolength == sizeof(struct WBPatHeader)) &&
	    (PatHeader->Depth * SIZEPERPLANE == PatHeader->DataLength));
	}
    if (ok)
	{
	/*  Do not read more planes than we have room for: */

	maxdepth = MIN(bm->Depth, PatHeader->Depth);

	for (plane = 0; plane < maxdepth; plane++)
	    {
	    if (ok)
		{
		iolength = Read(fileh, (char *) bm->Planes[plane],
		    SIZEPERPLANE);
		ok = (iolength == SIZEPERPLANE);
		}
	    }
	}

    if (fileh)
	Close(fileh);

    if (PatHeader)
	FreeMem(PatHeader, sizeof(struct WBPatHeader));

    return(ok);
    }


/*------------------------------------------------------------------------*/
